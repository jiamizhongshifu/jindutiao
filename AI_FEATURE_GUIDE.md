# PyDayBar AI智能规划功能使用指南

## 功能概览

PyDayBar现已集成GPT-5驱动的AI智能任务规划功能!只需用自然语言描述你的计划,AI就能自动生成结构化的任务时间表。

## 快速开始

### 1. 启动AI后端服务器

在启动配置GUI之前,必须先启动AI后端服务器:

```bash
python backend_api.py
```

看到以下提示表示成功:
```
============================================================
PyDayBar AI Backend API Server
============================================================
API密钥已加载: OK
监听地址: http://localhost:5000
```

### 2. 启动配置GUI

```bash
python config_gui.py
```

### 3. 使用AI规划

1. **打开任务管理标签页**
2. **在AI智能规划区域输入你的计划**
   - 示例: "明天早上8点起床,9点开始工作到12点,中午休息1小时,下午1点到5点继续工作,晚上6点健身1小时"
3. **点击"智能生成任务"按钮**
4. **等待AI生成(约10-15秒)**
5. **查看生成的任务表格**
6. **点击"保存所有设置"应用更改**

## 功能详解

### AI规划输入示例

#### 示例1: 工作日安排
```
明天9点开会1小时,然后写代码到下午5点,中午12点休息1小时,晚上6点健身
```

#### 示例2: 学习计划
```
早上8点起床,9点到12点学习数学,下午2点到5点学习编程,晚上7点到9点复习
```

#### 示例3: 创业者日程
```
早上7点晨跑,8点早餐,9点产品开发到12点,下午1点商务会议2小时,3点市场分析到6点
```

### 生成结果

AI会自动:
- ✅ 解析时间和任务
- ✅ 生成24小时制时间格式
- ✅ 自动分类任务(work/meeting/break/exercise/learning/other)
- ✅ 为每个任务分配Material Design颜色
- ✅ 检查时间连续性

### 配额系统

**免费版**:
- 每天3次任务规划
- 实时显示剩余配额

**专业版** (未来):
- 每天50次任务规划
- 更多AI功能

### 配额状态指示

- **✓ 今日剩余: X 次规划** (绿色) - 可正常使用
- **⚠️ 今日配额已用完** (橙色) - 请明天再试
- **❌ AI服务未启动** (红色) - 需要启动backend_api.py

## 界面说明

### AI智能规划区域(任务管理标签页顶部)

```
🤖 AI智能规划
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 用自然语言描述您的计划,AI将自动生成任务时间表

描述您的计划: [输入框]
                例如: 明天9点开会1小时,然后写代码到下午5点...

[✨ 智能生成任务] [✓ 今日剩余: 2 次规划] [🔄 刷新配额]
```

### 按钮功能

1. **✨ 智能生成任务** - 调用GPT-5生成任务
   - 点击后显示: ⏳ AI正在生成...
   - 生成完成后自动恢复

2. **🔄 刷新配额** - 手动刷新配额状态
   - 自动检查后端服务器状态
   - 更新剩余次数

## 工作流程

```
用户输入
  ↓
检查后端服务器
  ↓
调用AI API (GPT-5)
  ↓
解析JSON结果
  ↓
填充到任务表格
  ↓
更新时间轴编辑器
  ↓
保存配置
```

## 常见问题

### Q1: 提示"AI服务未启动"

**A**: 需要先启动后端服务器:
```bash
python backend_api.py
```

### Q2: 生成的任务不准确

**A**: 尝试更详细地描述:
- ❌ 坏示例: "明天工作"
- ✅ 好示例: "明天早上9点开始工作到下午5点,中午12点休息1小时"

### Q3: 配额用完了怎么办?

**A**:
- 免费版每天重置(凌晨0点)
- 或使用预设模板
- 或手动添加任务

### Q4: 能否保存生成的任务?

**A**: 必须点击"保存所有设置"按钮,否则只是临时显示

### Q5: 生成任务后如何修改?

**A**:
- 直接在表格中编辑时间/名称/颜色
- 或使用可视化时间轴拖动调整
- 然后保存

## 技术细节

### 使用的AI模型
- **模型**: GPT-5 (gpt-5-2025-08-07)
- **提供商**: 兔子API (api.tu-zi.com)
- **输出方式**: JSON结构化输出

### Token消耗
- 平均每次生成: 400-900 tokens
- 取决于输入复杂度和任务数量

### 响应时间
- 简单任务(3-5个): ~10秒
- 复杂任务(8-10个): ~15秒

### 生成的任务格式
```json
{
  "start": "09:00",
  "end": "12:00",
  "task": "工作",
  "category": "work",
  "color": "#FF6B6B"
}
```

## 高级功能(待实现)

- [ ] 周报生成
- [ ] 对话式查询统计
- [ ] 任务推荐
- [ ] 智能提醒优化
- [ ] 习惯分析

## 故障排查

### 1. GUI启动失败

检查依赖:
```bash
pip install -r requirements.txt
```

### 2. AI生成超时

- 检查网络连接
- 检查backend_api.py是否正常运行
- 查看backend_api.py的控制台输出

### 3. 配额显示异常

- 点击"刷新配额"按钮
- 重启backend_api.py
- 检查API密钥是否正确

## 日志和调试

### 查看后端日志

backend_api.py的控制台会显示:
- API请求
- 错误信息
- Token使用情况

### 查看客户端错误

GUI会弹出详细错误对话框,包含:
- 错误类型
- 错误信息
- 建议操作

## 最佳实践

1. **描述要具体**
   - 包含明确的时间点
   - 说明任务持续时间
   - 描述任务性质

2. **一次规划一天**
   - 不要试图生成一周的任务
   - 每天的任务单独生成

3. **及时保存**
   - 生成后立即查看
   - 确认无误后点击保存
   - 避免意外关闭丢失

4. **合理使用配额**
   - 免费版每天只有3次
   - 先在脑海中构思好
   - 一次性描述完整

## 更新日志

### v1.0.0 (2025-10-30)
- ✨ 首次发布AI任务规划功能
- ✅ GPT-5模型集成
- ✅ 配额管理系统
- ✅ GUI集成
- ✅ 实时配额显示
- ✅ 错误处理和用户友好提示

## 反馈和支持

遇到问题或有建议?
- 查看 AI_INTEGRATION_SUMMARY.md 了解技术细节
- 检查 backend_api.py 的日志输出
- 确保 .env 文件中API密钥正确

## 安全提示

- ⚠️ 不要分享你的 .env 文件
- ⚠️ API密钥应保密
- ⚠️ 后端服务器仅在本地运行(localhost:5000)
