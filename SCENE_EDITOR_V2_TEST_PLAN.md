# 场景编辑器 v2.0 测试计划

> **测试日期**: 2025-11-14
> **测试版本**: Scene Editor v2.0.0
> **测试人员**: Claude AI Assistant

---

## 测试目标

验证场景编辑器v2.0的所有功能正常工作，包括：
- 基础功能（v1.0已有）
- 新增功能（v2.0新增）

---

## 测试环境

- **操作系统**: Windows 11
- **Python版本**: 3.x
- **Qt版本**: PySide6
- **运行方式**: `python scene_editor.py`

---

## 测试用例

### 🔵 第一部分：基础功能测试（v1.0功能）

#### 1.1 应用启动与UI布局

**测试步骤**:
1. 运行 `python scene_editor.py`
2. 检查主窗口是否正常显示
3. 检查是否有3个主要区域：
   - 左侧：资源库和工具栏
   - 中间：画布区域（带网格）
   - 右侧：TabWidget（属性编辑 + 图层管理）

**预期结果**:
- [ ] 应用成功启动，无错误
- [ ] 窗口标题显示 "场景编辑器 v2.0.0"
- [ ] 所有UI组件正常显示
- [ ] 网格线可见（如果启用）

**实际结果**:
_待填写_

---

#### 1.2 网格系统

**测试步骤**:
1. 勾选/取消勾选 "显示网格" 复选框
2. 勾选/取消勾选 "网格吸附" 复选框
3. 拖动一个元素，观察是否吸附到网格

**预期结果**:
- [ ] 显示网格：网格线出现/消失
- [ ] 网格吸附：元素移动时自动对齐到网格交点
- [ ] 网格间距为50像素

**实际结果**:
_待填写_

---

#### 1.3 元素添加

**测试步骤**:
1. 点击 "添加场景元素" 按钮
2. 选择一个图片文件（PNG/WebP）
3. 检查元素是否添加到画布中央

**预期结果**:
- [ ] 文件选择对话框弹出
- [ ] 选择图片后，元素出现在画布中央
- [ ] 元素在属性面板中显示
- [ ] 元素在图层面板中显示（v2.0）

**实际结果**:
_待填写_

---

#### 1.4 元素选择与移动

**测试步骤**:
1. 添加2-3个元素到画布
2. 点击选择一个元素（应该有蓝色边框）
3. 拖动元素到不同位置
4. 点击空白处取消选择

**预期结果**:
- [ ] 点击元素后出现选择边框
- [ ] 可以拖动元素到任意位置
- [ ] 属性面板显示当前选中元素的属性
- [ ] 点击空白处取消选择

**实际结果**:
_待填写_

---

#### 1.5 元素缩放

**测试步骤**:
1. 选中一个元素
2. 在属性面板中调整 "缩放" 滑块（0.1 - 5.0）
3. 观察元素大小变化

**预期结果**:
- [ ] 滑块调整时，元素实时缩放
- [ ] 缩放比例显示正确
- [ ] 缩放后元素保持中心点不变

**实际结果**:
_待填写_

---

#### 1.6 z-index层级调整

**测试步骤**:
1. 添加3个元素，使它们部分重叠
2. 选中一个元素
3. 在属性面板中调整 z-index（0-100）
4. 观察元素的前后遮挡关系变化

**预期结果**:
- [ ] z-index调整时，元素的前后关系立即改变
- [ ] 高z-index的元素显示在前面
- [ ] 图层面板中的顺序同步更新（v2.0）

**实际结果**:
_待填写_

---

#### 1.7 撤销与重做

**测试步骤**:
1. 执行几个操作（添加元素、移动、缩放）
2. 点击 "撤销" 按钮（或Ctrl+Z）
3. 点击 "重做" 按钮（或Ctrl+Y）

**预期结果**:
- [ ] 撤销操作正确回退
- [ ] 重做操作正确前进
- [ ] 撤销栈历史正常工作
- [ ] 可以连续撤销多步

**实际结果**:
_待填写_

---

#### 1.8 道路层管理

**测试步骤**:
1. 点击 "上传道路层" 按钮
2. 选择一个图片文件
3. 在属性面板中调整道路层的：
   - 平铺模式（水平/垂直/双向）
   - z-index
   - 偏移量
   - 缩放

**预期结果**:
- [ ] 道路层图片正确平铺显示
- [ ] 平铺模式切换正常工作
- [ ] z-index调整影响道路层的前后关系
- [ ] 偏移和缩放实时生效

**实际结果**:
_待填写_

---

#### 1.9 事件配置

**测试步骤**:
1. 选中一个元素
2. 在属性面板的 "事件配置" 区域：
   - 选择触发器类型（on_hover, on_click, on_time_reach等）
   - 选择动作类型（show_tooltip, show_dialog, open_url）
   - 填写动作参数
   - 点击 "添加事件"
3. 检查事件是否添加到元素的事件列表

**预期结果**:
- [ ] 所有触发器类型可选
- [ ] 所有动作类型可选
- [ ] 参数输入框根据触发器/动作类型动态变化
- [ ] 事件成功添加到列表
- [ ] 可以删除已添加的事件

**实际结果**:
_待填写_

---

#### 1.10 JSON导出

**测试步骤**:
1. 创建一个完整的场景（道路层 + 多个元素 + 事件）
2. 点击 "导出JSON" 按钮
3. 选择保存位置和文件名
4. 打开导出的JSON文件检查内容

**预期结果**:
- [ ] JSON文件成功导出
- [ ] JSON格式正确（可以被JSON解析器读取）
- [ ] 包含所有配置信息：
  - scene_id, name, version
  - canvas配置
  - road_layer配置
  - scene_layer（所有元素）
  - events配置

**实际结果**:
_待填写_

---

### 🟢 第二部分：v2.0新功能测试

#### 2.1 实时预览面板

**测试步骤**:
1. 切换到 "预览" 选项卡（右侧TabWidget的第三个标签）
2. 点击 "播放" 按钮
3. 观察进度条模拟播放
4. 调整播放速度（0.5x - 4x）
5. 点击 "暂停" 按钮
6. 拖动进度滑块到不同位置

**预期结果**:
- [ ] 预览面板正确显示场景内容
- [ ] 播放按钮启动进度条动画
- [ ] 进度条从0%平滑过渡到100%
- [ ] 播放速度调节正常工作
- [ ] 暂停按钮停止播放
- [ ] 进度滑块可以手动跳转进度

**实际结果**:
_待填写_

---

#### 2.2 图层管理面板

**测试步骤**:
1. 切换到 "图层管理" 选项卡（右侧TabWidget的第二个标签）
2. 检查图层列表是否显示所有元素
3. 测试可见性切换：
   - 取消勾选一个图层的可见性复选框
   - 检查画布中该元素是否隐藏
4. 测试锁定功能：
   - 勾选一个图层的锁定复选框
   - 尝试在画布中移动该元素
5. 测试拖放重新排序：
   - 拖动图层列表中的一个图层到新位置
   - 检查z-index是否自动更新

**预期结果**:
- [ ] 图层列表显示所有元素（道路层+场景元素）
- [ ] 图层按z-index从高到低排序
- [ ] 可见性切换：元素正确显示/隐藏
- [ ] 锁定功能：锁定的元素不可移动、不可选择
- [ ] 拖放重新排序：z-index自动重新计算（从100向下）

**实际结果**:
_待填写_

---

#### 2.3 对齐辅助线

**测试步骤**:
1. 勾选 "对齐辅助线" 复选框
2. 添加3-4个元素到画布
3. 拖动一个元素靠近另一个元素的边缘
4. 观察是否出现红色虚线辅助线
5. 测试不同的对齐关系：
   - 左对齐、右对齐、中心对齐（X轴）
   - 上对齐、下对齐、中心对齐（Y轴）
   - 相邻边缘对齐

**预期结果**:
- [ ] 启用对齐辅助线后，拖动元素时检测对齐关系
- [ ] 检测到对齐时，出现红色虚线（QLineF绘制）
- [ ] 元素自动吸附到对齐位置（10像素阈值）
- [ ] 对齐辅助线优先级高于网格吸附
- [ ] 释放鼠标后，辅助线消失

**实际结果**:
_待填写_

---

#### 2.4 批量操作 - 多选

**测试步骤**:
1. 添加4-5个元素到画布
2. 使用橡皮筋框选（在空白处按住鼠标拖动矩形）
3. 检查框选区域内的所有元素是否被选中
4. 使用 Ctrl+A 快捷键
5. 检查是否所有元素都被选中

**预期结果**:
- [ ] 橡皮筋拖动时显示选择矩形
- [ ] 释放鼠标后，矩形内的所有元素被选中
- [ ] Ctrl+A 选中所有场景元素
- [ ] 选中的元素都有选择边框

**实际结果**:
_待填写_

---

#### 2.5 批量操作 - 复制粘贴

**测试步骤**:
1. 选中1个或多个元素
2. 按 Ctrl+C（或点击工具栏的"复制"按钮）
3. 按 Ctrl+V（或点击工具栏的"粘贴"按钮）
4. 检查粘贴的元素是否出现（带20px偏移）

**预期结果**:
- [ ] 复制操作将元素数据保存到内部剪贴板
- [ ] 粘贴操作创建新元素，位置偏移(+20, +20)
- [ ] 粘贴的元素保留所有属性（缩放、z-index、事件）
- [ ] 粘贴的元素自动被选中

**实际结果**:
_待填写_

---

#### 2.6 批量操作 - 删除

**测试步骤**:
1. 选中1个或多个元素
2. 按 Delete 键（或点击工具栏的"删除"按钮）
3. 检查元素是否从画布和图层列表中移除

**预期结果**:
- [ ] 选中的元素被删除
- [ ] 图层列表同步更新
- [ ] 删除操作可以撤销（Ctrl+Z）

**实际结果**:
_待填写_

---

#### 2.7 UI布局 - TabWidget集成

**测试步骤**:
1. 检查右侧面板是否有TabWidget
2. 切换三个标签：
   - ⚙ 属性编辑
   - 📚 图层管理
   - 🎬 预览（如果有）
3. 检查每个标签的内容是否正确

**预期结果**:
- [ ] TabWidget正常显示，包含多个标签
- [ ] 标签切换流畅，无闪烁
- [ ] 每个标签的内容正确显示
- [ ] 切换标签不影响画布内容

**实际结果**:
_待填写_

---

### 🟡 第三部分：集成测试

#### 3.1 完整工作流测试

**测试步骤**:
1. 创建一个新场景
2. 上传道路层（设置为双向平铺，z-index=50）
3. 添加3个场景元素：
   - tree (z-index=45, 在道路下方)
   - house (z-index=51, 在道路上方)
   - sun (z-index=55, 最上层)
4. 为每个元素配置事件：
   - tree: on_hover → show_tooltip "这是一棵树"
   - house: on_click → show_dialog "欢迎回家！"
   - sun: on_time_reach (progress=50%) → show_tooltip "正午时分"
5. 使用图层面板调整顺序
6. 使用预览面板测试效果
7. 导出JSON

**预期结果**:
- [ ] 所有功能协同工作，无冲突
- [ ] 图层前后关系正确
- [ ] 事件配置正确保存
- [ ] 预览效果符合预期
- [ ] JSON导出包含完整配置

**实际结果**:
_待填写_

---

#### 3.2 性能测试

**测试步骤**:
1. 创建一个包含20个元素的复杂场景
2. 测试操作响应速度：
   - 拖动元素
   - 缩放元素
   - 多选10+个元素
   - 复制粘贴多个元素
3. 观察是否有卡顿或延迟

**预期结果**:
- [ ] 20个元素时操作流畅
- [ ] 拖动响应迅速（<100ms延迟）
- [ ] 多选操作无明显卡顿
- [ ] 复制粘贴操作快速完成

**实际结果**:
_待填写_

---

#### 3.3 异常处理测试

**测试步骤**:
1. 尝试上传非图片文件（如txt）
2. 尝试上传损坏的图片文件
3. 导出JSON到只读目录
4. 配置事件时输入非法参数（如负数进度）

**预期结果**:
- [ ] 非图片文件：显示错误提示，不崩溃
- [ ] 损坏图片：显示错误提示，不崩溃
- [ ] 只读目录：显示保存失败提示
- [ ] 非法参数：输入验证或自动修正

**实际结果**:
_待填写_

---

## 发现的Bug列表

### Bug #1
- **严重程度**: [ ] 严重 [ ] 中等 [ ] 轻微
- **描述**: _待记录_
- **复现步骤**: _待记录_
- **预期行为**: _待记录_
- **实际行为**: _待记录_
- **修复状态**: [ ] 未修复 [ ] 已修复

---

## 测试总结

**测试通过率**: _% (_个通过 / _个总计)

**主要发现**:
- _待填写_

**改进建议**:
- _待填写_

**下一步行动**:
- [ ] 修复所有严重bug
- [ ] 修复所有中等bug
- [ ] 完善文档
- [ ] 准备发布

---

**测试完成日期**: _待填写_
**测试人员签名**: _待填写_
