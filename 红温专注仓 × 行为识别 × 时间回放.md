# GaiYaã€Œçº¢æ¸©ä¸“æ³¨ä»“ Ã— è¡Œä¸ºè¯†åˆ« Ã— æ—¶é—´å›æ”¾ã€

äº§å“è¯´æ˜ / å¼€å‘ä»»åŠ¡å•ï¼ˆåˆå¹¶ç‰ˆ v1.0ï¼‰

---

## 0. èƒŒæ™¯ & ç›®æ ‡

### 0.1 ç°çŠ¶

å½“å‰ GaiYa å·²å…·å¤‡ï¼š

* âœ… å›ºå®šåœ¨æ¡Œé¢åº•éƒ¨çš„æ¯æ—¥è¿›åº¦æ¡ï¼ˆHUDï¼‰
* âœ… æ—¶é—´å— / ä½œæ¯æ—¶é—´è½´ï¼ˆæ¨¡æ¿ + è‡ªå®šä¹‰ï¼‰
* âœ… ç•ªèŒ„æ—¶é’Ÿï¼ˆç‹¬ç«‹å­˜åœ¨ï¼Œæœªä¸æ—¶é—´å—ç»‘å®šï¼‰
* âœ… åŸºç¡€æ•°æ®ç»Ÿè®¡ï¼ˆç®€å•ä½¿ç”¨æ—¶é•¿ / ç•ªèŒ„ç»Ÿè®¡ç­‰ï¼‰

ç°æœ‰é—®é¢˜ï¼š

* æ—¶é—´è½´åªä½“ç°ã€Œè®¡åˆ’ã€ï¼Œ**ç¼ºå°‘ã€Œå®é™…æ‰§è¡Œæƒ…å†µã€çš„ç»´åº¦**
* ç•ªèŒ„ä¸æ—¶é—´å—æ— ç»‘å®šï¼Œæ— æ³•çŸ¥é“ã€Œè¿™æ®µä¸“æ³¨å±äºå“ªå—ä»»åŠ¡ã€
* æ•°æ®ç»Ÿè®¡è¾ƒç²—ï¼Œæ— æ³•å›ç­”ï¼š

  * æˆ‘ä»Šå¤©**çœŸæ­£è®¤çœŸå¹²æ´»äº†å¤šä¹…ï¼Ÿ**
  * æˆ‘ä»Šå¤©**æ‘¸é±¼ / å¨±ä¹ / ç¤¾äº¤åˆç”¨äº†å¤šä¹…ï¼Ÿ**

### 0.2 æœ¬æ¬¡è¿­ä»£ç›®æ ‡

åœ¨ä¸æ¨ç¿»ç°æœ‰æ¶æ„çš„å‰æä¸‹ï¼Œå¼•å…¥ä¸‰å—èƒ½åŠ›ï¼š

1. **çº¢æ¸©ä¸“æ³¨ä»“ï¼ˆRed Focus Chamberï¼‰**

   * å°†ç•ªèŒ„æ—¶é’Ÿä¸å…·ä½“æ—¶é—´å—ç»‘å®š
   * åœ¨è¿›åº¦æ¡ä¸Šæ¸…æ™°å±•ç¤ºã€Œè¿™æ®µæ—¶é—´å¤„äºé«˜å¼ºåº¦ä¸“æ³¨ã€

2. **è¡Œä¸ºè¯†åˆ«ä¸æ—¶é—´ä½¿ç”¨ç»Ÿè®¡ï¼ˆActivity Tracking & Categorizationï¼‰**

   * è¯†åˆ«ç”¨æˆ·ä¸€å¤©ä½¿ç”¨è¿‡å“ªäº› App / å·¥å…·
   * ç²—åˆ†ä¸ºï¼šè®¤çœŸæ‰§è¡Œï¼ˆç”Ÿäº§åŠ›ï¼‰ã€æ‘¸é±¼ï¼ˆå¨±ä¹/ç¤¾äº¤ï¼‰ã€ä¸­æ€§å·¥å…·ç­‰
   * ä¸ºåç»­æ—¶é—´å›æ”¾æä¾›æ•°æ®åŸºç¡€

3. **æ—¶é—´å›æ”¾ï¼ˆTime Replayï¼‰**

   * æ±‡æ€»æ—¶é—´å—è®¡åˆ’ã€çº¢æ¸©ä¸“æ³¨è®°å½•ã€è¡Œä¸ºè¯†åˆ«æ•°æ®
   * ä»¥ã€Œè®¡åˆ’ vs ä¸“æ³¨ vs å®é™…è¡Œä¸ºã€çš„è§†è§’å›æ”¾ç”¨æˆ·çš„ä¸€å¤©

> ç›®æ ‡ç‰ˆæœ¬ï¼š
>
> * MVP å¯ç”¨ & å¯æ¼”ç¤º
> * å¯ä½œä¸ºæœ¬è½®äº§å“å®£ä¼ è§†é¢‘çš„åŠŸèƒ½åŸºç¡€
> * ä¸ºæœªæ¥æ›´ç²¾ç»†çš„è¡Œä¸ºè¯†åˆ« / æŠ¥å‘ŠåŠŸèƒ½é¢„ç•™æ‰©å±•ç©ºé—´

---

## âœ… æœ€æ–°è¿›å±• (2025-11-30 14:17)

### ğŸ¨ æ²‰æµ¸å¼ä¸“æ³¨æ¨¡å¼ - äº¤äº’ä½“éªŒä¼˜åŒ–

**å®Œæˆå†…å®¹**: ç«ç„°å›¾æ ‡å’Œæ‚¬åœæç¤ºçš„ç²¾ç»†åŒ–è°ƒæ•´,æå‡æ²‰æµ¸æ„Ÿå’Œå¯ç”¨æ€§

#### æ ¸å¿ƒä¼˜åŒ–

1. **ç«ç„°å›¾æ ‡è‡ªç„¶æ»‘å…¥åŠ¨ç”»** âœ…
   - **é—®é¢˜**: ä¹‹å‰å›¾æ ‡åœ¨è¿›åº¦0%æ—¶è¢«å¼ºåˆ¶æ˜¾ç¤ºåœ¨å±å¹•å†…(xåæ ‡è¢«é™åˆ¶ä¸º â‰¥0),å¯¼è‡´å›¾æ ‡ä¸è·Ÿéšè¿›åº¦ç§»åŠ¨
   - **è§£å†³**: ç§»é™¤æ‰€æœ‰ `min()`/`max()` åæ ‡çº¦æŸ,å…è®¸å›¾æ ‡ä»å±å¹•å¤–(è´Ÿåæ ‡)å¼€å§‹
   - **æ•ˆæœ**: å›¾æ ‡ç°åœ¨ä¼šä»è¿›åº¦æ¡æœ€å·¦ä¾§(ç”šè‡³å±å¹•å¤–)è‡ªç„¶æ»‘å…¥è§†é‡,å®Œç¾è·Ÿéšä¸“æ³¨è¿›åº¦
   - **ä»£ç ä½ç½®**: [main.py:823](main.py#L823)
   ```python
   # ç§»é™¤çº¦æŸå‰:
   if progress_width < icon_width:
       icon_x = max(0, progress_width // 2 - icon_width // 4)  # å¼ºåˆ¶ â‰¥0
   else:
       icon_x = progress_width - icon_width

   # ç§»é™¤çº¦æŸå:
   icon_x = progress_width - icon_width  # å¯ä»¥æ˜¯è´Ÿæ•°!å…è®¸å±å¹•å¤–æ»‘å…¥
   ```

2. **æ‚¬åœæç¤ºæ™ºèƒ½å®šä½** âœ…
   - **é—®é¢˜**: æç¤ºä½¿ç”¨é»˜è®¤ä½ç½®,å¯èƒ½è¢«è¿›åº¦æ¡æˆ–å…¶ä»–UIé®æŒ¡,ä¸æ–¹ä¾¿æŸ¥çœ‹
   - **è§£å†³**: å¼ºåˆ¶æç¤ºæ˜¾ç¤ºåœ¨é¼ æ ‡å³ä¸Šè§’å›ºå®šåç§»ä½ç½®(å³15px, ä¸Š30px)
   - **æ•ˆæœ**: æç¤ºå§‹ç»ˆè·Ÿéšé¼ æ ‡,æ¸…æ™°å¯è§,ä¸è¢«é®æŒ¡
   - **ä»£ç ä½ç½®**: [main.py:1982-1990](main.py#L1982-L1990)
   ```python
   # é¼ æ ‡ç§»åŠ¨æ—¶å®æ—¶æ›´æ–°æç¤º
   if self.focus_mode and self.focus_start_time:
       self._update_focus_tooltip_text()
       # æ˜¾ç¤ºåœ¨é¼ æ ‡å³ä¸Šè§’
       cursor_pos = self.mapToGlobal(event.position().toPoint())
       tooltip_pos = QPoint(cursor_pos.x() + 15, cursor_pos.y() - 30)
       QToolTip.showText(tooltip_pos, self.toolTip(), self)
   ```

3. **æŠ€æœ¯ç»†èŠ‚**:
   - æ·»åŠ  `QToolTip` å¯¼å…¥åˆ° `PySide6.QtWidgets` ([main.py:15-16](main.py#L15-L16))
   - å®æ—¶æ›´æ–°æç¤ºå†…å®¹: `ğŸ”¥ {ä»»åŠ¡å} | MM:SS / TT:MM`
   - é¼ æ ‡ç§»åŠ¨æ—¶ç«‹å³æ›´æ–°ä½ç½®å’Œå†…å®¹

#### ç”¨æˆ·ä½“éªŒæ”¹è¿›

**ä¿®å¤å‰**:
- ğŸ”¥ å›¾æ ‡åœ¨è¿›åº¦æ¡å‰25%åŒºåŸŸé™æ­¢ä¸åŠ¨
- æ‚¬åœæç¤ºä½ç½®ä¸å›ºå®š,å¯èƒ½è¢«é®æŒ¡

**ä¿®å¤å**:
- ğŸ”¥ å›¾æ ‡ä»0%å°±å¼€å§‹è·Ÿéšè¿›åº¦è‡ªç„¶æ»‘å…¥
- æ‚¬åœæç¤ºå§‹ç»ˆåœ¨é¼ æ ‡å³ä¸Šè§’,æ¸…æ™°å¯è§

#### æ‰“åŒ…ä¿¡æ¯

- **ç‰ˆæœ¬**: GaiYa-v1.6.exe
- **å¤§å°**: 82 MB
- **æ‰“åŒ…æ—¶é—´**: 2025-11-30 14:15
- **ä¿®å¤å†…å®¹**: ç«ç„°å›¾æ ‡æ»‘å…¥åŠ¨ç”» + æ‚¬åœæç¤ºå®šä½

---

## ğŸ” æœ€æ–°è¿›å±• (2025-12-01 09:45)

### ğŸ”¥ è¿›åº¦æ¡ç«ç„°æ ‡è®°ä¸€è‡´æ€§ä¸å°ºå¯¸è°ƒä¼˜

**å®Œæˆå†…å®¹**: ç»Ÿä¸€æ²‰æµ¸å¼ä¸“æ³¨æ¨¡å¼ä¸å¸¸è§„è¿›åº¦æ¡çš„ç«ç„°æ ‡è®°å°ºå¯¸ã€ä½ç½®ä¸é®æŒ¡æ•ˆæœï¼Œæ¶ˆé™¤æˆªæ–­ä¸é”™ä½é—®é¢˜ã€‚

#### æ ¸å¿ƒä¼˜åŒ–

1. **æ²‰æµ¸å¼ä¸“æ³¨æ¡ç«ç„°ç²¾å‡†å¯¹é½**
   - **é—®é¢˜**: åŸå›¾æ ‡é«˜åº¦/å®½åº¦åå¤§ä¸” X è½´ä½ç½®åå³ï¼Œæ— æ³•å®Œå…¨é®æŒ¡è¿›åº¦æ¡é¡¶éƒ¨ã€‚
   - **è§£å†³**: å°†å­—ä½“ç¼©è‡³ 16pxã€å®½åº¦é™è‡³ 25pxï¼ŒX è½´å·¦ç§» 3pxï¼ŒY è½´è·Ÿéšè¿›åº¦æ¡é«˜åº¦åŠ¨æ€å®šä½ï¼ˆ[main.py:814-827](main.py#L814-L827)ï¼‰ã€‚
   - **æ•ˆæœ**: ç«ç„°æ»‘å…¥åŠ¨ç”»ä¸è¿›åº¦æ¡é‡å è‡ªç„¶ï¼Œé¡¶éƒ¨é®æŒ¡ä¸€è‡´ã€‚

2. **å¸¸è§„è¿›åº¦æ¡æ ‡è®°æ‰©å±•è„±ç¦»å®¹å™¨è£åˆ‡**
   - **é—®é¢˜**: å—é™äºä»»åŠ¡å—é«˜åº¦ï¼Œå†å²ä¸“æ³¨ç«ç„°è¢«æˆªæ–­ä¸”å°ºå¯¸ä¸æ–°æ ‡è®°ä¸ä¸€è‡´ã€‚
   - **è§£å†³**: å°†å­—ä½“ç»Ÿä¸€ä¸º 11pxï¼ŒçŸ©å½¢é«˜åº¦å¢åŠ  24pxï¼ŒY è½´æ•´ä½“ä¸‹ç§» 2px å¹¶å…è®¸æ§ä»¶è¶Šç•Œæ¸²æŸ“ï¼ˆ[main.py:2665-2680](main.py#L2665-L2680)ï¼‰ã€‚
   - **æ•ˆæœ**: æ‰€æœ‰ç«ç„°æ ‡è®°å®Œæ•´æ˜¾ç¤ºå¹¶è¦†ç›–ä»»åŠ¡å—é¡¶éƒ¨ï¼Œè§†è§‰ä¿æŒç»Ÿä¸€ã€‚

3. **çŠ¶æ€ä¸€è‡´åŒ–**
   - è¿›è¡Œä¸­ä¸å·²å®ŒæˆçŠ¶æ€å…±ç”¨åŒä¸€ç»˜åˆ¶é€»è¾‘ï¼Œé¿å…å†æ¬¡å‡ºç°â€œæ–°æ—§ç«ç„°â€å·®å¼‚ã€‚

#### æ‰“åŒ…è¯´æ˜

- **ç‰ˆæœ¬**: GaiYa-v1.6.exeï¼ˆé‡æ–°æ‰“åŒ…ï¼‰
- **æ—¶é—´**: 2025-12-01 09:40
- **å¤‡æ³¨**: ä»… UI ç»˜åˆ¶é€»è¾‘è°ƒæ•´ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„ä¸å˜ã€‚

### âœ… è¡Œä¸ºè¯†åˆ«ä¸æ—¶é—´å›æ”¾åŸºç¡€èƒ½åŠ›æ¥å…¥ (2025-12-02 11:10)

**å®Œæˆå†…å®¹**ï¼š

- å¼•å…¥ `generate_time_block_id` å·¥å…·ï¼Œè¿›åº¦æ¡æ¸²æŸ“ã€ä¸“æ³¨ä¼šè¯ã€æ—¶é—´å›æ”¾å…±ç”¨åŒä¸€ IDï¼Œå¹¶å…¼å®¹æ—§ç‰ˆ `task/name`ã€‚
- `TimeReviewWindow` è¯»å–çœŸå®ä»»åŠ¡ä¸ SQLite èšåˆæ•°æ®ï¼Œè‡ªåŠ¨è®¡ç®—è®¡åˆ’åˆ†é’Ÿæ•°ã€ä¸“æ³¨æ—¶é•¿/æ¬¡æ•°ï¼Œå¹¶å¯¹â€œæœªåŒ¹é…æ—¶é—´å—â€ç»™å‡ºæç¤ºã€‚
- `ActivityTracker` æ”¯æŒé…ç½®åŒ–çš„é‡‡æ ·é—´éš”ä¸æœ€çŸ­ä¼šè¯è¿‡æ»¤ï¼›è¡Œä¸ºè®¾ç½®çª—å£ä¿å­˜åå†™å› `config.json` å¹¶å³æ—¶é‡å¯åå°çº¿ç¨‹ã€‚
- [[ç»Ÿè®¡æŠ¥å‘Š|ä»Šæ—¥è¡Œä¸ºæ‘˜è¦æ•´åˆ]]ï¼šç»Ÿè®¡çª—å£ï¼ˆStatisticsWindowï¼‰å¼•å…¥â€œâš¡ ä»Šæ—¥è¡Œä¸ºæ‘˜è¦â€åŒºï¼Œç›´æ¥è¯»å– `db.get_today_activity_stats()`ï¼Œå±•ç¤ºæ´»è·ƒç”¨æœºæ—¶é•¿ã€ç”Ÿäº§åŠ›/æ‘¸é±¼å æ¯”ã€Top Appï¼Œä¸æ—¶é—´å›æ”¾ä¿æŒåŒä¸€å£å¾„ã€‚
- `db_manager` å¢åŠ  `clear_activity_data` / `cleanup_old_data`ï¼Œé…åˆè®¾ç½®é¡µâ€œæ¸…é™¤å†å²æ•°æ®â€ä¸â€œæ•°æ®ä¿ç•™å¤©æ•°â€ã€‚
- ç›¸å…³æµ‹è¯•ï¼ˆ`pytest test_progress_bar_focus.py test_activity_tracking.py`ï¼‰é€šè¿‡ï¼Œç¡®ä¿ä¸“æ³¨ä¸è¡Œä¸ºé“¾è·¯ç¨³å®šã€‚

---

## ğŸš§ åç»­è®¡åˆ’ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### P0
1. **æ—¶é—´å›æ”¾å¯è§†åŒ–å¢å¼º**ï¼šåœ¨ `TimeReviewWindow` ä¸­æ·»åŠ è®¡åˆ’/ä¸“æ³¨æ‰§è¡Œç‡æ¡ã€è¡Œä¸ºé¥¼å›¾ï¼›å®Œå–„å¯¼å‡ºæŒ‰é’®ç”Ÿæˆ CSV/Markdownï¼Œæ»¡è¶³ PRD Â§3.3ã€‚
2. **è®¡åˆ’åˆ†é’Ÿæ•°å‡†ç¡®æ€§**ï¼šé’ˆå¯¹è·¨æ—¥æˆ–æ‹†åˆ†ä»»åŠ¡åœºæ™¯ï¼Œæä¾›æ›´ç²¾ç¡®çš„ `plan_minutes` è®¡ç®—ï¼Œé¿å…å•çº¯ä¾èµ– `end-start` å¸¦æ¥çš„åå·®ï¼Œå¹¶åœ¨ç©ºè®¡åˆ’æ—¥ä»èƒ½å±•ç¤ºé›¶åŸºçº¿ã€‚

### P1
1. **è¡Œä¸ºè¯†åˆ«æ‘˜è¦å…¥å£**ï¼šåœ¨ HUD æˆ–æ‰˜ç›˜èœå•å±•ç¤ºâ€œä»Šæ—¥æ´»è·ƒ/ç”Ÿäº§åŠ›/æ‘¸é±¼â€ç»Ÿè®¡ï¼Œå¹¶åœ¨ `ActivityTracker.session_ended` æ—¶è§¦å‘è½»é‡åˆ·æ–°ã€‚
2. **é…ç½®æŒä¹…åŒ–/æ¸…ç†è‡ªåŠ¨åŒ–**ï¼š`save_config()` åå¢åŠ æ—¥å¿—/æç¤ºï¼›å®ç°å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚æ¯æ—¥å‡Œæ™¨ï¼‰è‡ªåŠ¨è°ƒç”¨ `db.cleanup_old_data`ï¼Œè€Œä¸æ˜¯ä»…åœ¨æ‰‹åŠ¨ä¿å­˜æ—¶è§¦å‘ã€‚
3. **æ—¶é—´å— ID æŒä¹…åŒ–**ï¼šä¸º `tasks.json` å†™å…¥ `time_block_id` å­—æ®µï¼Œå‡å°‘æ¯æ¬¡å¯åŠ¨çš„ HASH è®¡ç®—ï¼Œä¾¿äºæœªæ¥å¤šè®¾å¤‡åŒæ­¥ã€‚

### P2
1. **è¡Œä¸ºè®¾ç½®ä½“éªŒä¼˜åŒ–**ï¼šApp åˆ—è¡¨æ”¯æŒæ–°å¢/åˆ é™¤ã€æŒ‰ä½¿ç”¨æ—¶é•¿æ’åºï¼›æä¾›â€œå¿½ç•¥åˆ—è¡¨â€å¯¼å‡ºï¼Œæ»¡è¶³ PRD Â§2.5 çš„éšç§é€æ˜åº¦è¦æ±‚ã€‚
2. **è‡ªåŠ¨åŒ–æµ‹è¯•è¡¥é½**ï¼šæ–°å¢ `test_time_review_window`ï¼ˆéªŒè¯çœŸå®èšåˆï¼‰ã€è¡Œä¸ºè®¾ç½®ä¿å­˜/æ¸…ç†ç”¨ä¾‹ï¼Œç¡®ä¿ >60% è¦†ç›–ç‡ç›®æ ‡ã€‚
3. **æ–‡æ¡ˆä¸å¼•å¯¼**ï¼šåœ¨æ—¶é—´å›æ”¾å’Œè¡Œä¸ºè®¾ç½®çª—å£åŠ å…¥é¼“åŠ±æ€§æç¤ºï¼Œä¸ Â§3.4ã€Œè¯šå®é•œå­ã€æ–‡æ¡ˆå®šä½ä¿æŒä¸€è‡´ï¼Œé™ä½â€œæƒ©ç½šæ„Ÿâ€ã€‚

---

## 1. åŠŸèƒ½ä¸€ï¼šã€Œçº¢æ¸©ä¸“æ³¨ä»“ã€

### 1.1 æ¦‚å¿µå®šä¹‰ï¼ˆç”¨æˆ·è§†è§’ï¼‰

> åœ¨æ—¶é—´è½´ä¸Šç»™æŸä¸€æ®µæ—¶é—´ã€Œå‡æ¸©ã€ï¼š
> è¿™ä¸€æˆªæ—¶é—´å—è¢«æ ‡è®°ä¸ºä¸“æ³¨åŒºï¼Œå¹¶å¯ç”¨ç•ªèŒ„æ¨¡å¼ã€‚
> è¿›åº¦æ¡åº•éƒ¨å¯¹åº”åŒºåŸŸä»¥æ›´æ˜¾çœ¼çš„è§†è§‰æ•ˆæœè¡¨ç°ã€Œé«˜å¼ºåº¦ä¸“æ³¨ã€ã€‚

**ç”¨æˆ·æ•…äº‹ï¼š**

* æˆ‘å¯ä»¥åœ¨æ—¶é—´è½´ä¸Šé€‰æ‹©ä¸€æ®µæ—¶é—´å—ï¼ˆä¾‹å¦‚ï¼š20:00â€“22:00ã€Œå†™è‡ªå·±çš„é¡¹ç›®ã€ï¼‰
* ç‚¹å‡»ã€Œå¼€å¯çº¢æ¸©ä¸“æ³¨ä»“ã€
* åœ¨è¿™æ®µæ—¶é—´å†…ï¼š

  * å¯åŠ¨ç•ªèŒ„å€’è®¡æ—¶ï¼ˆ25 åˆ†é’Ÿç­‰ï¼‰
  * å±å¹•åº•éƒ¨è¿›åº¦æ¡å¯¹åº”æ—¶é—´æ®µæ˜¾ç¤ºä¸ºã€Œçº¢æ¸©ä¸“æ³¨ä¸­ã€
* ç•ªèŒ„ç»“æŸåï¼š

  * è¿™æ®µæ—¶é—´è¢«è®°å½•ä¸ºã€Œä¸“æ³¨æ—¶é—´ã€ï¼Œå¯åœ¨åç»­ç»Ÿè®¡ä¸­æŸ¥çœ‹

> é‡è¦å‰æï¼š
>
> * **ä¸æ˜¯æ¯ä¸ªæ—¶é—´å—éƒ½å¿…é¡»ä½¿ç”¨ç•ªèŒ„**
> * çº¢æ¸©ä¸“æ³¨ä»“æ˜¯å¯¹éƒ¨åˆ†æ—¶é—´å—çš„ã€ŒåŠ å·èƒ½åŠ›ã€ï¼Œåªè®°å½•ä½ åˆ»æ„ç‚¹ç«çš„ä¸“æ³¨ç‰‡æ®µ

---

### 1.2 äº¤äº’æµç¨‹ï¼ˆMVPï¼‰

**å…¥å£è®¾è®¡ï¼ˆå®ç°å…¶ä¸­ 1â€“2 ä¸ªï¼‰ï¼š**

1. **æ—¶é—´å—å³é”®èœå•**

   * ç”¨æˆ·åœ¨æ—¶é—´å—è§†å›¾ä¸­å³é”®æŸä¸ªæ—¶é—´å—
   * èœå•é¡¹ï¼š`å¼€å¯çº¢æ¸©ä¸“æ³¨ä»“`
   * ç‚¹å‡»åï¼Œè¯¥æ—¶é—´å—è¿›å…¥ä¸“æ³¨çŠ¶æ€å¹¶å¯åŠ¨ç•ªèŒ„

2. **æ—¶é—´å—è¯¦æƒ…é¢æ¿**

   * åœ¨æ—¶é—´å—è¯¦æƒ…å¼¹çª— / ä¾§è¾¹æ ä¸­å¢åŠ æŒ‰é’®ï¼š`ä¸“æ³¨è¿™æ®µæ—¶é—´` æˆ– `å¼€å¯çº¢æ¸©ä¸“æ³¨ä»“`
   * ç‚¹å‡»åæ•ˆæœåŒä¸Š

> åç»­å¯é€‰ï¼š
>
> * æ‚¬åœåœ¨è¿›åº¦æ¡åº•éƒ¨æŸæ®µæ—¶é—´å—æ—¶ï¼Œåœ¨å…¶ä¸Šæ–¹æ˜¾ç¤º ğŸ”¥ æŒ‰é’®ï¼Œç‚¹å‡»å³å¼€å¯

**æµç¨‹ï¼ˆæ ‡å‡†è·¯å¾„ï¼‰ï¼š**

1. ç”¨æˆ·é€‰æ‹©æ—¶é—´å— `A`ï¼ˆå…·å¤‡ `start`, `end`, `title` ç­‰ï¼‰
2. ç”¨æˆ·ç‚¹å‡»ã€Œå¼€å¯çº¢æ¸©ä¸“æ³¨ä»“ã€
3. ç³»ç»Ÿï¼š

   * åˆ›å»ºä¸€æ¡ `FocusSession` è®°å½•ï¼Œç»‘å®š `time_block_id = A.id`
   * å¯åŠ¨ç•ªèŒ„å€’è®¡æ—¶ï¼ˆé»˜è®¤ 25 åˆ†é’Ÿï¼Œæœªæ¥å¯é…ç½®ï¼‰
   * å°†æ—¶é—´å— `A` çŠ¶æ€æ ‡è®°ä¸º `FOCUS_ACTIVE`
4. UIï¼š

   * åº•éƒ¨è¿›åº¦æ¡å¯¹åº”æ—¶é—´å— `A`ï¼š

     * é¢œè‰²åŠ æ·± / è‰²ç›¸å˜åŒ–
     * å¢åŠ è½»å¾®ã€Œå‘¼å¸ã€åŠ¨ç”»
     * æ˜¾ç¤º ğŸ”¥ æ ‡è®°ï¼ˆä¾‹å¦‚å—å·¦ä¾§æˆ–é¡¶éƒ¨ï¼‰
   * åœ¨è¿›åº¦æ¡å³ä¾§æˆ–é¡¶éƒ¨å°æµ®çª—æ˜¾ç¤ºï¼š

     * `ğŸ”¥ 24:32 - å†™è‡ªå·±çš„é¡¹ç›®`
5. ç•ªèŒ„è‡ªç„¶ç»“æŸï¼š

   * `FocusSession.status` â†’ `COMPLETED`
   * `FocusSession.end_time` å¡«å…¥ï¼Œè®¡ç®— `duration_minutes`
   * æ—¶é—´å— `A` çŠ¶æ€ä» `FOCUS_ACTIVE` â†’ `FOCUS_DONE`
6. ç”¨æˆ·æ‰‹åŠ¨ä¸­æ–­ï¼š

   * `FocusSession.status` â†’ `INTERRUPTED`
   * æ—¶é—´å— `A` çŠ¶æ€å›åˆ° `NORMAL`ï¼ˆæˆ–ä¿ç•™ä¸€ä¸ªã€Œè¢«æ‰“æ–­ã€æ ‡è®°ï¼‰
   * æ—¥åç»Ÿè®¡ä¸­å¯ç”¨äºå±•ç¤ºã€Œè¢«æ‰“æ–­çš„ä¸“æ³¨ã€

---

### 1.3 UI è®¾è®¡è¦ç‚¹ï¼ˆPySide6ï¼‰

**è¿›åº¦æ¡ç»„ä»¶ï¼š**

* æ¯ä¸ªæ—¶é—´å—æ–°å¢å­—æ®µ/çŠ¶æ€æ§åˆ¶ï¼š

  * `focus_state: NORMAL | FOCUS_ACTIVE | FOCUS_DONE`
  * `focus_intensity: float`ï¼ˆ0â€“1ï¼Œç”¨äºå®ç°å‘¼å¸åŠ¨ç”»ï¼‰

**åŠ¨ç”»å®ç°ï¼š**

* ä½¿ç”¨ `QTimer` å‘¨æœŸæ€§æ›´æ–° `focus_intensity`ï¼ˆä¾‹å¦‚ 400â€“600msï¼‰
* æ ¹æ® `focus_intensity` è°ƒæ•´ç»˜åˆ¶é¢œè‰²äº®åº¦ / é€æ˜åº¦ï¼Œå½¢æˆå‘¼å¸æ„Ÿ
* æ³¨æ„é™åˆ¶åˆ·æ–°é¢‘ç‡ï¼Œé¿å… CPU å ç”¨è¿‡é«˜

**ç•ªèŒ„ä¿¡æ¯æ˜¾ç¤ºï¼š**

* åœ¨åº•éƒ¨è¿›åº¦æ¡å³ä¾§è®¾è®¡ä¸€ä¸ªå°åŒºåŸŸï¼Œæ˜¾ç¤ºå½“å‰ä¸“æ³¨çŠ¶æ€ï¼š

  * ğŸ”¥ å›¾æ ‡ + å‰©ä½™æ—¶é—´ + å½“å‰æ—¶é—´å—æ ‡é¢˜
* æˆ–å®ç°ä¸€ä¸ªç®€å•çš„å¯æ‹–æ‹½æµ®çª—ï¼ˆMVP æ¨èå…ˆåµŒåœ¨è¿›åº¦æ¡ä¸Šï¼‰

---

### 1.4 çŠ¶æ€æœºè®¾è®¡

**æ—¶é—´å— `TimeBlock` çŠ¶æ€ï¼š**

* `NORMAL`ï¼šé»˜è®¤çŠ¶æ€
* `FOCUS_ACTIVE`ï¼šè¯¥æ—¶é—´å—å†…å­˜åœ¨æ­£åœ¨è¿è¡Œçš„ `FocusSession`
* `FOCUS_DONE`ï¼šè¯¥æ—¶é—´å—è‡³å°‘æœ‰ä¸€æ¡ `COMPLETED` çš„ `FocusSession`

**ä¸“æ³¨ä¼šè¯ `FocusSession` çŠ¶æ€ï¼š**

* `CREATED` â†’ `RUNNING` â†’ `COMPLETED`
* `CREATED` â†’ `RUNNING` â†’ `INTERRUPTED`

---

### 1.5 æ•°æ®ç»“æ„å»ºè®®ï¼ˆä¼ªä»£ç ï¼‰

```python
class TimeBlock(BaseModel):
    id: str
    start: datetime
    end: datetime
    title: str
    # ...
    # å¯å¢åŠ çŠ¶æ€å­—æ®µ
    focus_state: str  # "NORMAL" | "FOCUS_ACTIVE" | "FOCUS_DONE"


class FocusSession(BaseModel):
    id: str
    time_block_id: str
    start_time: datetime
    end_time: datetime | None
    duration_minutes: int
    status: Literal["RUNNING", "COMPLETED", "INTERRUPTED"]
```

> å­˜å‚¨å»ºè®®ï¼š
>
> * MVP é˜¶æ®µå…ˆç”¨æœ¬åœ° SQLite / JSON
> * æ—¥åè‹¥éœ€äº‘åŒæ­¥ï¼Œå†ä¸ç”¨æˆ·è´¦å·ä½“ç³»æ‰“é€š

---

## 2. åŠŸèƒ½äºŒï¼šè¡Œä¸ºè¯†åˆ«ä¸æ—¶é—´ä½¿ç”¨ç»Ÿè®¡

### 2.1 æ ¸å¿ƒç›®æ ‡

> è®°å½•ç”¨æˆ·åœ¨ä¸€å¤©ä¸­å‰å°ä½¿ç”¨è¿‡å“ªäº›è½¯ä»¶ / å·¥å…·ï¼Œ
> ç²—ç•¥åŒºåˆ†ã€Œè®¤çœŸæ‰§è¡Œä»»åŠ¡ vs æ‘¸é±¼å¨±ä¹ vs ä¸­æ€§å·¥å…·ã€ï¼Œ
> ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªã€Œæ—¶é—´å»å“ªå„¿äº†ã€çš„æ€»ä½“åˆ†å¸ƒã€‚

é‡ç‚¹è¾¾æˆï¼š

* è¯†åˆ«ï¼šä¸€å¤©ç”¨è¿‡çš„æ‰€æœ‰ App / è¿›ç¨‹å
* èšåˆï¼šæ¯ä¸ª App åœç•™æ—¶é•¿
* åˆ†ç±»ï¼šç”Ÿäº§åŠ› / æ‘¸é±¼ / ä¸­æ€§ / æœªåˆ†ç±»ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
* è¾“å‡ºï¼š

  * ä»Šæ—¥æ´»è·ƒç”¨æœºæ—¶é•¿
  * è®¤çœŸæ‰§è¡Œæ—¶é•¿
  * æ‘¸é±¼æ—¶é•¿
  * å„ç±»å æ¯” + Top App æ¦œå•

---

### 2.2 è¡Œä¸ºé‡‡é›†ï¼ˆWindows æ¡Œé¢ï¼‰

**é‡‡é›†æ–¹å¼ï¼šè½®è¯¢å½“å‰å‰å°çª—å£**

* æ¯éš” `N` ç§’ï¼ˆå»ºè®® 5 ç§’ï¼‰æ‰§è¡Œï¼š

  1. `GetForegroundWindow()` â†’ è·å–å‰å°çª—å£å¥æŸ„
  2. `GetWindowThreadProcessId()` â†’ è·å– `process_id`
  3. ä½¿ç”¨ `OpenProcess` + `GetModuleFileNameEx()` â†’ è·å–å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ / åç§°

     * å¦‚ï¼š`WINWORD.EXE`, `chrome.exe`, `WeChat.exe`
  4. ï¼ˆå¯é€‰ï¼‰`GetWindowText()` è·å–çª—å£æ ‡é¢˜

**é‡‡æ ·ç»“æ„ï¼š**

```python
class ActivitySample(BaseModel):
    timestamp: datetime
    process_name: str
    window_title: str | None
```

**èšåˆæˆ Sessionï¼š**

* è§„åˆ™ï¼šè¿ç»­å¤šæ¬¡é‡‡æ ·å¦‚æœ `process_name` å’Œ `window_title` å‡ç›¸åŒï¼Œè§†ä¸ºåŒä¸€ä¸ªä¼šè¯
* è‹¥å˜åŒ–ï¼Œç»“æŸæ—§ Sessionï¼Œå¼€å¯æ–° Session

```python
class ActivitySession(BaseModel):
    id: str
    process_name: str
    window_title: str | None
    start_time: datetime
    end_time: datetime | None
    duration_seconds: int
```

> æ‰€æœ‰ç»Ÿè®¡é€»è¾‘åœ¨ `ActivitySession` å±‚è¿›è¡Œã€‚

---

### 2.3 App åˆ†ç±»ä½“ç³»

#### 2.3.1 ç±»åˆ«å®šä¹‰

* `PRODUCTIVE`ï¼ˆç”Ÿäº§åŠ› / è®¤çœŸæ‰§è¡Œï¼‰

  * IDEã€Officeã€è®¾è®¡å·¥å…·ã€æ–‡æ¡£å·¥å…·ã€ä¸“ä¸šè½¯ä»¶ç­‰
* `LEISURE`ï¼ˆå¨±ä¹ / æ‘¸é±¼ï¼‰

  * è§†é¢‘å¹³å°å®¢æˆ·ç«¯ã€æ¸¸æˆå®¢æˆ·ç«¯ã€ç¤¾äº¤ IM ç­‰
* `NEUTRAL`ï¼ˆä¸­æ€§å·¥å…· / ç³»ç»Ÿï¼‰

  * èµ„æºç®¡ç†å™¨ã€ç³»ç»Ÿè®¾ç½®ã€ç»ˆç«¯ã€æˆªå›¾å·¥å…·ç­‰
* `UNKNOWN`ï¼ˆæœªåˆ†ç±»ï¼‰

  * æ‰€æœ‰æš‚æœªå¤„ç† / ç³»ç»Ÿé™Œç”Ÿçš„ App

#### 2.3.2 é»˜è®¤æ˜ å°„

å†…ç½®ä¸€ä¸ªç®€å•æ˜ å°„è¡¨ï¼ˆç¤ºæ„ï¼‰ï¼š

```json
{
  "WINWORD.EXE": "PRODUCTIVE",
  "EXCEL.EXE": "PRODUCTIVE",
  "POWERPNT.EXE": "PRODUCTIVE",
  "Code.exe": "PRODUCTIVE",
  "idea64.exe": "PRODUCTIVE",
  "Figma.exe": "PRODUCTIVE",

  "WeChat.exe": "LEISURE",
  "QQ.exe": "LEISURE",
  "steam.exe": "LEISURE",

  "explorer.exe": "NEUTRAL",

  "chrome.exe": "UNKNOWN",
  "msedge.exe": "UNKNOWN"
}
```

> æµè§ˆå™¨çš„ç²¾ç»†åˆ†ç±»ï¼ˆæŒ‰åŸŸåï¼‰å¯ä»¥ç•™ç»™åç»­ç‰ˆæœ¬ v1.1+ï¼Œå…ˆå…¨éƒ¨ UNKNOWNã€‚

#### 2.3.3 ç”¨æˆ·å¯è‡ªå®šä¹‰è§„åˆ™

åœ¨ã€Œè®¾ç½® â†’ è¡Œä¸ºè¯†åˆ«ã€ä¸­ï¼š

* å±•ç¤ºã€Œæœ€è¿‘ 7 å¤©ä½¿ç”¨è¿‡çš„ App åˆ—è¡¨ã€ï¼š

  * App å›¾æ ‡ï¼ˆå¦‚èƒ½è·å–ï¼‰
  * åç§° / å¯æ‰§è¡Œæ–‡ä»¶å
  * ç´¯è®¡ä½¿ç”¨æ—¶é•¿
  * å½“å‰åˆ†ç±»ï¼ˆä¸‹æ‹‰æ¡†ï¼‰

* ç”¨æˆ·å¯ä¿®æ”¹åˆ†ç±»ï¼š

  * `ç”Ÿäº§åŠ› / æ‘¸é±¼ / ä¸­æ€§ / å¿½ç•¥ç»Ÿè®¡`
  * è¢«æ ‡ä¸ºã€Œå¿½ç•¥ã€çš„ App ä¸è®¡å…¥ç»Ÿè®¡æ•°æ®ï¼ˆä¾‹å¦‚éšç§æ•æ„Ÿç¨‹åºï¼‰

> è®¾è®¡é‡ç‚¹ï¼š
>
> * ç»™ç”¨æˆ·ã€Œè‡ªå®šä¹‰å·¥ä½œ & æ‘¸é±¼è¾¹ç•Œã€çš„æƒåŠ›
> * GaiYa åªæ˜¯æä¾›ã€Œæ—¶é—´æ”¾å¤§é•œã€ï¼Œä¸æ˜¯é“å¾·è£åˆ¤

---

### 2.4 æŒ‡æ ‡è®¡ç®—ï¼ˆæ¯æ—¥ï¼‰

ä»¥æŸæ—¥ï¼ˆå¦‚ä»Šå¤©ï¼‰ä¸ºä¾‹ï¼š

1. èšåˆæ‰€æœ‰ `ActivitySession`ï¼ŒæŒ‰ `process_name` æ±‡æ€»æ—¶é•¿
2. æ ¹æ®æ˜ å°„å…³ç³»ï¼Œå°†æ¯ä¸ª App æ—¶é•¿å½’ç±»è‡³ï¼š

   * `productive_time`ï¼ˆæ‰€æœ‰ PRODUCTIVE App åˆè®¡ï¼‰
   * `leisure_time`ï¼ˆæ‰€æœ‰ LEISURE App åˆè®¡ï¼‰
   * `neutral_time`ï¼ˆæ‰€æœ‰ NEUTRAL App åˆè®¡ï¼‰
   * `unknown_time`ï¼ˆæ‰€æœ‰ UNKNOWN App åˆè®¡ï¼‰

è®¡ç®—ï¼š

* `total_active_time = productive_time + leisure_time + neutral_time + unknown_time`
* ç”Ÿäº§åŠ›å æ¯”ï¼š`productive_time / total_active_time`
* æ‘¸é±¼å æ¯”ï¼š`leisure_time / total_active_time`ï¼ˆä»…ä½œä¸ºå‚è€ƒï¼‰

ä¸»è§†è§’è¾“å‡ºï¼š

* ä»Šæ—¥æ€»ç”¨æœºæ´»è·ƒæ—¶é•¿ï¼š`total_active_time`
* ä»Šæ—¥è®¤çœŸæ‰§è¡Œï¼ˆç”Ÿäº§åŠ›ï¼‰æ—¶é•¿ï¼š`productive_time`
* ä»Šæ—¥æ‘¸é±¼ï¼ˆå¨±ä¹ / ç¤¾äº¤ï¼‰æ—¶é•¿ï¼š`leisure_time`
* ä»Šæ—¥ Top N ä½¿ç”¨ Appï¼Œä¾‹å¦‚ï¼š

```text
Figma.exe   2h 13m  ï¼ˆç”Ÿäº§åŠ›ï¼‰
WeChat.exe  1h 05m  ï¼ˆæ‘¸é±¼ï¼‰
chrome.exe  0h 50m  ï¼ˆæœªåˆ†ç±»ï¼‰
...
```

---

### 2.5 éšç§ä¸å¼€å…³

ä¸ºäº†å‡è½»ç”¨æˆ·çš„ã€Œè¢«ç›‘æ§æ„Ÿã€ï¼Œéœ€æ˜ç¡®ï¼š

1. è¡Œä¸ºè¯†åˆ«ä¸º **å¯é€‰åŠŸèƒ½**ï¼š

   * é»˜è®¤å…³é—­
   * ç¬¬ä¸€æ¬¡å¼€å¯æ—¶å¼¹å‡ºè¯´æ˜ï¼ˆè®°å½•çš„ä¿¡æ¯ç§ç±» / ä¸åšä»€ä¹ˆï¼‰

2. é»˜è®¤åªåš **æœ¬åœ°å­˜å‚¨**ï¼š

   * ä¸è‡ªåŠ¨ä¸Šä¼ äº‘ç«¯
   * å°†æ¥åšäº‘åŒæ­¥å¿…é¡»äºŒæ¬¡æç¤º & è·å–æˆæƒ

3. æä¾›ã€Œä¸€é”®æ¸…é™¤è¡Œä¸ºæ•°æ®ã€çš„å…¥å£ï¼š

   * åˆ é™¤æ‰€æœ‰å†å² `ActivitySession` å’Œç›¸å…³ç»Ÿè®¡

---

## 3. åŠŸèƒ½ä¸‰ï¼šã€Œæ—¶é—´å›æ”¾ã€â€” è®¡åˆ’ Ã— ä¸“æ³¨ Ã— è¡Œä¸º

### 3.1 æ¦‚å¿µå®šä¹‰ï¼ˆç”¨æˆ·è§†è§’ï¼‰

> ä¸€å¤©ç»“æŸæ—¶ï¼Œç‚¹ä¸€ä¸‹ã€Œæ—¶é—´å›æ”¾ã€ï¼Œ
> ä½ å¯ä»¥åœ¨ä¸€é¡µé‡Œçœ‹åˆ°ï¼š
>
> * è‡ªå·±ç”»å¥½çš„æ—¶é—´è½¨é“ï¼ˆè®¡åˆ’ï¼‰
> * çœŸæ­£é«˜å¼ºåº¦ä¸“æ³¨è¿‡çš„æ—¶é—´ï¼ˆçº¢æ¸©ä¸“æ³¨ï¼‰
> * ç”µè„‘å®é™…ä¸Šéƒ½åœ¨å¹²ä»€ä¹ˆï¼ˆç”Ÿäº§åŠ› vs æ‘¸é±¼ï¼‰

---

### 3.2 æ•°æ®æ¥æº

æ—¶é—´å›æ”¾çš„ä¸‰å±‚æ•°æ®åˆ†åˆ«æ¥æºè‡ªï¼š

1. **æ—¶é—´å—ï¼ˆTimeBlockï¼‰**

   * æä¾›ã€Œè®¡åˆ’ã€ç»´åº¦ï¼š

     * æ¯æ—¥æ€»è®¡åˆ’æ—¶é—´
     * æ¯ä¸ªæ—¶é—´å—çš„è®¡åˆ’æ—¶é•¿ & æ ‡é¢˜

2. **ä¸“æ³¨ä¼šè¯ï¼ˆFocusSessionï¼‰**

   * æä¾›ã€Œé«˜å¼ºåº¦ä¸“æ³¨ã€ç»´åº¦ï¼š

     * æŸäº›æ—¶é—´å—ä¸Šæœ‰å¤šå°‘ä¸“æ³¨æ—¶é•¿
     * ä¸€å¤©å½“ä¸­æ€»å…±ä¸“æ³¨äº†å¤šä¹…

3. **è¡Œä¸ºä¼šè¯ï¼ˆActivitySessionï¼‰ + åˆ†ç±»**

   * æä¾›ã€Œå®é™…è¡Œä¸ºã€ç»´åº¦ï¼š

     * ä»Šæ—¥æ€»ç”¨æœºæ—¶é—´
     * è®¤çœŸæ‰§è¡Œ vs æ‘¸é±¼ vs ä¸­æ€§æ‰€å çš„æ—¶é•¿ä¸æ¯”ä¾‹
     * æ’åå‰å‡ çš„è½¯ä»¶æ˜¯è°

---

### 3.3 æ—¶é—´å›æ”¾ UIï¼ˆMVPï¼‰

**å…¥å£ï¼š**

* åœ¨åº•éƒ¨è¿›åº¦æ¡å³ä¾§æ”¾ç½®ä¸€ä¸ªæŒ‰é’®

  * å›¾æ ‡å»ºè®®ï¼šæ—¶é—´èƒ¶ç‰‡ / å›æ”¾ç®­å¤´
  * Tooltipï¼š`æŸ¥çœ‹ä»Šæ—¥æ—¶é—´å›æ”¾`

ç‚¹å‡»åå¼¹å‡ºä¸€ä¸ª **ã€Œä»Šæ—¥æ—¶é—´æŠ¥å‘Šã€** é¢æ¿ï¼Œåˆ†ä¸ºä¸Šä¸‹ä¸¤éƒ¨åˆ†ã€‚

#### ä¸ŠåŠéƒ¨åˆ†ï¼šè®¡åˆ’ vs ä¸“æ³¨ï¼ˆæ—¶é—´å—è§†è§’ï¼‰

* æ ‡é¢˜ï¼š**ã€Œä»Šæ—¥æ—¶é—´å›æ”¾ã€**

* æ‘˜è¦æ•°æ®ï¼š

  * `è®¡åˆ’æ—¶é—´ï¼šX å°æ—¶ Y åˆ†é’Ÿ`ï¼ˆæ‰€æœ‰ TimeBlock æ€»å’Œï¼‰
  * `çº¢æ¸©ä¸“æ³¨æ—¶é—´ï¼šA å°æ—¶ B åˆ†é’Ÿ`ï¼ˆæ‰€æœ‰ COMPLETED FocusSession æ€»å’Œï¼‰
  * `ä¸“æ³¨æ‰§è¡Œç‡ï¼šA / X`ï¼ˆä¾‹å¦‚ 42%ï¼‰

* æ—¶é—´å—åˆ—è¡¨ï¼ˆå¯æŠ˜å ï¼‰ï¼š

  * æ¯ä¸ªæ—¶é—´å—ä¸€è¡Œï¼š

    * å·¦ï¼šé¢œè‰²æ¡ + æ ‡é¢˜ï¼ˆå¦‚ã€Œå†™æ–¹æ¡ˆã€ã€Œå¼€ä¼šã€ã€Œå†™å‰¯ä¸šé¡¹ç›®ã€ï¼‰
    * ä¸­ï¼š`è®¡åˆ’ï¼š90 åˆ†é’Ÿ`
    * å³ï¼š`ä¸“æ³¨ï¼š50 åˆ†é’Ÿï¼ˆ2 æ¬¡çº¢æ¸©ï¼‰` æˆ–
      `ä¸“æ³¨ï¼š0 åˆ†é’Ÿï¼ˆæ— ä¸“æ³¨è®°å½•ï¼‰`

> æ³¨æ„æ–‡æ¡ˆä¸è¦ç›´æ¥è¯´ã€Œæ²¡åšã€ï¼Œåªè¯´ã€Œæ²¡æœ‰ä¸“æ³¨è®°å½•ã€ï¼Œé¿å…è¿‡åº¦è¯„ä»·ã€‚

#### ä¸‹åŠéƒ¨åˆ†ï¼šè¡Œä¸ºç»Ÿè®¡ï¼ˆApp è§†è§’ï¼‰

* æ ‡é¢˜ï¼š**ã€Œä»Šæ—¥ç”µè„‘åœ¨å¹²ä»€ä¹ˆã€**

* æ•°æ®ï¼š

  * `æ´»è·ƒç”¨æœºæ—¶é—´ï¼šT å°æ—¶`
  * å…¶ä¸­ï¼š

    * `è®¤çœŸæ‰§è¡Œï¼ˆç”Ÿäº§åŠ›ï¼‰ï¼šP å°æ—¶ï¼ˆXX%ï¼‰`
    * `æ‘¸é±¼ï¼ˆå¨±ä¹ / ç¤¾äº¤ï¼‰ï¼šL å°æ—¶ï¼ˆXX%ï¼‰`
    * `å…¶ä»–ï¼ˆç³»ç»Ÿ / ä¸­æ€§ / æœªåˆ†ç±»ï¼‰ï¼šN å°æ—¶`

* ç®€å•é¥¼å›¾æˆ–æ¡å½¢å›¾ï¼š

  * ä¸‰ç±»æ¯”ä¾‹å¯è§†åŒ–

* Top App åˆ—è¡¨ï¼š

  * å‰ 3â€“5 å Appï¼š

    * `Figmaï¼š2h 13mï¼ˆç”Ÿäº§åŠ›ï¼‰`
    * `WeChatï¼š1h 05mï¼ˆæ‘¸é±¼ï¼‰`
    * `Chromeï¼š0h 50mï¼ˆæœªåˆ†ç±»ï¼‰`

---

### 3.4 æ–‡æ¡ˆå®šä½ï¼ˆé¿å…ã€Œæƒ©ç½šæ„Ÿã€ï¼‰

æ—¶é—´å›æ”¾ä¸æ˜¯ç”¨æ¥ç¾è¾±ç”¨æˆ·ï¼Œè€Œæ˜¯åšã€Œè¯šå®é•œå­ã€ï¼š

* æ–‡æ¡ˆæ–¹å‘å»ºè®®ï¼š

  * ã€Œè¿™ä¸æ˜¯è°æ¥è¯„åˆ¤ä½ ï¼Œåªæ˜¯å¸®ä½ å¯¹ç…§ï¼š
    ä½ ç”»å¥½çš„é‚£æ¡æ—¶é—´è½¨é“ï¼Œå’Œä½ ä»Šå¤©çœŸå®èµ°è¿‡çš„è·¯å¾„ã€‚ã€

  * ã€Œæœ‰äº›æ—¶é—´ä½ çœŸçš„ç¡¬åˆšäº†ä¸“æ³¨ï¼Œæœ‰äº›æ—¶é—´ä½ é€‰æ‹©äº†æ”¾ç©ºï¼Œ
    é‡è¦çš„æ˜¯â€”â€”ä½ å¼€å§‹çœ‹è§è¿™äº›é€‰æ‹©ã€‚ã€

---

## 4. é¡¹ç›®ç°çŠ¶åˆ†æ

### 4.1 âœ… å·²æœ‰ä¼˜åŠ¿

**å®Œæ•´çš„æ—¶é—´å—ç³»ç»Ÿ**
- ä»»åŠ¡ç®¡ç†ã€æ—¶é—´è®¡ç®—ã€UIæ¸²æŸ“å·²å°±ç»ª
- æ”¯æŒç´§å‡‘æ’åˆ—ã€æ‹–æ‹½ç¼–è¾‘ã€çŠ¶æ€åˆ¤æ–­
- å®Œå–„çš„ä»»åŠ¡æ•°æ®æ¨¡å‹å’Œè®¡ç®—å™¨

**æˆç†Ÿçš„ç•ªèŒ„æ—¶é’Ÿ**
- PomodoroPanelã€PomodoroStateã€ç‹¬ç«‹æµ®åŠ¨çª—å£
- å·¥ä½œæ—¶é—´ã€çŸ­ä¼‘æ¯ã€é•¿ä¼‘æ¯çš„å®Œæ•´çŠ¶æ€æœº
- ä¸æ‰˜ç›˜ç³»ç»Ÿã€é€šçŸ¥ç³»ç»Ÿæ·±åº¦é›†æˆ

**å¼ºå¤§çš„æ•°æ®ç®¡ç†**
- StatisticsManagerã€å»¶è¿Ÿå†™å…¥ã€æ‰¹é‡å¤„ç†
- 90å¤©æ•°æ®è‡ªåŠ¨æ¸…ç†ã€CSVå¯¼å‡ºåŠŸèƒ½
- å®Œå–„çš„ä»»åŠ¡å†å²å’Œå®Œæˆç‡ç»Ÿè®¡

**çµæ´»çš„åœºæ™¯ç³»ç»Ÿ**
- æ”¯æŒäº‹ä»¶è§¦å‘ã€å›¾å±‚æ¸²æŸ“ã€äº¤äº’å¤„ç†
- SceneItemã€EventConfig çš„å®Œæ•´æ•°æ®æ¨¡å‹
- SceneManagerã€Rendererã€EventManager çš„æˆç†Ÿæ¶æ„

**å®Œå–„çš„UIæ¡†æ¶**
- PySide6ã€ä¸»é¢˜ç®¡ç†ã€é…ç½®ç³»ç»Ÿ
- é€æ˜ç½®é¡¶çª—å£ã€ç‚¹å‡»ç©¿é€ã€ä¸°å¯Œçš„äº¤äº’
- æ¨¡å—åŒ–è®¾è®¡ã€StyleManager ç»Ÿä¸€æ ·å¼ç®¡ç†

### 4.2 ğŸ”§ éœ€è¦æ‰©å±•çš„æ¨¡å—

**æ•°æ®æ¨¡å‹æ‰©å±•**
- æ·»åŠ ä¸“æ³¨ä¼šè¯ (FocusSession) æ¨¡å‹
- æ·»åŠ è¡Œä¸ºä¼šè¯ (ActivitySession) æ¨¡å‹
- æ‰©å±•æ—¶é—´å—çŠ¶æ€å­—æ®µ (focus_state)

**ç•ªèŒ„æ—¶é’Ÿé›†æˆ**
- ä¸æ—¶é—´å—ç»‘å®šï¼Œè®°å½•ä¸“æ³¨æ•°æ®
- åˆ›å»ºä¸“æ³¨ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å®ç°ä¸“æ³¨çŠ¶æ€ä¸æ—¶é—´å—çŠ¶æ€çš„åŒæ­¥

**è¡Œä¸ºé‡‡é›†æœåŠ¡**
- Windows API é›†æˆï¼Œåå°æ•°æ®æ”¶é›†
- ActivitySample é‡‡æ ·å’Œ Session èšåˆ
- çº¿ç¨‹å®‰å…¨çš„æ•°æ®é‡‡é›†å’Œå­˜å‚¨

**ç»Ÿè®¡åŠŸèƒ½å¢å¼º**
- ä¸“æ³¨ç»Ÿè®¡æ•°æ®æ”¶é›†å’Œåˆ†æ
- è¡Œä¸ºåˆ†ç±»ç»Ÿè®¡å’Œå¤šç»´åº¦æŸ¥è¯¢
- æ—¶é—´å›æ”¾æ•°æ®çš„èšåˆå’Œè®¡ç®—

**æ–°å¢UIç»„ä»¶**
- æ—¶é—´å›æ”¾çª—å£ (TimeReviewWindow)
- ä¸“æ³¨çŠ¶æ€æ˜¾ç¤ºç»„ä»¶
- è¡Œä¸ºåˆ†ç±»ç®¡ç†ç•Œé¢

---

## 5. åˆ†é˜¶æ®µå¼€å‘è®¡åˆ’

### ğŸ“… ç¬¬ä¸€é˜¶æ®µï¼šçº¢æ¸©ä¸“æ³¨ä»“ï¼ˆ1-2å‘¨ï¼‰

#### ğŸ”¥ æ ¸å¿ƒç›®æ ‡
å°†ç•ªèŒ„æ—¶é’Ÿä¸æ—¶é—´å—æ·±åº¦ç»‘å®šï¼Œå®ç°ä¸“æ³¨æ—¶é—´çš„ç²¾ç¡®è®°å½•å’Œå¯è§†åŒ–

#### ğŸ“‹ è¯¦ç»†ä»»åŠ¡æ¸…å•

**5.1.1 æ•°æ®æ¨¡å‹è®¾è®¡ä¸å®ç°**
```python
# æ–°å¢æ¨¡å‹ç»“æ„
class FocusSession:
    id: str (UUID)
    time_block_id: str  # ç»‘å®šåˆ°å…·ä½“æ—¶é—´å—
    start_time: datetime
    end_time: datetime | None
    duration_minutes: int | None
    status: "RUNNING" | "COMPLETED" | "INTERRUPTED"

# æ‰©å±•æ—¶é—´å—æ¨¡å‹
class TimeBlock:
    # ç°æœ‰å­—æ®µ...
    focus_state: "NORMAL" | "FOCUS_ACTIVE" | "FOCUS_DONE"
    focus_intensity: float  # 0-1ï¼Œç”¨äºå‘¼å¸åŠ¨ç”»
```

**5.1.2 ç•ªèŒ„æ—¶é’Ÿæ”¹é€  (2-3å¤©)**
- [ ] ä¿®æ”¹ PomodoroPanelï¼Œæ”¯æŒ time_block_id å‚æ•°
- [ ] é›†æˆ FocusSession åˆ›å»ºå’Œç®¡ç†é€»è¾‘
- [ ] ä¿®æ”¹ PomodoroStateï¼Œå¢åŠ ä¸“æ³¨ä¼šè¯çŠ¶æ€è¿½è¸ª
- [ ] åœ¨æ—¶é—´å—è¯¦æƒ…é¢æ¿ä¸­æ·»åŠ "å¼€å¯çº¢æ¸©ä¸“æ³¨ä»“"æŒ‰é’®

**5.1.3 æ—¶é—´å—çŠ¶æ€æ‰©å±• (2å¤©)**
- [ ] æ‰©å±•æ—¶é—´å—æ•°æ®ç»“æ„ï¼Œå¢åŠ  focus_state å­—æ®µ
- [ ] å®ç° NORMAL â†’ FOCUS_ACTIVE â†’ FOCUS_DONE çŠ¶æ€è½¬æ¢
- [ ] ä¿®æ”¹ task_calculatorï¼Œæ”¯æŒä¸“æ³¨çŠ¶æ€è®¡ç®—
- [ ] æ›´æ–° StatisticsManagerï¼Œè®°å½•ä¸“æ³¨ä¼šè¯æ•°æ®

**5.1.4 è¿›åº¦æ¡UIå‡çº§ (2-3å¤©)**
- [ ] TimeProgressBar æ”¯æŒæ—¶é—´å—å¤šçŠ¶æ€æ¸²æŸ“
- [ ] å®ç°ä¸“æ³¨æ—¶é—´å—çš„"å‘¼å¸åŠ¨ç”»"æ•ˆæœ (QTimer + focus_intensity)
- [ ] æ·»åŠ  ğŸ”¥ ä¸“æ³¨æ ‡è®°æ˜¾ç¤º
- [ ] åˆ›å»ºä¸“æ³¨çŠ¶æ€æµ®åŠ¨æ˜¾ç¤ºç»„ä»¶

**5.1.5 å³é”®èœå•é›†æˆ (1å¤©)**
- [ ] åœ¨æ—¶é—´å—å³é”®èœå•ä¸­æ·»åŠ "å¼€å¯çº¢æ¸©ä¸“æ³¨ä»“"é€‰é¡¹
- [ ] å®ç°ä¸“æ³¨çŠ¶æ€ä¸‹çš„èœå•é¡¹åŠ¨æ€æ›´æ–°

#### ğŸ§ª ç¬¬ä¸€é˜¶æ®µé‡Œç¨‹ç¢‘
- âœ… æ—¶é—´å—å¯ä»¥ç»‘å®šä¸“æ³¨ä¼šè¯
- âœ… ç•ªèŒ„æ—¶é’Ÿä¸æ—¶é—´å—çŠ¶æ€åŒæ­¥
- âœ… è¿›åº¦æ¡æ˜¾ç¤ºä¸“æ³¨çŠ¶æ€å’ŒåŠ¨ç”»æ•ˆæœ
- âœ… ä¸“æ³¨æ•°æ®è¢«æ­£ç¡®è®°å½•å’Œå­˜å‚¨

---

### ğŸ“… ç¬¬äºŒé˜¶æ®µï¼šè¡Œä¸ºè¯†åˆ«ä¸ç»Ÿè®¡ï¼ˆ2-3å‘¨ï¼‰

#### ğŸ¯ æ ¸å¿ƒç›®æ ‡
å®ç°ç”¨æˆ·ç”µè„‘ä½¿ç”¨è¡Œä¸ºçš„è‡ªåŠ¨è¯†åˆ«ã€åˆ†ç±»å’Œç»Ÿè®¡åˆ†æ

#### ğŸ“‹ è¯¦ç»†ä»»åŠ¡æ¸…å•

**5.2.1 è¡Œä¸ºé‡‡é›†æœåŠ¡å¼€å‘ (4-5å¤©)**
- [ ] åˆ›å»º ActivityTracker åå°æœåŠ¡ (åˆ©ç”¨å·²æœ‰åŸå‹)
- [ ] å®ç° Windows API é›†æˆï¼š
  - `GetForegroundWindow()` â†’ è·å–å‰å°çª—å£å¥æŸ„
  - `GetWindowThreadProcessId()` â†’ è·å–è¿›ç¨‹ID
  - `OpenProcess()` + `GetModuleFileNameEx()` â†’ è·å–å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
- [ ] è®¾è®¡ ActivitySample é‡‡æ ·ç»“æ„å’Œ ActivitySession èšåˆé€»è¾‘
- [ ] å®ç°åå°çº¿ç¨‹å®‰å…¨çš„æ•°æ®é‡‡é›†å’Œå­˜å‚¨ (QThread + QMutex)

**5.2.2 Appåˆ†ç±»ä½“ç³»å®ç° (2-3å¤©)**
- [ ] åˆ›å»º AppCategoryManager ç±»
- [ ] å®ç°é»˜è®¤ App åˆ†ç±»æ˜ å°„è¡¨ï¼š
  ```python
  DEFAULT_APP_CATEGORIES = {
      "WINWORD.EXE": "PRODUCTIVE",
      "EXCEL.EXE": "PRODUCTIVE",
      "Code.exe": "PRODUCTIVE",
      "idea64.exe": "PRODUCTIVE",
      "WeChat.exe": "LEISURE",
      "QQ.exe": "LEISURE",
      "steam.exe": "LEISURE",
      "explorer.exe": "NEUTRAL"
  }
  ```
- [ ] è®¾è®¡ç”¨æˆ·è‡ªå®šä¹‰åˆ†ç±»è§„åˆ™ç³»ç»Ÿ
- [ ] åˆ›å»ºåˆ†ç±»è§„åˆ™çš„å¢åˆ æ”¹æŸ¥æ¥å£

**5.2.3 æ•°æ®åº“é›†æˆä¸ä¼˜åŒ– (2å¤©)**
- [ ] åˆ›å»º DatabaseManager ç»Ÿä¸€æ•°æ®ç®¡ç†
- [ ] è®¾è®¡ SQLite è¡¨ç»“æ„ï¼š
  ```sql
  CREATE TABLE focus_sessions (...);
  CREATE TABLE activity_sessions (...);
  CREATE TABLE app_categories (...);
  ```
- [ ] å®ç°æ•°æ®æ’å…¥ã€æŸ¥è¯¢ã€èšåˆçš„ä¼˜åŒ–ç®—æ³•
- [ ] æ·»åŠ æ•°æ®æ¸…ç†å’Œå¤‡ä»½æœºåˆ¶

**5.2.4 è¡Œä¸ºåˆ†ç±»ç®¡ç†UI (3-4å¤©)**
- [ ] åœ¨ ConfigManager ä¸­æ–°å¢"è¡Œä¸ºè¯†åˆ«"æ ‡ç­¾é¡µ
- [ ] å®ç° App åˆ—è¡¨å±•ç¤º (å›¾æ ‡ã€åç§°ã€æ—¶é•¿ã€åˆ†ç±»)
- [ ] åˆ›å»ºåˆ†ç±»é€‰æ‹©å’Œç¼–è¾‘åŠŸèƒ½
- [ ] æ·»åŠ "å¿½ç•¥ç»Ÿè®¡"é€‰é¡¹å’Œéšç§è®¾ç½®

**5.2.5 ç»Ÿè®¡åŠŸèƒ½å¢å¼º (2-3å¤©)**
- [ ] æ‰©å±• StatisticsManagerï¼Œé›†æˆè¡Œä¸ºæ•°æ®ç»Ÿè®¡
- [ ] å®ç°æŒ‰å¤©ã€æŒ‰åˆ†ç±»ã€æŒ‰Appçš„å¤šç»´åº¦ç»Ÿè®¡
- [ ] åˆ›å»ºç»Ÿè®¡æ•°æ®ç¼“å­˜æœºåˆ¶
- [ ] æ·»åŠ ç»Ÿè®¡æŠ¥å‘Šçš„å¯¼å‡ºåŠŸèƒ½

#### ğŸ§ª ç¬¬äºŒé˜¶æ®µé‡Œç¨‹ç¢‘
- âœ… åå°æœåŠ¡ç¨³å®šè¿è¡Œï¼Œå‡†ç¡®é‡‡é›†ç”¨æˆ·è¡Œä¸ºæ•°æ®
- âœ… App è‡ªåŠ¨åˆ†ç±»å’Œç”¨æˆ·è‡ªå®šä¹‰åˆ†ç±»åŠŸèƒ½å®Œå¤‡
- âœ… è¡Œä¸ºç»Ÿè®¡æ•°æ®å‡†ç¡®ï¼Œæ”¯æŒå¤šç»´åº¦æŸ¥è¯¢
- âœ… ç”¨æˆ·å‹å¥½çš„åˆ†ç±»ç®¡ç†ç•Œé¢

---

### ğŸ“… ç¬¬ä¸‰é˜¶æ®µï¼šæ—¶é—´å›æ”¾åŠŸèƒ½ï¼ˆ1-2å‘¨ï¼‰

#### ğŸ¯ æ ¸å¿ƒç›®æ ‡
åˆ›å»ºç›´è§‚çš„æ—¶é—´å›æ”¾ç•Œé¢ï¼Œæ•´åˆè®¡åˆ’ã€ä¸“æ³¨å’Œå®é™…è¡Œä¸ºæ•°æ®

#### ğŸ“‹ è¯¦ç»†ä»»åŠ¡æ¸…å•

**5.3.1 æ—¶é—´å›æ”¾çª—å£å¼€å‘ (3-4å¤©)**
- [ ] åˆ›å»º TimeReviewWindow ä¸»çª—å£ (åˆ©ç”¨å·²æœ‰åŸå‹)
- [ ] å®ç°ä¸ŠåŠéƒ¨åˆ†ï¼šè®¡åˆ’ vs ä¸“æ³¨ç»Ÿè®¡
  ```python
  # æ•°æ®ç»“æ„ç¤ºä¾‹
  review_data = {
      "total_plan_minutes": 480,
      "total_focus_minutes": 180,
      "focus_execution_rate": 37.5,
      "time_blocks": [
          {
              "name": "å†™æ–¹æ¡ˆ",
              "plan_minutes": 120,
              "focus_minutes": 80,
              "focus_sessions": 2
          }
      ]
  }
  ```
- [ ] å®ç°ä¸‹åŠéƒ¨åˆ†ï¼šè¡Œä¸ºç»Ÿè®¡å±•ç¤º
  ```python
  # è¡Œä¸ºç»Ÿè®¡æ•°æ®ç»“æ„
  activity_data = {
      "total_active_seconds": 14400,
      "categories": {
          "PRODUCTIVE": 7200,
          "LEISURE": 3600,
          "NEUTRAL": 1800,
          "UNKNOWN": 1800
      },
      "top_apps": [
          {"name": "Figma.exe", "duration": 7200, "category": "PRODUCTIVE"},
          {"name": "WeChat.exe", "duration": 1800, "category": "LEISURE"}
      ]
  }
  ```
- [ ] è®¾è®¡å“åº”å¼å¸ƒå±€å’Œä¼˜é›…çš„UIé£æ ¼

**5.3.2 æ•°æ®èšåˆä¸è®¡ç®— (2-3å¤©)**
- [ ] å®ç°æ—¶é—´å—ä¸ä¸“æ³¨ä¼šè¯çš„æ•°æ®å…³è”ç®—æ³•
- [ ] åˆ›å»ºä¸“æ³¨æ‰§è¡Œç‡çš„è®¡ç®—é€»è¾‘ï¼š
  ```python
  focus_rate = (total_focus_minutes / total_plan_minutes) * 100
  ```
- [ ] å®ç°è¡Œä¸ºæ•°æ®çš„æŒ‰å¤©èšåˆå’Œåˆ†ç±»ç»Ÿè®¡
- [ ] ä¼˜åŒ–æ•°æ®æŸ¥è¯¢æ€§èƒ½ï¼Œæ”¯æŒå®æ—¶æ›´æ–°

**5.3.3 å¯è§†åŒ–ç»„ä»¶å¼€å‘ (2å¤©)**
- [ ] åˆ›å»ºç®€å•çš„é¥¼å›¾/æ¡å½¢å›¾ç»„ä»¶ (QPainter æ‰‹åŠ¨ç»˜åˆ¶)
- [ ] å®ç°æ—¶é—´å—åˆ—è¡¨çš„åŠ¨æ€æ¸²æŸ“
- [ ] æ·»åŠ  Top App æ’è¡Œæ¦œç»„ä»¶
- [ ] å®ç°æ•°æ®çš„é¢œè‰²ç¼–ç å’Œå›¾æ ‡æ˜¾ç¤º

**5.3.4 å›æ”¾å…¥å£ä¸é›†æˆ (1å¤©)**
- [ ] åœ¨ä¸»è¿›åº¦æ¡æ·»åŠ æ—¶é—´å›æ”¾æŒ‰é’® (æ—¶é—´èƒ¶ç‰‡å›¾æ ‡)
- [ ] å®ç°å›æ”¾çª—å£çš„å¿«æ·é”®æ”¯æŒ (Ctrl+T)
- [ ] æ·»åŠ ä»Šæ—¥æ•°æ®çš„å®æ—¶æ›´æ–°æœºåˆ¶

**5.3.5 ç”¨æˆ·ä½“éªŒä¼˜åŒ– (1å¤©)**
- [ ] å®Œå–„æ–‡æ¡ˆï¼Œé¿å…"æƒ©ç½šæ„Ÿ"ï¼Œä½¿ç”¨é¼“åŠ±æ€§è¯­è¨€
- [ ] æ·»åŠ æ•°æ®åˆ·æ–°å’Œå†å²è®°å½•æŸ¥çœ‹åŠŸèƒ½
- [ ] ä¼˜åŒ–çª—å£åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ

#### ğŸ§ª ç¬¬ä¸‰é˜¶æ®µé‡Œç¨‹ç¢‘
- âœ… å®Œæ•´çš„æ—¶é—´å›æ”¾ç•Œé¢ï¼Œå±•ç¤ºä¸‰å±‚æ•°æ®å¯¹æ¯”
- âœ… ç›´è§‚çš„ç»Ÿè®¡å›¾è¡¨å’Œæ•°æ®å¯è§†åŒ–
- âœ… æµç•…çš„ç”¨æˆ·ä½“éªŒå’Œå‹å¥½çš„ç•Œé¢è®¾è®¡

---

## 6. æ•°æ®å±‚æ¶æ„è®¾è®¡

### 6.1 æ•°æ®åº“è®¾è®¡

```sql
-- ä¸“æ³¨ä¼šè¯è¡¨
CREATE TABLE focus_sessions (
    id TEXT PRIMARY KEY,
    time_block_id TEXT,
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    duration_minutes INTEGER,
    status TEXT CHECK(status IN ('RUNNING', 'COMPLETED', 'INTERRUPTED'))
);

-- è¡Œä¸ºä¼šè¯è¡¨ (èšåˆæ•°æ®)
CREATE TABLE activity_sessions (
    id TEXT PRIMARY KEY,
    process_name TEXT,
    window_title TEXT,
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    duration_seconds INTEGER,
    category TEXT DEFAULT 'UNKNOWN'
);

-- Appåˆ†ç±»è¡¨ (ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™)
CREATE TABLE app_categories (
    process_name TEXT PRIMARY KEY,
    category TEXT CHECK(category IN ('PRODUCTIVE', 'LEISURE', 'NEUTRAL', 'UNKNOWN')),
    is_ignored BOOLEAN DEFAULT 0
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_focus_sessions_time_block ON focus_sessions(time_block_id);
CREATE INDEX idx_focus_sessions_start_time ON focus_sessions(start_time);
CREATE INDEX idx_activity_sessions_start_time ON activity_sessions(start_time);
CREATE INDEX idx_activity_sessions_category ON activity_sessions(category);
```

### 6.2 æ•°æ®ç®¡ç†å±‚è®¾è®¡

```python
class DatabaseManager:
    """ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨"""

    # --- ä¸“æ³¨ä¼šè¯ç®¡ç† ---
    def create_focus_session(self, time_block_id: str) -> str
    def complete_focus_session(self, session_id: str)
    def interrupt_focus_session(self, session_id: str)
    def get_today_focus_stats(self) -> dict

    # --- è¡Œä¸ºä¼šè¯ç®¡ç† ---
    def save_activity_session(self, process_name, window_title, start_time, end_time, duration_seconds)
    def get_today_activity_stats(self) -> dict

    # --- Appåˆ†ç±»ç®¡ç† ---
    def set_app_category(self, process_name: str, category: str, is_ignored: bool = False)
    def get_app_category(self, process_name: str) -> str
    def get_all_app_categories(self) -> list

    # --- æ•°æ®æ¸…ç† ---
    def cleanup_old_data(self, days: int = 90)
    def export_data(self, filepath: str) -> bool
```

### 6.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**å»¶è¿Ÿå†™å…¥æœºåˆ¶**
- æ‰¹é‡æ›´æ–°ï¼Œå‡å°‘ç£ç›˜I/O (å¤ç”¨ç°æœ‰ StatisticsManager çš„ä¼˜åŒ–)
- å†…å­˜ç¼“å†²åŒºï¼Œå®šæ—¶æ‰¹é‡æäº¤

**æ•°æ®ç¼“å­˜**
- å†…å­˜ç¼“å­˜çƒ­ç‚¹æ•°æ® (å½“æ—¥ç»Ÿè®¡ã€å¸¸ç”¨åˆ†ç±»)
- LRU æ·˜æ±°ç­–ç•¥ï¼Œæ§åˆ¶å†…å­˜ä½¿ç”¨

**æŸ¥è¯¢ä¼˜åŒ–**
- å…³é”®å­—æ®µå»ºç«‹ç´¢å¼•
- é¢„èšåˆå¸¸ç”¨ç»Ÿè®¡æ•°æ®
- åˆ†é¡µæŸ¥è¯¢å¤§æ•°æ®é›†

**è‡ªåŠ¨æ¸…ç†**
- å®šæœŸæ¸…ç† 90 å¤©å‰çš„è¯¦ç»†è¡Œä¸ºæ•°æ®
- ä¿ç•™èšåˆç»Ÿè®¡æ•°æ®
- ç”¨æˆ·å¯é…ç½®æ¸…ç†ç­–ç•¥

### 6.4 æ•°æ®è¿ç§»ç­–ç•¥

```python
# ä»ç°æœ‰ JSON ç»Ÿè®¡æ•°æ®è¿ç§»åˆ° SQLite
def migrate_statistics_json_to_sqlite():
    """è¿ç§»ç°æœ‰çš„ç»Ÿè®¡æ•°æ®åˆ°æ–°çš„æ•°æ®åº“ç»“æ„"""
    # è¯»å– statistics.json
    # è½¬æ¢ä¸ºæ–°çš„æ•°æ®æ¨¡å‹
    # æ‰¹é‡æ’å…¥åˆ° SQLite
    # éªŒè¯æ•°æ®å®Œæ•´æ€§
```

---

## 7. æŠ€æœ¯å®ç°ç»†èŠ‚

### 7.1 åå°æœåŠ¡æ¶æ„

```python
class ActivityTracker(QThread):
    """Windows è¡Œä¸ºé‡‡é›†åå°æœåŠ¡"""

    session_ended = Signal(str, str, int)  # process_name, title, duration

    def __init__(self):
        super().__init__()
        self.polling_interval = 5  # 5ç§’é‡‡æ ·é—´éš”
        self.current_session = None

    def run(self):
        """ä¸»å¾ªç¯ï¼Œä½¿ç”¨ QMutex ç¡®ä¿çº¿ç¨‹å®‰å…¨"""
        while self.is_running:
            try:
                self._check_activity()
            except Exception as e:
                logger.error(f"Activity tracker error: {e}")

            # ä½¿ç”¨ QWaitCondition å®ç°å¯ä¸­æ–­çš„ç­‰å¾…
            self.mutex.lock()
            self.condition.wait(self.mutex, self.polling_interval * 1000)
            self.mutex.unlock()
```

### 7.2 UIçŠ¶æ€ç®¡ç†

```python
class TimeBlock(QWidget):
    """æ‰©å±•çš„æ—¶é—´å—ç»„ä»¶ï¼Œæ”¯æŒä¸“æ³¨çŠ¶æ€"""

    def __init__(self, task_data):
        super().__init__()
        self.focus_state = "NORMAL"
        self.focus_intensity = 0.0
        self.breathing_timer = QTimer()
        self.breathing_timer.timeout.connect(self._update_breathing_effect)

    def start_focus_mode(self):
        """å¼€å§‹ä¸“æ³¨æ¨¡å¼"""
        self.focus_state = "FOCUS_ACTIVE"
        self.breathing_timer.start(100)  # 100ms æ›´æ–°ä¸€æ¬¡å‘¼å¸æ•ˆæœ

    def _update_breathing_effect(self):
        """æ›´æ–°å‘¼å¸åŠ¨ç”»æ•ˆæœ"""
        # ä½¿ç”¨æ­£å¼¦å‡½æ•°è®¡ç®—å¼ºåº¦
        self.focus_intensity = (math.sin(time.time() * 2) + 1) / 2
        self.update()  # è§¦å‘é‡ç»˜
```

### 7.3 PySide6 ç»˜åˆ¶ä¼˜åŒ–

```python
class FocusProgressBar(QWidget):
    """ä¸“æ³¨çŠ¶æ€è¿›åº¦æ¡ç»„ä»¶"""

    def paintEvent(self, event):
        painter = QPainter(self)
        painter.setRenderHint(QPainter.RenderHint.Antialiasing)

        # ç»˜åˆ¶ä¸“æ³¨æ—¶é—´å—
        for time_block in self.time_blocks:
            if time_block.focus_state == "FOCUS_ACTIVE":
                # ç»˜åˆ¶å‘¼å¸æ•ˆæœçš„æ¸å˜è‰²
                color = self._calculate_breathing_color(time_block.focus_intensity)
                painter.fillRect(rect, color)

                # ç»˜åˆ¶ ğŸ”¥ æ ‡è®°
                painter.drawText(icon_rect, "ğŸ”¥")

    def _calculate_breathing_color(self, intensity):
        """æ ¹æ®å‘¼å¸å¼ºåº¦è®¡ç®—é¢œè‰²"""
        base_color = QColor(255, 100, 100)  # çº¢è‰²åŸºè°ƒ
        alpha = int(100 + intensity * 155)  # é€æ˜åº¦å˜åŒ–
        return QColor(base_color.red(), base_color.green(), base_color.blue(), alpha)
```

### 7.4 æ•°æ®åŒæ­¥æœºåˆ¶

```python
class DataSyncManager:
    """æ•°æ®åŒæ­¥ç®¡ç†å™¨"""

    def __init__(self):
        self.pending_writes = []
        self.sync_timer = QTimer()
        self.sync_timer.timeout.connect(self._flush_pending_writes)
        self.sync_timer.start(30000)  # 30ç§’åŒæ­¥ä¸€æ¬¡

    def queue_focus_session_update(self, session_data):
        """å°†ä¸“æ³¨ä¼šè¯æ›´æ–°åŠ å…¥é˜Ÿåˆ—"""
        self.pending_writes.append(('focus', session_data))

    def _flush_pending_writes(self):
        """æ‰¹é‡å†™å…¥å¾…å¤„ç†çš„æ•°æ®"""
        if not self.pending_writes:
            return

        try:
            # æ‰¹é‡å†™å…¥æ•°æ®åº“
            db.batch_insert(self.pending_writes)
            self.pending_writes.clear()
        except Exception as e:
            logger.error(f"Data sync failed: {e}")
```

---

## 8. å¼€å‘èµ„æºè¯„ä¼°

### 8.1 å¼€å‘æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | åŠŸèƒ½æ¨¡å— | é¢„ä¼°æ—¶é—´ | å…³é”®ä¾èµ– |
|------|----------|----------|----------|
| ç¬¬ä¸€é˜¶æ®µ | çº¢æ¸©ä¸“æ³¨ä»“ | 1-2å‘¨ | ç°æœ‰ç•ªèŒ„æ—¶é’Ÿã€æ—¶é—´å—ç³»ç»Ÿ |
| ç¬¬äºŒé˜¶æ®µ | è¡Œä¸ºè¯†åˆ« | 2-3å‘¨ | Windows APIã€SQLite |
| ç¬¬ä¸‰é˜¶æ®µ | æ—¶é—´å›æ”¾ | 1-2å‘¨ | å‰ä¸¤é˜¶æ®µæ•°æ®åŸºç¡€ |
| **æ€»è®¡** | **å®Œæ•´åŠŸèƒ½** | **4-7å‘¨** | **ç°æœ‰æ¶æ„å®Œå–„åº¦** |

### 8.2 æŠ€æœ¯é£é™©ä¸ç¼“è§£

**Windows APIå…¼å®¹æ€§é£é™©**
- é£é™©ï¼šä¸åŒWindowsç‰ˆæœ¬APIè¡Œä¸ºå·®å¼‚
- ç¼“è§£ï¼šæå‰åœ¨ Win10/11 ä¸Šæµ‹è¯•ï¼Œå‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ

**æ€§èƒ½å½±å“é£é™©**
- é£é™©ï¼šåå°é‡‡é›†æœåŠ¡å½±å“ç³»ç»Ÿæ€§èƒ½
- ç¼“è§£ï¼šé™åˆ¶CPUä½¿ç”¨ç‡<5%ï¼Œå¯é…ç½®é‡‡æ ·é—´éš”

**æ•°æ®éšç§é£é™©**
- é£é™©ï¼šç”¨æˆ·æ‹…å¿ƒè¢«ç›‘æ§
- ç¼“è§£ï¼šæœ¬åœ°å­˜å‚¨ã€ç”¨æˆ·å¯æ§ã€ä¸€é”®æ¸…é™¤ã€é€æ˜è¯´æ˜

**æ‰“åŒ…å¤æ‚æ€§é£é™©**
- é£é™©ï¼šæ–°å¢ä¾èµ–å¯¼è‡´PyInstalleræ‰“åŒ…å¤±è´¥
- ç¼“è§£ï¼šåˆ†é˜¶æ®µæµ‹è¯•æ‰“åŒ…ï¼Œå‡†å¤‡.specæ–‡ä»¶æ›´æ–°

### 8.3 æˆåŠŸæŒ‡æ ‡

**åŠŸèƒ½æŒ‡æ ‡**
- ä¸“æ³¨ä¼šè¯è®°å½•å‡†ç¡®ç‡ > 95%
- è¡Œä¸ºè¯†åˆ«è¦†ç›–ç‡ > 90%
- æ•°æ®æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms
- UIåŠ¨ç”»æµç•…åº¦ > 30fps

**ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**
- åŠŸèƒ½å‘ç°å’Œå­¦ä¹ æˆæœ¬ < 5åˆ†é’Ÿ
- æ—¥å¸¸ä½¿ç”¨å¹²æ‰°åº¦æœ€å°åŒ–
- æ•°æ®éšç§å®‰å…¨æ„Ÿ > 90%

**æŠ€æœ¯æŒ‡æ ‡**
- å†…å­˜ä½¿ç”¨å¢é‡ < 50MB
- CPUä½¿ç”¨ç‡å¢é‡ < 5%
- æ•°æ®åº“æ–‡ä»¶å¤§å° < 100MB/å¹´

---

## 9. å¼€å‘ä»»åŠ¡æ‹†è§£ï¼ˆæ›´æ–°ç‰ˆï¼‰

### 9.1 å®¢æˆ·ç«¯ï¼ˆPySide6ï¼‰

**å·²å®Œæˆçš„æ¨¡å—ï¼ˆå¤ç”¨ï¼‰**
- âœ… æ—¶é—´å—æ¸²æŸ“å’Œäº¤äº’ç³»ç»Ÿ
- âœ… ç•ªèŒ„æ—¶é’Ÿå®Œæ•´åŠŸèƒ½
- âœ… ç»Ÿè®¡æ•°æ®å’Œé…ç½®ç®¡ç†
- âœ… åœºæ™¯ç³»ç»Ÿå’Œäº‹ä»¶å¤„ç†
- âœ… ä¸»é¢˜ç®¡ç†å’ŒUIæ¡†æ¶

**éœ€è¦æ‰©å±•çš„æ¨¡å—**
- [ ] **æ¨¡å‹å±‚æ‰©å±•**
  - æ–°å¢ `FocusSession`, `ActivitySession` æ¨¡å‹
  - æ‰©å±• `TimeBlock` æ¨¡å‹ï¼Œå¢åŠ ä¸“æ³¨çŠ¶æ€å­—æ®µ
  - å¢åŠ æŒä¹…åŒ–é€»è¾‘ï¼ˆSQLite é›†æˆï¼‰

- [ ] **ç•ªèŒ„ Ã— æ—¶é—´å—æ”¹é€ **
  - åœ¨ç•ªèŒ„å¯åŠ¨æµç¨‹ä¸­æ”¯æŒç»‘å®š `time_block_id`
  - æ§åˆ¶ `FocusSession` åˆ›å»º / æ›´æ–° / ç»“æŸ
  - æ›´æ–°å¯¹åº”æ—¶é—´å—çš„ `focus_state`
  - å®ç°ä¸“æ³¨çŠ¶æ€çš„UIåé¦ˆ

- [ ] **è¿›åº¦æ¡æ¸²æŸ“å‡çº§**
  - æ”¯æŒæ—¶é—´å—å¤šçŠ¶æ€ï¼š`NORMAL / FOCUS_ACTIVE / FOCUS_DONE`
  - å®ç°çº¢æ¸©ä¸“æ³¨ä»“çš„è§†è§‰è¡¨ç°ï¼ˆé¢œè‰² + å‘¼å¸åŠ¨ç”»ï¼‰
  - æ·»åŠ ç•ªèŒ„ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ
  - ä¼˜åŒ–ç»˜åˆ¶æ€§èƒ½

- [ ] **è¡Œä¸ºé‡‡é›†æœåŠ¡**
  - å®šæ—¶è½®è¯¢å‰å°çª—å£ï¼ˆWin32 API + pywin32ï¼‰
  - é‡‡é›† `ActivitySample`ï¼Œå¹¶èšåˆä¸º `ActivitySession`
  - æä¾›æŒ‰å¤©èšåˆ API ç»™ç»Ÿè®¡æ¨¡å—ä½¿ç”¨
  - å®ç°çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–

- [ ] **è¡Œä¸ºåˆ†ç±»ç®¡ç† UI**
  - è®¾ç½®é¡µï¼šå±•ç¤º App åˆ—è¡¨ + å½“å‰åˆ†ç±» + ç´¯è®¡ä½¿ç”¨æ—¶é•¿
  - æ”¯æŒä¿®æ”¹åˆ†ç±»ï¼ˆç”Ÿäº§åŠ› / æ‘¸é±¼ / ä¸­æ€§ / æœªç»Ÿè®¡ï¼‰
  - åˆ†ç±»å˜æ›´åé‡æ–°è®¡ç®—ç»Ÿè®¡å€¼
  - æ·»åŠ éšç§è®¾ç½®å’Œæ•°æ®æ¸…ç†åŠŸèƒ½

- [ ] **æ—¶é—´å›æ”¾è§†å›¾**
  - å›æ”¾å…¥å£æŒ‰é’®ï¼ˆåº•éƒ¨è¿›åº¦æ¡å³ä¾§ï¼‰
  - å›æ”¾é¢æ¿ UIï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼šè®¡åˆ’ vs ä¸“æ³¨ï¼Œä¸‹åŠéƒ¨åˆ†ï¼šè¡Œä¸ºç»Ÿè®¡ï¼‰
  - æŒ‡æ ‡è®¡ç®— + æ•°æ®ç»‘å®š
  - å“åº”å¼å¸ƒå±€å’Œå¯è§†åŒ–ç»„ä»¶

### 9.2 åç«¯ï¼ˆå¯åç½®ï¼‰

**MVPé˜¶æ®µ**
- æ‰€æœ‰æ•°æ®å…ˆæœ¬åœ°å¤„ç†ï¼ˆSQLiteï¼‰
- ç»Ÿè®¡èšåˆåœ¨å®¢æˆ·ç«¯å®Œæˆ
- æ•°æ®å¯¼å‡ºå’Œå¤‡ä»½åŠŸèƒ½

**åç»­æ‰©å±•ï¼ˆå¯é€‰ï¼‰**
- è®¾è®¡ FocusSession & ActivitySession æ‰¹é‡ä¸Šä¼  API
- æä¾›æ¯æ—¥æ‘˜è¦æ¥å£ç»™å‰ç«¯ä½¿ç”¨
- å¤šè®¾å¤‡æ•°æ®åŒæ­¥æœºåˆ¶
- äº‘ç«¯ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½

---

## 5. å‘½å & å¯¹å¤–è¯æœ¯å»ºè®®

* åŠŸèƒ½åï¼š

  * **çº¢æ¸©ä¸“æ³¨ä»“**ï¼ˆRed Focus Chamber / Focus Modeï¼‰
  * **è¡Œä¸ºè¯†åˆ«ä¸æ—¶é—´ç»Ÿè®¡**
  * **æ—¶é—´å›æ”¾**

* å¯¹å¤–è§£é‡Šç»Ÿä¸€ç”¨è¯ï¼ˆç¤ºä¾‹ï¼‰ï¼š

  * ã€ŒæŠŠæŸä¸€æ®µæ—¶é—´ä¸¢è¿›çº¢æ¸©ä¸“æ³¨ä»“ï¼Œè¿™ 25 åˆ†é’Ÿï¼Œè¿™æ¡çº¿åªå¹²ä¸€ä»¶äº‹ï¼šå¸®ä½ å®ˆä½ä¸“æ³¨ã€‚ã€
  * ã€Œæ—¶é—´å›æ”¾ä¸ä¼šè¯„ä»·ä½ ï¼Œåªæ˜¯æŠŠä½ ç”»å¥½çš„è½¨é“ï¼Œå’Œä½ çœŸå®èµ°è¿‡çš„è·¯å¾„æ”¾åœ¨ä¸€èµ·ç»™ä½ çœ‹ã€‚ã€
  * ã€Œè¡Œä¸ºè¯†åˆ«ä¼šå‘Šè¯‰ä½ ï¼šç”µè„‘è¿™ä¸€æ•´å¤©ï¼Œå…¶å®éƒ½åœ¨å¹²äº›ä»€ä¹ˆâ€”â€”å“ªéƒ¨åˆ†æ˜¯è®¤çœŸå¹²æ´»ï¼Œå“ªéƒ¨åˆ†æ˜¯åå‰¯å…¶å®çš„æ‘¸é±¼ã€‚ã€

---
