# GaiYa每日进度条 - 商业化实施计划 v1.6.0

> **制定日期**: 2025-11-05
> **目标版本**: v1.6.0
> **预计完成**: 2026-03-31
> **核心目标**: 建立健康的freemium商业模式，用户体验与变现双赢

---

## 📊 商业化战略定位

### 核心理念
> **"让核心价值免费，让高级需求付费"**

### 与竞品的差异化策略

| 维度 | 竞品（极序等） | GaiYa每日进度条 |
|------|--------------|-----------------|
| 免费版限制 | 5个任务数量限制 | **无数量限制** |
| 付费动力 | 被迫升级（功能解锁） | **主动升级（增值服务）** |
| 核心功能 | 部分付费墙 | **完全免费** |
| AI功能 | 可能全部付费 | **每日20次免费，Pro无限** |
| 云同步 | 基础功能 | **Pro增值服务** |
| 开源性 | 闭源 | **完全开源** |

---

## 🎯 会员体系设计

### Free Tier（免费版）- 完整核心体验

**核心价值：完整的桌面进度条体验**

✅ **包含功能**:
- ✅ 无限任务数量（竞争优势）
- ✅ 所有预设主题和模板
- ✅ 完整桌面进度条功能（透明、置顶、穿透）
- ✅ 番茄工作法
- ✅ 基础任务统计
- ✅ 每日 3 次 AI 任务规划（满足基础使用）
- ✅ 本地数据存储
- ✅ 模板导入导出
- ✅ 12种预设作息模板

**配额限制**:
- AI任务规划：3次/天
- AI周报生成：1次/周
- AI对话查询：10次/天

**样式限制**:
- 仅基础样式（4种）
- 静态时间标记
- 无样式商店积分

---

### Pro Tier（专业版）- 增值服务

**定价策略**:
- 💰 月付：¥9.9/月
- 💰 年付：¥59/年（省51%，相当于¥4.92/月）
- 💰 终身：¥199（一次买断，永久使用）

**增值服务**:

#### 1️⃣ 个性化进度条样式（核心差异化）💎
- 🎨 **高级样式包（12+种）**
  - 动漫风格系列（樱花飘落、霓虹描边、二次元光效）
  - 赛博朋克系列（像素扫描、故障艺术、全息投影）
  - 自然主题系列（水波纹、极光、星空）
  - 科技感系列（电路板、数据流、粒子特效）
- ✨ **每月新增样式**（持续更新）
- 🎬 **动态时间标记**
  - 支持GIF/WebP动图
  - 粒子特效、发光效果
  - 自定义动画
- 🛒 **样式商店积分**
  - 每月10积分
  - 购买付费样式
  - 支持创作者作品

#### 2️⃣ AI Pro（智能增强）
- ♾️ **AI 任务规划：50次/天**（Free仅3次）
- 📊 **AI 时间分析报告**
  - 周报：任务完成率、高效时段分析
  - 月报：长期趋势、优化建议
- 💬 **AI 对话查询：100次/天**（Free仅10次）

#### 3️⃣ Cloud Sync（云端同步）
- ☁️ **多设备数据同步**
  - 工作电脑 + 家用电脑自动同步
  - 配置、任务、模板、主题全同步
- 🔄 **配置自动备份**
  - 保留最近30天备份
  - 一键回滚到历史版本
- 📱 **移动端查看（未来）**
  - 手机查看统计报告
  - 快捷记录任务

#### 4️⃣ Advanced Analytics（高级分析）
- 📈 **长期趋势分析**
  - 月度、季度、年度趋势图
  - 任务完成率变化
  - 时间分配演变
- 🏆 **成就系统**
  - 连续打卡天数
  - 任务完成里程碑
  - 效率达人徽章
- 📊 **详细报告导出**
  - PDF格式精美报告
  - 可视化图表（折线图、饼图、热力图）
  - 自定义报告时间范围

#### 5️⃣ 优先支持
- 🎫 **工单优先处理**
- 💬 **专属社区频道**
- 🚀 **新功能抢先体验**

---

## 🛠️ 技术架构选型

### 后端服务架构

```
┌─────────────────────────────────────────────────────┐
│                  GaiYa Client (Desktop)             │
│                    PySide6 App                      │
└───────────────┬─────────────────────────────────────┘
                │
                │ HTTPS
                ▼
┌─────────────────────────────────────────────────────┐
│              Vercel Serverless Functions            │
│  ┌──────────────┐  ┌──────────────┐  ┌───────────┐ │
│  │  Auth API    │  │ Payment API  │  │  AI API   │ │
│  └──────┬───────┘  └──────┬───────┘  └─────┬─────┘ │
└─────────┼──────────────────┼────────────────┼───────┘
          │                  │                │
          ▼                  ▼                ▼
┌─────────────────┐ ┌────────────────┐ ┌──────────────┐
│  Supabase Auth  │ │ Payment Gateway│ │ OpenAI API   │
│  - User Auth    │ │ - LemonSqueezy │ │ - GPT-4      │
│  - JWT Tokens   │ │ - Stripe       │ │              │
└─────────────────┘ └────────────────┘ └──────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────┐
│              Supabase PostgreSQL                    │
│  ┌──────────┐  ┌──────────────┐  ┌───────────────┐ │
│  │  users   │  │subscriptions │  │  user_data    │ │
│  │  tokens  │  │   payments   │  │   sync        │ │
│  └──────────┘  └──────────────┘  └───────────────┘ │
└─────────────────────────────────────────────────────┘
```

### 技术栈选择

#### 用户认证
- **服务**: Supabase Auth
- **方式**: Magic Link（无密码邮箱登录）+ OAuth（Google/GitHub）
- **理由**:
  - 免费额度充足（50,000 MAU）
  - 无需自建认证系统
  - 内置JWT管理
  - 支持第三方登录

#### 数据库
- **服务**: Supabase PostgreSQL
- **表设计**:
  ```sql
  -- 用户表
  CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email TEXT UNIQUE NOT NULL,
    display_name TEXT,
    tier TEXT DEFAULT 'free', -- free, pro, lifetime
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
  );

  -- 订阅表
  CREATE TABLE subscriptions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id),
    tier TEXT NOT NULL, -- pro_monthly, pro_yearly, lifetime
    status TEXT NOT NULL, -- active, canceled, expired
    started_at TIMESTAMP NOT NULL,
    expires_at TIMESTAMP,
    payment_provider TEXT, -- lemonsqueezy, stripe
    external_subscription_id TEXT,
    created_at TIMESTAMP DEFAULT NOW()
  );

  -- 支付记录表
  CREATE TABLE payments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id),
    subscription_id UUID REFERENCES subscriptions(id),
    amount DECIMAL(10,2) NOT NULL,
    currency TEXT DEFAULT 'CNY',
    status TEXT NOT NULL, -- pending, succeeded, failed
    payment_provider TEXT,
    external_payment_id TEXT,
    created_at TIMESTAMP DEFAULT NOW()
  );

  -- 云同步数据表
  CREATE TABLE user_sync_data (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id),
    data_type TEXT NOT NULL, -- config, tasks, themes, templates
    data JSONB NOT NULL,
    version INTEGER DEFAULT 1,
    device_id TEXT,
    synced_at TIMESTAMP DEFAULT NOW()
  );

  -- AI配额使用表（继续使用现有的quota表）
  ```

#### 支付集成
- **国内市场**: LemonSqueezy（推荐）或 Paddle
  - ✅ 支持支付宝、微信支付
  - ✅ 自动处理税务和发票
  - ✅ Webhook通知
  - ⚠️ 手续费较高（约5-8%）

- **国际市场**: Stripe
  - ✅ 信用卡支付
  - ✅ 低手续费（2.9% + ¥2）
  - ✅ 完善的API和文档

- **备选方案**: 面包多（国内）
  - ✅ 专注中国市场
  - ✅ 低手续费
  - ⚠️ 功能相对简单

**推荐**: LemonSqueezy（主）+ Stripe（辅）

#### 云存储
- **服务**: Supabase Storage（可选，用于大文件）
- **用途**: 用户上传的主题图片、自定义图标等
- **免费额度**: 1GB存储 + 2GB带宽/月

---

## 📅 分阶段实施计划

### 第一阶段：基础设施（3周，2025-11-05 → 2025-11-26）

#### Week 1: 用户认证系统（7天）

**目标**: 基于现有Supabase项目，扩展用户认证和订阅管理功能

**现有基础设施**:
- ✅ Supabase项目已配置（SUPABASE_URL, SUPABASE_ANON_KEY）
- ✅ user_quotas表已存在
- ✅ QuotaManager类已实现（api/quota_manager.py）
- ✅ 已支持free/pro两个tier

**任务清单**:

1. **扩展Supabase数据库表** (1天)
   - [ ] 创建users表（用户基本信息和认证）
   - [ ] 创建subscriptions表（订阅记录）
   - [ ] 创建payments表（支付历史）
   - [ ] 创建user_sync_data表（云同步数据）
   - [ ] 配置Auth设置（Magic Link、OAuth）
   - [ ] 配置Row Level Security (RLS)

2. **开发认证管理器** (3天)
   - [ ] 新建 `gaiya/core/auth_manager.py`
   - [ ] 实现邮箱Magic Link登录
   - [ ] 实现Google OAuth登录
   - [ ] 实现GitHub OAuth登录（可选）
   - [ ] JWT令牌管理（存储、刷新、验证）
   - [ ] 登录状态持久化（本地安全存储）

3. **开发订阅管理器** (2天)
   - [ ] 新建 `gaiya/core/subscription_manager.py`
   - [ ] 查询用户订阅状态
   - [ ] 会员等级检测（Free/Pro/Lifetime）
   - [ ] 订阅过期检测和处理
   - [ ] 优雅降级（Pro功能不可用时提示）

4. **前端UI开发** (1天)
   - [ ] 在 `config_gui.py` 添加登录/注册界面
   - [ ] 会员状态显示（头像、邮箱、等级）
   - [ ] 退出登录功能

**Vercel API端点**:
```python
# api/auth/magic-link.py - 发送登录链接
# api/auth/verify.py - 验证登录令牌
# api/auth/refresh.py - 刷新JWT令牌
# api/user/profile.py - 获取用户信息
# api/subscription/status.py - 查询订阅状态
```

**测试验收**:
- [ ] 用户可以通过邮箱注册并收到登录链接
- [ ] 用户可以通过Google账号登录
- [ ] 登录后可以查看会员状态
- [ ] 关闭应用后重新打开仍保持登录状态

---

#### Week 2: 支付集成（5天）

**目标**: 完成支付流程，用户可以购买Pro会员

**任务清单**:

1. **注册支付服务商** (1天)
   - [ ] 注册LemonSqueezy账号
   - [ ] 创建产品和价格方案
     - Pro月付：¥9.9/月
     - Pro年付：¥59/年
     - 终身版：¥199
   - [ ] 配置Webhook URL
   - [ ] 获取API密钥

2. **开发支付管理器** (2天)
   - [ ] 新建 `gaiya/core/payment_manager.py`
   - [ ] 创建Checkout会话
   - [ ] 获取支付链接
   - [ ] 处理支付成功回调
   - [ ] 处理订阅取消/续费

3. **Webhook处理** (1天)
   - [ ] 新建 `api/payment/webhook.py`
   - [ ] 验证Webhook签名（防重放攻击）
   - [ ] 处理 `payment.succeeded` 事件
   - [ ] 处理 `subscription.created` 事件
   - [ ] 处理 `subscription.canceled` 事件
   - [ ] 自动更新用户会员状态

4. **前端UI开发** (1天)
   - [ ] 在 `config_gui.py` 添加订阅购买UI
   - [ ] 展示价格方案（月付/年付/终身）
   - [ ] "升级到Pro"按钮
   - [ ] 打开支付页面（浏览器）
   - [ ] 支付成功后自动刷新会员状态

**Vercel API端点**:
```python
# api/payment/create-checkout.py - 创建支付会话
# api/payment/webhook.py - 接收支付通知
# api/payment/portal.py - 客户管理门户（取消订阅等）
```

**安全考虑**:
- [ ] Webhook签名验证
- [ ] 支付金额服务端验证（防篡改）
- [ ] 用户ID与订阅ID关联验证
- [ ] HTTPS加密传输

**测试验收**:
- [ ] 用户可以选择套餐并跳转到支付页面
- [ ] 完成支付后会员状态自动更新为Pro
- [ ] 支付失败有明确的错误提示
- [ ] Webhook能正确处理所有支付事件

---

#### Week 3: 测试与优化（3天）

**任务清单**:

1. **集成测试** (2天)
   - [ ] 完整流程测试（注册→登录→购买→激活）
   - [ ] 异常场景测试（网络断开、支付失败、Token过期）
   - [ ] 边界条件测试（订阅过期、降级处理）
   - [ ] 多设备登录测试

2. **安全审计** (1天)
   - [ ] API端点安全检查
   - [ ] 敏感信息加密检查
   - [ ] SQL注入防护验证
   - [ ] XSS攻击防护验证

**交付物**:
- ✅ 完整的用户认证系统
- ✅ 可运行的支付流程
- ✅ 会员状态检测机制
- ✅ 基础的Pro功能权限控制

---

### 第二阶段：Pro功能开发（4周，2025-11-27 → 2025-12-25）

#### Week 4-5: 个性化样式系统（10天）

**目标**: 实现进度条样式差异化，展现Pro版核心价值

**任务清单**:

1. **样式管理器开发** (3天)
   - [ ] 新建 `gaiya/core/style_manager.py`
   - [ ] 样式加载系统（QML + Assets）
   - [ ] 样式切换逻辑
   - [ ] 样式预览功能

2. **基础样式实现**（Free）(2天)
   - [ ] 经典纯色样式
   - [ ] 渐变色样式
   - [ ] 条纹样式
   - [ ] 半透明样式

3. **高级样式实现**（Pro）(4天)
   - [ ] 动漫风格系列（3种）
     - 樱花飘落
     - 霓虹描边
     - 二次元光效
   - [ ] 赛博朋克系列（3种）
     - 像素扫描线
     - 故障艺术
     - 全息投影
   - [ ] 自然主题系列（3种）
     - 水波纹
     - 极光
     - 星空

4. **样式UI开发** (1天)
   - [ ] 在config_gui.py添加"样式"tab
   - [ ] 样式预览网格
   - [ ] Pro样式锁定提示
   - [ ] 样式切换按钮

**数据库表**:
```sql
-- progress_bar_styles 表
-- time_markers 表
-- user_purchased_styles 表
```

**测试验收**:
- [ ] Free用户可以使用4种基础样式
- [ ] Pro用户可以使用所有12种高级样式
- [ ] 样式切换流畅无卡顿
- [ ] 样式预览准确

#### Week 4-5: AI Pro功能（并行开发，3天）

**任务清单**:

1. **AI配额升级** (1天)
   - [ ] 修改 `api/quota_manager.py`
   - [ ] Free用户：保持3次/天（已有）
   - [ ] Pro用户：50次/天
   - [ ] 配额查询UI优化

2. **AI时间分析报告** (2天)
   - [ ] 新建 `api/ai/analyze-time-usage.py`
   - [ ] 周报生成（任务完成率、高效时段）
   - [ ] 月报生成（长期趋势）
   - [ ] 前端UI：报告查看

**API端点**:
```python
# api/ai/analyze-time-usage.py
```

**测试验收**:
- [ ] Pro用户可以50次/天生成AI任务
- [ ] 周报/月报包含有价值的洞察

---

#### Week 6-7: 云端同步（10天）

**目标**: 实现多设备数据同步，提升Pro用户体验

**任务清单**:

1. **同步管理器开发** (5天)
   - [ ] 新建 `gaiya/core/sync_manager.py`
   - [ ] 数据上传：配置、任务、模板、主题
   - [ ] 数据下载：从云端拉取最新数据
   - [ ] 冲突解决：
     - 策略1：时间戳优先（最新的覆盖）
     - 策略2：用户选择（手动合并）
   - [ ] 增量同步：仅上传变更部分
   - [ ] 设备识别：生成唯一Device ID

2. **后端API开发** (3天)
   - [ ] `api/sync/upload.py` - 上传数据
   - [ ] `api/sync/download.py` - 下载数据
   - [ ] `api/sync/list-devices.py` - 查看已同步设备
   - [ ] `api/sync/history.py` - 同步历史记录
   - [ ] Supabase RLS策略：确保用户只能访问自己的数据

3. **前端UI开发** (2天)
   - [ ] 在 `config_gui.py` 添加"云同步"tab
   - [ ] 显示同步状态（上次同步时间、设备列表）
   - [ ] 手动同步按钮
   - [ ] 自动同步设置（启动时/关闭时/定时）
   - [ ] 同步历史查看
   - [ ] 回滚到历史版本

**数据结构**:
```json
{
  "user_id": "uuid",
  "device_id": "unique-device-id",
  "data_type": "config",
  "data": {
    // 完整的config.json内容
  },
  "version": 123,
  "synced_at": "2025-11-05T12:34:56Z"
}
```

**测试验收**:
- [ ] 设备A修改配置后，设备B可以同步获取
- [ ] 冲突场景下能正确处理（不丢失数据）
- [ ] 网络中断后恢复时能自动同步
- [ ] 用户可以查看和回滚历史版本

---

#### Week 8: 高级分析功能（5天）

**目标**: 提供深度数据洞察，证明Pro版价值

**任务清单**:

1. **长期趋势分析** (2天)
   - [ ] 扩展 `statistics_manager.py`
   - [ ] 月度趋势图（任务完成率、时间分配）
   - [ ] 季度对比
   - [ ] 年度总结
   - [ ] 使用 `matplotlib` 生成图表

2. **成就系统** (2天)
   - [ ] 新建 `gaiya/core/achievements.py`
   - [ ] 成就定义：
     - 🏆 连续打卡：7天、30天、100天
     - 🎯 任务达人：完成100、500、1000个任务
     - ⚡ 效率专家：连续7天完成率>90%
   - [ ] 成就徽章UI
   - [ ] 成就解锁动画

3. **PDF报告导出** (1天)
   - [ ] 使用 `reportlab` 或 `weasyprint`
   - [ ] 精美的PDF模板设计
   - [ ] 包含可视化图表
   - [ ] 自定义报告范围（本周/本月/自定义）

**测试验收**:
- [ ] 趋势图准确反映数据变化
- [ ] 成就系统能正确解锁
- [ ] PDF报告可以正常生成和打开

---

### 第三阶段：营销与上线（2周，2025-12-26 → 2026-01-09）

#### Week 9: 推荐计划（5天）

**任务清单**:

1. **推荐管理器** (3天)
   - [ ] 新建 `gaiya/core/referral_manager.py`
   - [ ] 生成邀请码（唯一）
   - [ ] 记录邀请关系
   - [ ] 计算邀请奖励：
     - 邀请5人 → 1个月Pro
     - 邀请10人 → 3个月Pro
   - [ ] 自动发放奖励

2. **后端API** (1天)
   - [ ] `api/referral/generate-code.py`
   - [ ] `api/referral/track.py` - 追踪邀请链接点击
   - [ ] `api/referral/stats.py` - 查看邀请统计

3. **前端UI** (1天)
   - [ ] "推荐好友"入口
   - [ ] 邀请码显示和复制
   - [ ] 邀请统计展示
   - [ ] 奖励领取按钮

**测试验收**:
- [ ] 用户可以生成邀请链接
- [ ] 好友通过链接注册后关系被正确记录
- [ ] 达到奖励条件后自动激活Pro

---

#### Week 10: 上线准备（5天）

**任务清单**:

1. **应用内引导** (2天)
   - [ ] 新建 `gaiya/ui/onboarding.py`
   - [ ] 新手引导流程：
     - 欢迎页面
     - 核心功能介绍（3-4页）
     - 可选登录提示
   - [ ] Pro功能介绍卡片（非侵入式）
   - [ ] 首次运行检测

2. **升级路径优化** (1天)
   - [ ] Free用户点击Pro功能时：
     - 显示功能介绍对话框
     - 展示价值点
     - "升级到Pro"按钮
   - [ ] 优雅的提示文案

3. **定价页面** (1天)
   - [ ] 在配置界面添加"升级"tab
   - [ ] 对比表格（Free vs Pro）
   - [ ] 价格展示（月付/年付/终身）
   - [ ] FAQ

4. **最终测试和发布** (1天)
   - [ ] 完整回归测试
   - [ ] 性能测试
   - [ ] 打包v1.6.0正式版
   - [ ] 发布Release Notes

---

## 💰 定价策略与优惠

### 标准定价
- 💎 Pro月付：¥9.9/月
- 💎 Pro年付：¥59/年（相当于¥4.92/月，省51%）
- 💎 终身版：¥199（一次买断）

### 早鸟优惠（限时）
- 🎉 首月优惠：¥9.9 → ¥4.9（限新用户）
- 🎉 年付促销：¥59 → ¥49（限前100名）
- 🎉 终身早鸟：¥199 → ¥149（限前50名）

### 推荐奖励
- 🎁 邀请5人注册 → 免费获得1个月Pro
- 🎁 邀请10人注册 → 免费获得3个月Pro
- 🎁 被邀请人首次付费 → 邀请人和被邀请人各得1周Pro

---

## 📊 成功指标（KPIs）

### 用户增长
- [ ] 注册用户：500+ (2026年3月底)
- [ ] 日活用户（DAU）：200+
- [ ] 周留存率：≥ 60%

### 付费转化
- [ ] Pro付费用户：100+
- [ ] 转化率：≥ 20%
- [ ] 月经常性收入（MRR）：≥ ¥1000
- [ ] 年度经常性收入（ARR）：≥ ¥12,000

### 用户满意度
- [ ] Pro用户次月留存：≥ 80%
- [ ] Pro用户NPS（净推荐值）：≥ 50
- [ ] 推荐转化：≥ 10%用户通过推荐注册

### 技术指标
- [ ] 支付成功率：≥ 95%
- [ ] API响应时间：P95 < 2秒
- [ ] 同步成功率：≥ 99%
- [ ] 应用崩溃率：< 0.1%

---

## 🎯 风险与应对

### 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| 支付集成失败 | 高 | 中 | 提前测试沙盒环境，准备备用方案 |
| Supabase配额不足 | 中 | 低 | 监控用量，升级到付费计划 |
| 同步冲突频繁 | 中 | 中 | 完善冲突解决策略，提供手动合并 |
| AI成本过高 | 高 | 中 | 控制Free配额，优化Prompt长度 |

### 商业风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| 付费转化率低 | 高 | 中 | A/B测试定价，优化价值传达 |
| 用户流失率高 | 高 | 低 | 提升产品体验，建立用户社区 |
| 竞品降价竞争 | 中 | 中 | 强化差异化功能，提升品牌认知 |
| 市场需求不足 | 高 | 低 | 早期小范围测试，快速迭代 |

---

## 📝 下一步行动

### 立即开始（本周）
1. [ ] 创建Supabase项目
2. [ ] 设计数据库表结构
3. [ ] 搭建用户认证系统框架
4. [ ] 注册LemonSqueezy账号

### 本月完成
1. [ ] 完成第一阶段（基础设施）
2. [ ] 开始第二阶段（Pro功能开发）

### 需要决策的问题
1. **支付方式优先级**：先做国内（支付宝/微信）还是国际（Stripe）？
   - 建议：先做国内，用户基础在中国

2. **OAuth登录方式**：必须支持Google吗？还是只用邮箱登录？
   - 建议：初期只做邮箱Magic Link，后续再加OAuth

3. **定价是否合理**：¥9.9/月，¥59/年，¥199终身
   - 建议：可以先做市场调研，看用户反馈

4. **Pro功能优先级**：AI Pro、云同步、高级分析，哪个最重要？
   - 建议：按顺序开发，AI Pro是核心差异化

---

**文档维护**:
- 制定日期：2025-11-05
- 负责人：开发团队
- 更新频率：每周更新进度
- 下次评审：2025-11-12

