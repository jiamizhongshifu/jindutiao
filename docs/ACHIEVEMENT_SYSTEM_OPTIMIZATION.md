# GaiYa 成就系统优化方案

> 作为2025年最专业的AI产品经理，基于对现有成就系统的全面审计，制定此优化方案

---

## 一、现状分析

### 1.1 当前系统概览

| 维度 | 现状 |
|------|------|
| 成就总数 | 11个 |
| 需求类型 | 5种 (continuous_days, total_tasks_completed, total_focus_hours, daily_completion_rate, weekly_completion_rate) |
| 稀有度等级 | 4级 (common, rare, epic, legendary) |
| 数据持久化 | JSON文件 (achievements.json) |
| UI展示 | 统计报告Tab页，卡片式布局 |

### 1.2 核心文件

- [gaiya/core/achievement_manager.py](../gaiya/core/achievement_manager.py) - 成就定义与检测逻辑
- [gaiya/core/motivation_engine.py](../gaiya/core/motivation_engine.py) - 数据聚合与回调机制
- [statistics_gui.py:3106-3616](../statistics_gui.py#L3106-L3616) - 成就UI与解锁弹窗
- [gaiya/data/achievements.json](../gaiya/data/achievements.json) - 成就状态持久化

### 1.3 已识别问题

1. **成就数量有限** - 仅11个成就，用户较快解锁完毕后缺乏新目标
2. **需求类型单一** - 缺少组合条件、时段限定、特殊行为等维度
3. **缺乏进度可见性** - 用户无法看到距离解锁还差多少
4. **无成就分类体系** - 所有成就混在一起，缺乏层次感
5. **激励机制薄弱** - 解锁后仅展示，无实质奖励或特权
6. **数据源利用不足** - behavior_analyzer、activity_collector等数据未被利用

---

## 二、优化目标

### 2.1 核心目标

1. **丰富性** - 成就数量从11个扩展到30+个
2. **多样性** - 需求类型从5种扩展到12+种
3. **可见性** - 所有成就显示解锁进度
4. **层次性** - 建立清晰的成就分类体系
5. **激励性** - 引入奖励机制提升用户动力
6. **灵活性** - 支持动态添加/配置成就

### 2.2 量化指标

| 指标 | 当前 | 目标 |
|------|------|------|
| 成就总数 | 11 | 35+ |
| 需求类型 | 5 | 12+ |
| 成就分类 | 0 | 5 |
| 进度显示 | 无 | 100% |
| 平均解锁周期 | 1-2周 | 1-6个月 |

---

## 三、优化方案

### 3.1 成就分类体系设计

建立5大成就分类：

```python
achievement_categories = {
    "consistency": {
        "name": "坚持之道",
        "icon": "flame",
        "color": "#FF6B35",
        "description": "记录你的持续使用天数"
    },
    "productivity": {
        "name": "效率大师",
        "icon": "lightning",
        "color": "#FFD700",
        "description": "完成任务相关成就"
    },
    "focus": {
        "name": "专注达人",
        "icon": "target",
        "color": "#4ECDC4",
        "description": "专注时间相关成就"
    },
    "explorer": {
        "name": "功能探索",
        "icon": "compass",
        "color": "#9B59B6",
        "description": "探索和使用各种功能"
    },
    "special": {
        "name": "特殊成就",
        "icon": "sparkles",
        "color": "#E91E63",
        "description": "限定时段或特殊条件解锁"
    }
}
```

### 3.2 新增需求类型

在现有5种基础上，新增7种需求类型：

| 需求类型 | 说明 | 示例 |
|----------|------|------|
| `time_slot_tasks` | 特定时段完成任务 | 早起完成3个任务(6:00-9:00) |
| `app_focus_hours` | 特定应用专注时长 | VSCode专注满10小时 |
| `streak_days` | 连续天数达标 | 连续7天完成率>80% |
| `category_tasks` | 分类任务完成数 | 完成50个工作类任务 |
| `first_action` | 首次行为触发 | 首次使用场景编辑器 |
| `combo_condition` | 组合条件 | 单日完成5任务+专注3小时 |
| `milestone` | 里程碑触发 | 使用满100天 |

### 3.3 成就进度系统

**数据结构扩展**：

```python
class Achievement:
    # 现有字段...

    # 新增字段
    category: str           # 所属分类
    progress: int = 0       # 当前进度
    target: int = 0         # 目标值
    progress_text: str = "" # 进度描述 (如 "3/7天")

    def get_progress_percentage(self) -> float:
        """获取进度百分比"""
        if self.target == 0:
            return 0.0
        return min(100.0, (self.progress / self.target) * 100)
```

**UI进度条展示**：

```
┌─────────────────────────────────┐
│ 🔥 早起鸟儿                      │
│ 连续7天在9点前开始工作            │
│ ████████░░░░░░░ 5/7天 (71%)     │
└─────────────────────────────────┘
```

### 3.4 成就奖励机制

引入3级奖励体系：

| 奖励类型 | 说明 | 实现方式 |
|----------|------|----------|
| **徽章展示** | 个人资料展示已解锁徽章 | 新增徽章墙UI |
| **主题解锁** | 解锁特定成就获得主题色 | 配置项+UI样式 |
| **称号系统** | 累计成就点数获得称号 | 计算总点数，匹配称号 |

**称号等级设计**：

```python
titles = {
    0: "时间新手",
    50: "时间学徒",
    100: "时间管理者",
    200: "时间大师",
    500: "时间领主",
    1000: "时间之神"
}
```

### 3.5 新增成就列表 (24个)

#### 坚持之道 (6个)

| ID | 名称 | 描述 | 条件 | 稀有度 | 点数 |
|----|------|------|------|--------|------|
| consistency_7 | 周末战士 | 周末也在使用GaiYa | 连续2个周末使用 | common | 10 |
| consistency_30 | 习惯养成 | 连续使用30天 | 30天连续 | rare | 30 |
| consistency_100 | 百日之约 | 连续使用100天 | 100天连续 | epic | 100 |
| consistency_365 | 年度陪伴 | 使用满一年 | 365天累计 | legendary | 200 |
| early_bird_7 | 早起鸟儿 | 连续7天9点前开始 | 时段检测 | rare | 25 |
| night_owl_7 | 夜猫子 | 连续7天22点后仍在工作 | 时段检测 | rare | 25 |

#### 效率大师 (6个)

| ID | 名称 | 描述 | 条件 | 稀有度 | 点数 |
|----|------|------|------|--------|------|
| task_100 | 百任务达人 | 完成100个任务 | 累计完成 | common | 15 |
| task_500 | 任务狂人 | 完成500个任务 | 累计完成 | rare | 50 |
| perfect_day | 完美一天 | 单日完成率100% | 单日达成 | common | 10 |
| perfect_week | 完美一周 | 连续7天完成率100% | 连续达成 | epic | 80 |
| speed_demon | 效率恶魔 | 单日完成10+任务 | 单日达成 | rare | 30 |
| category_master | 分类大师 | 单个分类完成100任务 | 分类统计 | rare | 35 |

#### 专注达人 (6个)

| ID | 名称 | 描述 | 条件 | 稀有度 | 点数 |
|----|------|------|------|--------|------|
| focus_10h | 专注新星 | 累计专注10小时 | 累计时长 | common | 10 |
| focus_100h | 专注达人 | 累计专注100小时 | 累计时长 | rare | 40 |
| focus_500h | 专注大师 | 累计专注500小时 | 累计时长 | epic | 100 |
| deep_work | 深度工作 | 单次专注超过2小时 | 单次时长 | rare | 25 |
| code_warrior | 代码战士 | VSCode专注满50小时 | 应用专注 | rare | 35 |
| writer | 写作者 | Word/Typora专注满20小时 | 应用专注 | rare | 30 |

#### 功能探索 (4个)

| ID | 名称 | 描述 | 条件 | 稀有度 | 点数 |
|----|------|------|------|--------|------|
| scene_creator | 场景设计师 | 创建首个自定义场景 | 首次行为 | common | 10 |
| ai_user | AI助手 | 首次使用AI生成任务 | 首次行为 | common | 10 |
| stats_viewer | 数据分析师 | 查看统计报告10次 | 累计次数 | common | 10 |
| power_user | 高级用户 | 解锁所有探索成就 | 组合条件 | rare | 40 |

#### 特殊成就 (2个)

| ID | 名称 | 描述 | 条件 | 稀有度 | 点数 |
|----|------|------|------|--------|------|
| new_year | 新年新气象 | 新年第一天使用GaiYa | 日期触发 | epic | 50 |
| anniversary | 周年纪念 | 使用GaiYa满一周年 | 日期计算 | legendary | 150 |

### 3.6 技术实现方案

#### 文件修改清单

| 文件 | 修改内容 |
|------|----------|
| `gaiya/core/achievement_manager.py` | 扩展Achievement类、新增需求类型处理、添加进度计算逻辑 |
| `gaiya/core/motivation_engine.py` | 新增数据聚合方法支持新需求类型 |
| `statistics_gui.py` | 重构成就Tab，添加分类筛选、进度条、徽章墙 |
| `gaiya/data/achievements.json` | 扩展数据结构支持进度存储 |
| `config.json` | 新增成就相关配置项 |

#### 实现步骤

**Phase 1: 基础架构升级 (预计代码改动: 300行)**

1. 扩展 `Achievement` 类，添加 `category`, `progress`, `target` 字段
2. 定义成就分类常量和颜色映射
3. 重构 `check_and_unlock()` 支持新需求类型
4. 升级JSON持久化结构

**Phase 2: 数据聚合扩展 (预计代码改动: 200行)**

1. 在 `MotivationEngine` 添加时段统计方法
2. 添加应用专注时长统计
3. 添加连续达标天数计算
4. 添加首次行为检测

**Phase 3: UI重构 (预计代码改动: 400行)**

1. 重构成就Tab为分类展示
2. 添加进度条组件
3. 实现徽章墙展示
4. 优化解锁弹窗动效

**Phase 4: 新成就配置 (预计代码改动: 150行)**

1. 配置24个新成就
2. 测试所有解锁条件
3. 调整数值平衡

---

## 四、实施计划

### 4.1 优先级排序

| 优先级 | 功能点 | 原因 |
|--------|--------|------|
| P0 | 成就进度显示 | 用户最期待的功能 |
| P0 | 成就分类体系 | 提升体验层次感 |
| P1 | 新增需求类型 | 丰富成就维度 |
| P1 | 新增24个成就 | 延长用户目标周期 |
| P2 | 称号系统 | 额外激励机制 |
| P2 | 徽章墙展示 | 成就展示空间 |

### 4.2 开发顺序

```
Week 1: Phase 1 (基础架构升级)
        - 扩展数据结构
        - 重构检测逻辑

Week 2: Phase 2 + Phase 3 (数据聚合 + UI重构)
        - 新增数据聚合方法
        - 重构成就Tab界面
        - 添加进度条组件

Week 3: Phase 4 (新成就配置)
        - 配置新成就
        - 测试与平衡调整
        - 发布v1.8.0
```

---

## 五、风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 数据迁移兼容性 | 已有用户成就数据丢失 | 设计向后兼容的JSON结构 |
| 性能影响 | 频繁检测影响性能 | 使用批量检测+缓存机制 |
| 数值不平衡 | 成就过易/过难解锁 | 参考行业数据设计，上线后持续调整 |

---

## 六、成功指标

1. **成就解锁率**: 用户平均解锁成就数提升50%
2. **用户留存**: 7日留存率提升10%
3. **使用时长**: 日均使用时长提升15%
4. **用户反馈**: 成就系统满意度评分≥4.5/5

---

## 七、图标设计方案

详见 [ACHIEVEMENT_ICONS_DESIGN.md](ACHIEVEMENT_ICONS_DESIGN.md)

---

**方案版本**: v1.0
**制定日期**: 2024-12-16
**制定人**: AI产品经理
