# 快速测试指南 - 刷新功能

## 🎯 测试目标
验证支付成功后会员状态刷新功能是否正常工作。

---

## ✅ 测试步骤

### 步骤1: 验证修复已应用
```bash
# 运行自动化测试
python test_payment_refresh.py
```

**期望结果**:
```
✓ 通过 - 订阅状态API
✓ 通过 - 会员UI刷新逻辑
✓ 通过 - 个人中心刷新按钮
✓ 通过 - 国际化翻译

总计: 4/4 项测试通过
🎉 所有测试通过!修复已成功应用。
```

---

### 步骤2: 测试开发版
```bash
# 启动应用
python main.py
```

#### 2.1 检查刷新按钮
1. 点击托盘图标,打开配置管理器
2. 切换到"个人中心"标签页
3. **检查**: 右上角是否有"🔄 刷新"按钮

**期望位置**:
```
┌─────────────────────────────────────────────┐
│ 账号管理                                     │
│ 邮箱: xxx@xxx.com | 会员: FREE              │
│              [🔄 刷新] ← 这里  [退出登录]   │
└─────────────────────────────────────────────┘
```

#### 2.2 测试手动刷新
1. 点击"🔄 刷新"按钮
2. **观察**: 是否弹出"刷新中..."对话框
3. **等待**: 1-2秒
4. **检查**: 对话框是否自动关闭
5. **检查**: 是否弹出"刷新成功"提示
6. **点击**: "确定"关闭提示
7. **验证**: 页面是否重新加载

**控制台日志**:
```
[ACCOUNT] 用户手动刷新会员状态...
[ACCOUNT] 会员状态刷新成功: tier=free, active=False
```

#### 2.3 测试自动刷新 (可选)
如果你有测试环境可以完成支付:

1. 在个人中心点击"立即购买"
2. 完成支付
3. **观察控制台**:
```
[MEMBERSHIP] 开始刷新会员状态...
[MEMBERSHIP] 会员状态刷新成功: tier=pro, active=True
[MEMBERSHIP] ✓ 会员升级确认成功!
```
4. **等待3-5秒**
5. 返回个人中心,会员状态应该已更新

---

### 步骤3: 测试打包版 (重要!)
```bash
# 快速增量打包
cmd /c build-fast.bat
```

#### 3.1 等待打包完成
```
正在打包...
打包完成！
exe路径: dist\GaiYa-v1.6.exe
```

#### 3.2 启动exe测试
```bash
cd dist
.\GaiYa-v1.6.exe
```

#### 3.3 重复步骤2的所有测试
- [ ] 检查刷新按钮是否显示
- [ ] 点击刷新按钮是否正常
- [ ] 对话框是否自动关闭
- [ ] 刷新成功提示是否显示
- [ ] 页面是否正确刷新

---

## 🐛 常见问题排查

### 问题1: 没有看到刷新按钮
**原因**: 未登录或账户标签页未加载

**解决方案**:
1. 确认已登录 (个人中心显示邮箱)
2. 切换到其他标签页再切换回来
3. 重启应用

---

### 问题2: 点击刷新按钮无反应
**原因**: 网络问题或API未部署

**控制台日志**:
```
[ACCOUNT] 刷新失败: 连接超时
```

**解决方案**:
1. 检查网络连接
2. 确认API已部署 (https://api.gaiyatime.com/api/subscription-status)
3. 查看控制台完整错误信息

---

### 问题3: 对话框不会自动关闭
**原因**: 修复未正确应用

**检查方法**:
```bash
# 查看最新提交
git log --oneline -2
```

**期望输出**:
```
eb92979 fix: 修复刷新会员状态时加载对话框无法关闭的问题
28c802e fix: 修复支付成功后会员状态不刷新问题
```

**解决方案**:
1. 确认代码已更新
2. 重新编译: `python -m py_compile config_gui.py`
3. 重启应用

---

### 问题4: 刷新后仍显示旧状态
**原因**: 后端数据未更新或缓存问题

**检查步骤**:
1. 查看控制台日志中的 `tier` 值
2. 确认支付是否真的完成
3. 等待30秒后重试
4. 尝试退出登录再重新登录

---

## 📋 测试检查清单

### 开发环境 (python main.py)
- [ ] 自动化测试通过
- [ ] 刷新按钮显示正常
- [ ] 点击刷新按钮触发加载对话框
- [ ] 加载对话框自动关闭
- [ ] 显示刷新成功提示
- [ ] 页面正确刷新
- [ ] 控制台日志输出正常
- [ ] 鼠标悬停显示工具提示

### 打包环境 (GaiYa-v1.6.exe)
- [ ] 刷新按钮显示正常
- [ ] 点击刷新按钮正常工作
- [ ] 对话框行为正确
- [ ] 刷新成功后页面更新
- [ ] 无崩溃或错误
- [ ] 性能流畅

### 边界情况
- [ ] 网络断开时点击刷新 → 显示错误提示
- [ ] 快速多次点击刷新 → 不崩溃
- [ ] 刷新过程中切换标签页 → 不影响刷新
- [ ] 刷新过程中关闭窗口 → 不崩溃

---

## 🎬 视频录制建议

如果要录制演示视频:

### 场景1: 手动刷新演示
1. 打开个人中心
2. 指向"🔄 刷新"按钮 (显示工具提示)
3. 点击刷新按钮
4. 显示"刷新中..."对话框
5. 对话框自动关闭
6. 显示"刷新成功"提示
7. 页面刷新完成

**时长**: ~10秒

### 场景2: 支付后自动刷新演示
1. 点击"立即购买"
2. 完成支付流程
3. 返回应用
4. 等待3-5秒 (控制台显示刷新日志)
5. 打开个人中心
6. 会员状态已更新

**时长**: ~30秒

---

## 📊 测试报告模板

```markdown
## 测试报告 - 刷新功能

**测试日期**: 2025-12-02
**测试环境**: Windows 10 / Python 3.11.9
**测试版本**: v1.6.8

### 测试结果

#### 开发环境
- 自动化测试: ✅ 通过
- 手动刷新: ✅ 正常
- 对话框关闭: ✅ 正常
- 日志输出: ✅ 正常

#### 打包环境
- 刷新按钮: ✅ 显示
- 刷新功能: ✅ 正常
- 对话框行为: ✅ 正常
- 性能: ✅ 流畅

### 发现的问题
(如果有)

### 总体评价
✅ 功能正常,可以发布

**测试人**: _______
**签名**: _______
```

---

## 🚀 测试完成后

### 如果所有测试通过:
```bash
# 推送到远程仓库
git push origin main

# 准备发布新版本
# 1. 更新 CHANGELOG.md
# 2. 创建 GitHub Release
# 3. 上传 exe 文件
```

### 如果发现问题:
1. 记录问题现象
2. 保存控制台日志
3. 截图或录屏
4. 报告问题给开发者

---

**测试指南版本**: v1.0
**最后更新**: 2025-12-02
**预计测试时间**: 15-20分钟
