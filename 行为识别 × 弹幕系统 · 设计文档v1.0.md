# ğŸ§© **ã€Šè¡Œä¸ºè¯†åˆ« Ã— å¼¹å¹•ç³»ç»Ÿ Â· è®¾è®¡æ–‡æ¡£ï¼ˆv1.0ï¼‰ã€‹**

> é€‚ç”¨äºï¼šGaiYa æ¯æ—¥è¿›åº¦æ¡ Â· å¼¹å¹•äº’åŠ¨æ¨¡å—
> ä½œè€…ï¼šChatGPTï¼ˆååŒï¼šç”¨æˆ·ï¼‰
> çŠ¶æ€ï¼šå¯ä½œä¸ºäº§å“è§„èŒƒ/å¼€å‘è§„èŒƒç›´æ¥ä½¿ç”¨

---

# 1. **ç³»ç»Ÿæ•´ä½“æ¶æ„**

å¼¹å¹•ç³»ç»Ÿä¾èµ–ç”¨æˆ·è¡Œä¸ºæ•°æ®ã€‚ä¸¤è€…éœ€æ·±åº¦æ•´åˆï¼Œæ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             è¡Œä¸ºé‡‡é›†å±‚ (Activity Collector)        â”‚
â”‚  - æ´»è·ƒçª—å£ç›‘æ§                                  â”‚
â”‚  - App è¯†åˆ«                                      â”‚
â”‚  - Chrome/Browser URL & Title é‡‡é›†               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è¡Œä¸ºè¯†åˆ«å¼•æ“ (Activity Recognition)      â”‚
â”‚  - App åˆ†ç±»ï¼ˆbrowser / IDE / IM / video â€¦ï¼‰       â”‚
â”‚  - åŸŸååˆ†ç±»ï¼ˆcode / video / social / docâ€¦ï¼‰       â”‚
â”‚  - å†…å®¹æ¨¡å¼ ContentMode (production/consumptionâ€¦) â”‚
â”‚  - çŠ¶æ€è¶‹åŠ¿åˆ†æï¼ˆç–²åŠ³ / æ‘¸é±¼ / ä¸“æ³¨ï¼‰              â”‚
â”‚  - æŒç»­æ—¶é•¿è®¡ç®—ï¼ˆactive_duration_secï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å¼¹å¹•æ—¶æœºè°ƒåº¦å™¨ (Danmaku Timing Engine)       â”‚
â”‚  - çŠ¶æ€äº‹ä»¶è§¦å‘                                   â”‚
â”‚  - å†·å´ç³»ç»Ÿï¼ˆå…¨å±€/ç±»å‹ï¼‰                           â”‚
â”‚  - æ¦‚ç‡è°ƒåº¦å™¨ï¼ˆæƒé‡æ¨¡å‹ï¼‰                           â”‚
â”‚  - èŠ‚å¥æŠ–åŠ¨ï¼ˆéšæœºåç§» jitterï¼‰                      â”‚
â”‚  - åˆå¹¶å¤šäº‹ä»¶ï¼ˆDe-noise èšåˆï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¼¹å¹•ç”Ÿæˆå™¨ (Danmaku Generator)          â”‚
â”‚  - è§’åº¦åˆ†ç±»ï¼ˆåæ§½/è°ƒä¾ƒ/é¼“åŠ±/è§‚å¯Ÿ/åƒç“œ/å»ºè®®ï¼‰         â”‚
â”‚  - æ¨¡æ¿ç³»ç»Ÿï¼ˆå˜é‡æ³¨å…¥ï¼‰                             â”‚
â”‚  - å±•ç¤ºæ§åˆ¶ï¼ˆé¿å…å¹²æ‰°ç”¨æˆ·ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 2. **è¡Œä¸ºè¯†åˆ«è®¾è®¡ï¼ˆActivity Recognitionï¼‰**

## 2.1 é‡‡é›†å­—æ®µ

è¡Œä¸ºé‡‡é›†å±‚éœ€æä¾›ï¼š

```json
{
  "app": "chrome.exe",
  "window_title": "GitHub - README.md",
  "url": "https://github.com/org/repo",
  "timestamp": 1733638120
}
```

---

## 2.2 App åˆ†ç±»ï¼ˆAppTypeï¼‰

```text
browser / ide / office / im / video / player / game / tool / system / other
```

æ˜ å°„ç¤ºä¾‹ï¼š

* Chrome / Edge â†’ browser
* VSCode / Cursor â†’ ide
* Bilibili.exe / YouTube Web â†’ video
* å¾®ä¿¡ / Discord â†’ im

---

## 2.3 åŸŸååˆ†ç±»ï¼ˆDomainCategoryï¼‰

é€šè¿‡ JSON è§„åˆ™é…ç½®ï¼š

```jsonc
{
  "github.com":    { "category": "code",   "mode": "production" },
  "gitlab.com":    { "category": "code",   "mode": "production" },
  "notion.so":     { "category": "doc",    "mode": "production" },
  "docs.google.com": { "category": "doc", "mode": "production" },

  "bilibili.com":  { "category": "video",  "mode": "consumption" },
  "youtube.com":   { "category": "video",  "mode": "consumption" },

  "weibo.com":     { "category": "social", "mode": "consumption" },
  "xiaohongshu.com": { "category": "social","mode": "consumption" },

  "jd.com":        { "category": "shopping","mode": "consumption" }
}
```

---

## 2.4 å†…å®¹æ¨¡å¼ï¼ˆContentModeï¼‰

æœ€ç»ˆæ¨¡å¼ç»Ÿä¸€ä¸ºï¼š

```
production   â†’ åˆ›é€ ï¼ˆå†™ä»£ç /å†™æ–‡æ¡£/åŠå…¬ï¼‰
consumption  â†’ æ¶ˆè´¹ï¼ˆè§†é¢‘/ç¤¾äº¤/è´­ç‰©ï¼‰
neutral      â†’ èŠå¤©å·¥å…·/é‚®ç®±/è®¾ç½®ç±»
unknown      â†’ æ— æ³•åˆ¤æ–­
```

åˆ¤æ–­ä¼˜å…ˆçº§ï¼š

1. åŸŸåè§„åˆ™
2. æ ‡é¢˜å…³é”®è¯
3. AppType é»˜è®¤å€¼
4. å›é€€ä¸º unknown

---

## 2.5 çŠ¶æ€è¶‹åŠ¿ï¼ˆBehavior Trendï¼‰

è¡Œä¸ºè¯†åˆ«ä¼šè¾“å‡ºå¤šä¸ªè¡Œä¸ºè¶‹åŠ¿ï¼š

| è¶‹åŠ¿           | å†³å®šæ–¹å¼                                |
| ------------ | ----------------------------------- |
| focus_steady | production æ¨¡å¼æŒç»­ â‰¥ 20â€“30 åˆ†é’Ÿ          |
| moyu_start   | å½“å‰ä»»åŠ¡ä¸ºâ€œç”Ÿäº§â€ï¼Œä½†è¿›å…¥ consumption æ¨¡å¼ â‰¥ 3 åˆ†é’Ÿ |
| moyu_steady  | consumption æŒç»­ â‰¥ 15 åˆ†é’Ÿ              |
| task_shift   | åˆ‡æ¢ä»»åŠ¡                                |
| mode_switch  | production â†”ï¸ consumption åˆ‡æ¢        |
| fatigue      | åœç•™ä¹… + é¼ æ ‡/è¾“å…¥å‡å°‘                       |

è¾“å‡ºæ ¼å¼ï¼š

```json
{
  "mode": "production",
  "domain": "github.com",
  "domain_category": "code",
  "active_duration_sec": 1250,
  "trend": "focus_steady"
}
```

---

# 3. **å¼¹å¹•æ—¶æœºè°ƒåº¦å™¨ï¼ˆTiming Engineï¼‰**

æ ¸å¿ƒç›®æ ‡ï¼š
**ä¸è¦æŒ‰å›ºå®šæ—¶é—´å‘é€å¼¹å¹•ï¼Œè€Œæ˜¯â€œäº‹ä»¶é©±åŠ¨ + æ¦‚ç‡è°ƒåº¦ + éšæœºæŠ–åŠ¨â€ã€‚**

---

## 3.1 çŠ¶æ€äº‹ä»¶ï¼ˆTrigger Eventsï¼‰

ä»¥ä¸‹äº‹ä»¶ä¼šè¿›å…¥æ—¶æœºè®¡ç®—ï¼Œä½†ä¸ä¿è¯ä¸€å®šå‘é€å¼¹å¹•ï¼š

### A. çŠ¶æ€åˆ‡æ¢ç±»ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰

| äº‹ä»¶          | æè¿°                       |
| ----------- | ------------------------ |
| mode_switch | production â†” consumption |
| task_start  | å¼€å§‹ä»»åŠ¡                     |
| task_end    | ç»“æŸä»»åŠ¡                     |
| task_switch | åˆ‡æ¢ä»»åŠ¡                     |

### B. æŒç»­è¡Œä¸ºç±»

| äº‹ä»¶               | æè¿°         |
| ---------------- | ---------- |
| focus_steady     | ä¸“æ³¨è¶…è¿‡å›ºå®šé˜ˆå€¼   |
| moyu_start       | å·¥ä½œæ—¶æ®µè¿›å…¥æ¶ˆè´¹è¡Œä¸º |
| moyu_steady      | æŒç»­æ‘¸é±¼è¶…è¿‡é˜ˆå€¼   |
| fatigue_detected | ç–²åŠ³ä¿¡å·       |

### C. å¼±äº‹ä»¶

å¼±äº‹ä»¶ç”¨äºè¾…åŠ©ï¼Œä½†æ˜¯ä¸ä¼šç›´æ¥è§¦å‘å¼¹å¹•ï¼š

* æ»šåŠ¨é€Ÿåº¦å¼‚å¸¸
* é¢‘ç¹é¡µé¢åˆ‡æ¢
* åœç•™è¿‡ä¹…ä¸åŠ¨

---

## 3.2 å†·å´ç³»ç»Ÿï¼ˆCooldownï¼‰

ä¸ºäº†é¿å…åˆ·å±ï¼š

### å…¨å±€å†·å´

```
å…¨å±€é—´éš”ï¼š4â€“7 åˆ†é’Ÿï¼ˆéšæœºï¼‰
```

### ç±»å‹å†·å´

| å¼¹å¹•ç±»å‹ | å†·å´æ—¶é—´    |
| ---- | ------- |
| åæ§½   | â‰¥ 10min |
| è°ƒä¾ƒ   | â‰¥ 7min  |
| é¼“åŠ±   | â‰¥ 8min  |
| å»ºè®®   | â‰¥ 12min |
| åƒç“œ   | â‰¥ 6min  |
| è§‚å¯Ÿ   | â‰¥ 5min  |

---

## 3.3 æ¦‚ç‡è°ƒåº¦å™¨ï¼ˆWeighted Probabilityï¼‰

æ¯ä¸ªäº‹ä»¶ä¸ä¼šå¿…å®šè§¦å‘ï¼Œéœ€è¦æŒ‰æƒé‡è®¡ç®—ï¼š

```
final_prob = base_prob Ã— mood_factor Ã— trend_factor Ã— novelty_factor Ã— random_noise
```

ç¤ºä¾‹ï¼š

* è‹¥åˆšä» Bç«™å›åˆ°ä»£ç ï¼ˆæ¶ˆè´¹ â†’ ç”Ÿäº§ï¼‰
  â†’ trend_factor=1.4
* æœ€è¿‘å‘è¿‡é¼“åŠ±å¼¹å¹•
  â†’ novelty_factor=0.3
* æ­£åœ¨é«˜ä¸“æ³¨åŒºé—´
  â†’ mood_factor=1.3

æœ€ç»ˆ > 0.5 æ‰ä¼šè¿›å…¥å€™é€‰æ± ã€‚

---

## 3.4 èŠ‚å¥æŠ–åŠ¨ï¼ˆTiming Jitterï¼‰

å³ä½¿äº‹ä»¶è§¦å‘ï¼Œä¹Ÿä¸ä¼šç«‹å³å‘å¼¹å¹•ï¼š

```
delay = Random(-30 sec, +180 sec)
trigger_time = event_time + delay
```

è‡ªç„¶ã€ä¸è§„å¾‹ã€‚

---

## 3.5 äº‹ä»¶èšåˆï¼ˆEvent Mergeï¼‰

è‹¥çŸ­æ—¶é—´å†…å¤šä¸ªäº‹ä»¶å‘ç”Ÿï¼ˆä¾‹å¦‚è¿ç»­åˆ‡æ¢é¡µé¢ï¼‰ï¼š

* åˆå¹¶ä¸ºä¸€ä¸ªâ€œç»¼åˆè§‚å¯Ÿâ€å¼¹å¹•
* é¿å…è¿å‘ä¸‰æ¡

---

## 3.6 æ—¶é—´æ®µè°ƒèŠ‚ï¼ˆCircadian Rhythmï¼‰

ä¸åŒæ—¶é—´æ®µå¼¹å¹•å€¾å‘ä¸åŒï¼š

| æ—¶é—´æ®µ | å¼¹å¹•å€¾å‘    | é™åˆ¶        |
| --- | ------- | --------- |
| ä¸Šåˆ  | é¼“åŠ± + è§‚å¯Ÿ | å°‘é‡åæ§½      |
| ä¸‹åˆ  | åæ§½ + è°ƒä¾ƒ | å¯ç¨å¤š       |
| æ™šä¸Š  | åƒç“œ + è°ƒä¾ƒ | å»ºè®®ç±»å‡å°‘     |
| æ·±å¤œ  | æ¸©å’Œè§‚å¯Ÿ    | ç¦æ­¢å»ºè®®ä¸ä¸¥è‚ƒæé†’ |

---

# 4. **å¼¹å¹•ç”Ÿæˆå™¨ï¼ˆDanmaku Generatorï¼‰**

åŸºäºè¡Œä¸ºè¯†åˆ« & æ—¶æœºè°ƒåº¦æœ€ç»ˆç»“æœï¼Œç”Ÿæˆå®é™…å¼¹å¹•ã€‚

---

## 4.1 å¼¹å¹•è§’åº¦ï¼ˆToneï¼‰

```
TUTCAO     = åæ§½
TIAOKAN    = è°ƒä¾ƒ
ENCOURAGE  = é¼“åŠ±
OBSERVE    = è§‚å¯Ÿ
CHIGUA     = åƒç“œ
SUGGEST    = å»ºè®®
```

---

## 4.2 æ¨¡æ¿ç³»ç»Ÿ

æ¨¡æ¿ç¤ºä¾‹ï¼š

### åæ§½ï¼ˆå·¥ä½œæ—¶åˆ·Bç«™ï¼‰

```
â€œè¿™æ³¢ `{domain}` çœ‹çš„æ˜¯çœŸè®¤çœŸï¼Œè¿›åº¦ `{progress}%` å½“æˆ‘æ²¡çœ‹åˆ°ğŸ˜â€
```

### é¼“åŠ±ï¼ˆä¸“æ³¨30åˆ†é’Ÿï¼‰

```
â€œç¨³æ€ä¸“æ³¨ `{elapsed}` åˆ†é’Ÿäº†ï¼Œä»Šå¤©çš„ä½ æ˜¯çœŸåœ¨å¹²æ´»ğŸ”¥â€
```

### å»ºè®®ï¼ˆç–²åŠ³ä¿¡å·ï¼‰

```
â€œæ„Ÿè§‰ä½ æœ‰ç‚¹å¡å£³ï¼Ÿä¸å¦‚ç»™ `{task_name}` æ¥ä¸ª 5 åˆ†é’Ÿæ”¶å°¾å†²åˆºã€‚â€
```

### åƒç“œï¼ˆåˆæ³•æ‘¸é±¼æ—¶é—´ï¼‰

```
â€œè®°ä¸€ç¬”ï¼šè¿™æ˜¯ä»Šå¤©ç¬¬ N æ¬¡åƒç“œ ğŸ‰ï¼ŒçŠ¶æ€ç»´æŒå¾—ä¸é”™ã€‚â€
```

æ¨¡æ¿æ”¯æŒå˜é‡ï¼š

* `{task_name}`
* `{progress}`
* `{domain}`
* `{domain_category}`
* `{elapsed}`
* `{time_period}`

---

# 5. **æ•°æ®æ¨¡å‹ï¼ˆå¯ç›´æ¥ç”¨äºå¼€å‘ï¼‰**

## BehaviorInfo

```python
class BehaviorInfo:
    app: str
    app_type: str
    url: str
    domain: str
    domain_category: str
    mode: str  # production/consumption/neutral/unknown
    active_duration_sec: int
    trend: Optional[str]
```

## DanmakuTriggerEvent

```python
class DanmakuTriggerEvent:
    event_type: str     # focus_steady / mode_switch / moyu_start / ...
    timestamp: int
    behavior: BehaviorInfo
    task_context: TaskInfo
```

## DanmakuCandidate

```python
class DanmakuCandidate:
    tone: DanmakuTone
    template: str
    final_prob: float
    scheduled_time: int
```

---

# 6. **å¼¹å¹•å‡ºç°ç­–ç•¥çŸ©é˜µ**

| çŠ¶æ€       | è¡Œä¸ºç±»å‹              | å¼¹å¹•è§’åº¦    |
| -------- | ----------------- | ------- |
| ä»å·¥ä½œåˆ‡æ¢åˆ°æ‘¸é±¼ | mode_switch       | åæ§½ / è°ƒä¾ƒ |
| ä»æ‘¸é±¼å›åˆ°å·¥ä½œ  | mode_switch       | é¼“åŠ± / è°ƒä¾ƒ |
| é•¿æ—¶é—´ä¸“æ³¨    | focus_steady      | é¼“åŠ± / è§‚å¯Ÿ |
| é•¿æ—¶é—´æ‘¸é±¼    | moyu_steady       | åæ§½ / å»ºè®® |
| ç–²åŠ³è¶‹åŠ¿å‡ºç°   | fatigue           | å»ºè®®ï¼ˆè½»åº¦ï¼‰  |
| åˆæ³•å¨±ä¹æ—¶é—´   | consumption + å¤œæ™š  | åƒç“œ / è°ƒä¾ƒ |
| å·¥ä½œæ—¶é—´è½»å¾®åˆ†å¿ƒ | consumption <5min | è§‚å¯Ÿ      |

---

# 7. **æœªæ¥æ‰©å±•ï¼ˆv2.0è§„åˆ’ï¼‰**

* è¡Œä¸ºè¯†åˆ«å¢åŠ è¾“å…¥äº‹ä»¶é€Ÿç‡ï¼ˆé¼ æ ‡ç§»åŠ¨ã€è¾“å…¥èŠ‚å¥ï¼‰
* å¯è®­ç»ƒçš„ä¸ªæ€§åŒ–å¼¹å¹•åå¥½æ¨¡å‹ï¼ˆè®°ä½ç”¨æˆ·å–œæ¬¢ä»€ä¹ˆè§’åº¦ï¼‰
* å¼¹å¹•å¼ºåº¦è‡ªåŠ¨è°ƒæ•´ï¼ˆé«˜å‹æ—¶æœŸå°‘åæ§½ï¼‰
* æ—¶é—´å›æ”¾é¡µé¢å±•ç¤º production/consumption æ¯”ä¾‹
* â€œæ‘¸é±¼çƒ­åŠ›å›¾â€ä¸å¼¹å¹•è”åŠ¨åˆ†æ