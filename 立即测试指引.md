# 🧪 立即测试指引

**执行时间**: 2025-12-01 23:38
**版本**: GaiYa v1.6.6 (Bug修复版, 23:31打包)

---

## ✅ 已完成的操作

1. ✅ **关闭旧进程** - 所有旧版本已关闭
2. ✅ **备份日志** - 旧日志已保存为 `gaiya.log.backup.txt`
3. ✅ **清理日志** - 旧日志已删除,确保新日志清晰
4. ✅ **启动新版本** - 最新版本 (23:31) 已启动

---

## 🧪 立即测试 (2分钟)

### 第1步: 打开统计报告 (10秒)

**操作**:
- 右键点击托盘图标
- 选择 `📊 统计报告`

**预期**:
- ✅ 统计报告窗口打开
- ✅ 看到 "🤖 AI推理数据摘要" 区域
- ✅ 看到 "🔄 手动生成推理" 按钮

---

### 第2步: 点击手动生成推理 (10秒)

**操作**:
- 点击 `🔄 手动生成推理` 按钮

**预期**:
- ✅ 按钮**立即**变为 "🔄 正在执行推理..."
- ✅ 按钮禁用 (不可点击)

---

### 第3步: 等待推理完成 (5-10秒)

**预期**:
- ✅ 5-10秒后弹出对话框
- ✅ 对话框标题: "✅ 推理完成"
- ✅ 对话框内容:
  ```
  任务完成推理已生成!

  📊 共推理 14 个任务
  💡 批量确认窗口即将自动打开,请确认或修正任务完成度。

  提示: 如果窗口未弹出,请点击下方"确认/修正任务完成度"按钮。
  ```

**如果卡住超过30秒**:
❌ 说明仍有问题,请立即执行"第4步:查看日志"

---

### 第4步: 查看日志验证 (30秒)

**操作**:
```bash
# 方法1: 用记事本打开
notepad dist\gaiya.log

# 方法2: 查看最后50行
cd dist
tail -50 gaiya.log
```

**搜索关键词**: `[手动推理]`

**成功的日志** (应该看到):
```
2025-12-01 23:38:XX - INFO - [手动推理] 启动推理线程
2025-12-01 23:38:XX - INFO - [手动推理] 开始执行: 2025-12-01
2025-12-01 23:38:XX - INFO - [手动推理] 调用调度器执行推理
2025-12-01 23:38:XX - INFO - 开始执行每日推理: 2025-12-01
2025-12-01 23:38:XX - INFO - 找到 14 个任务,开始推理...
2025-12-01 23:38:XX - INFO - 推理完成: 14/14 个任务
2025-12-01 23:38:XX - INFO - 保存推理结果: 14 条记录
2025-12-01 23:38:XX - INFO - [手动推理] 推理完成,耗时: 6.2秒
```

**失败的日志** (如果看到):
```
ERROR - 手动推理执行失败: cannot access local variable 'QMetaObject'
```
→ ❌ 说明仍在使用旧版本,请查看"故障排除"部分

---

## ✅ 成功标志总结

### 界面表现
- ✅ 点击按钮后,按钮立即变为 "正在执行推理..."
- ✅ 5-10秒后弹出 "✅ 推理完成" 对话框
- ✅ 对话框显示 "共推理 14 个任务"
- ✅ 批量确认窗口自动打开
- ✅ 按钮恢复为 "🔄 手动生成推理"

### 日志表现
- ✅ 日志中有 `[手动推理]` 标记 (新版本特征)
- ✅ 完整的推理流程记录
- ✅ 显示耗时统计 (约5-10秒)
- ✅ **无** `UnboundLocalError` 错误

---

## 🔧 故障排除

### 情况1: 按钮一直卡在"正在执行推理"

**检查**:
```bash
# 查看日志
cd dist
tail -50 gaiya.log | grep "\[手动推理\]"
```

**如果日志为空** (没有 `[手动推理]`):
→ ❌ 仍在使用旧版本

**解决方案**:
```bash
# 方案1: 重命名exe
cd dist
taskkill /F /IM GaiYa-v1.6.exe
ren GaiYa-v1.6.exe GaiYa-v1.6.7.exe
GaiYa-v1.6.7.exe

# 方案2: 源码运行
cd c:\Users\Sats\Downloads\jindutiao
python main.py
```

---

### 情况2: 日志中有 UnboundLocalError

**日志内容**:
```
ERROR - 手动推理执行失败: cannot access local variable 'QMetaObject'
```

**诊断**: 仍在使用 v1.6.5 (旧版本,有Bug)

**解决方案**:
1. 确认exe文件时间:
   ```bash
   cd dist
   ls -lh GaiYa-v1.6.exe
   # 必须显示: 12月 1 23:31
   ```

2. 如果时间不对:
   ```bash
   # 重新打包
   cd c:\Users\Sats\Downloads\jindutiao
   pyinstaller Gaiya.spec
   ```

---

### 情况3: 推理卡住,日志中有 `[手动推理]` 但无后续

**日志内容**:
```
INFO - [手动推理] 启动推理线程
(无后续日志)
```

**诊断**: 推理线程启动失败

**解决方案**:
1. 查看完整错误堆栈:
   ```bash
   cd dist
   tail -100 gaiya.log | grep "ERROR\|Exception\|Traceback" -A 10
   ```

2. 检查调度器是否存在:
   ```bash
   cd dist
   grep "task_completion_scheduler" config.json
   # 应该看到: "enabled": true
   ```

---

## 📋 测试检查清单

### 环境检查
- [ ] exe文件时间: 2025/12/01 23:31 ✅
- [ ] 旧进程已关闭 ✅
- [ ] 旧日志已清理 ✅
- [ ] 新版本已启动 ✅

### 功能测试
- [ ] 统计报告正常打开
- [ ] 点击推理按钮,按钮变为"正在执行推理"
- [ ] 5-10秒后弹出完成对话框
- [ ] 对话框显示任务数量
- [ ] 按钮正确恢复

### 日志验证
- [ ] 日志中有 `[手动推理]` 标记
- [ ] 日志中有 "开始执行: 2025-12-01"
- [ ] 日志中有 "调用调度器执行推理"
- [ ] 日志中有 "推理完成,耗时: X.X秒"
- [ ] **无** UnboundLocalError 错误

---

## 📞 报告问题

**如果测试失败,请提供以下信息**:

1. **exe文件时间**:
   ```bash
   cd dist
   ls -lh GaiYa-v1.6.exe
   ```

2. **最新日志** (最后50行):
   ```bash
   cd dist
   tail -50 gaiya.log
   ```

3. **是否看到对话框**: 是 / 否

4. **是否看到 `[手动推理]`**: 是 / 否

5. **具体卡住时间**: X秒

---

## 🎉 测试成功!

**如果所有测试通过**,恭喜!

✅ Bug已修复
✅ 手动推理功能正常
✅ 可以正常使用了

**下一步**:
- 日常使用: 每天晚上21:00会自动生成推理
- 手动触发: 随时点击 "🔄 手动生成推理" 按钮
- 批量确认: 点击 "✅ 确认/修正任务完成度" 查看详情

---

**测试指引生成时间**: 2025-12-01 23:38
**对应版本**: GaiYa v1.6.6 (Bug修复版)
**预期测试时长**: 2分钟
