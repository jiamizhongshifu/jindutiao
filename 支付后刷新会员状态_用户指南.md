# 支付后刷新会员状态 - 用户指南

## 🎯 问题解决

**问题**: 支付成功后,个人中心页面显示的还是免费用户?

**原因**: 支付回调需要几秒时间,页面需要刷新才能显示最新状态。

**解决方案**: 我们提供了自动刷新和手动刷新两种方式!

---

## ✨ 方式1: 自动刷新 (推荐)

### 工作原理
支付成功后,应用会**自动在后台刷新**你的会员状态。

### 使用步骤
1. 在个人中心点击"立即购买"
2. 完成支付
3. **等待3-5秒** (应用自动刷新中...)
4. 返回个人中心,会员状态已更新!

### 注意事项
- 自动刷新最多重试3次,每次间隔1秒
- 如果5秒后仍未更新,请使用手动刷新

---

## 🔄 方式2: 手动刷新 (兜底方案)

### 使用场景
- 自动刷新失败 (网络问题、回调延迟等)
- 想要立即确认会员状态

### 使用步骤
1. 打开个人中心页面
2. 在页面右上角找到 **"🔄 刷新"** 按钮
3. 点击按钮
4. 等待"刷新中..."对话框
5. 刷新成功!页面显示最新会员等级

### 按钮位置
```
个人中心标题栏
┌─────────────────────────────────────────────┐
│ 账号管理  邮箱: xxx@xxx.com | 会员: FREE      │
│                           [🔄 刷新] [退出登录]│
└─────────────────────────────────────────────┘
```

---

## ❓ 常见问题

### Q1: 点击刷新按钮后显示"刷新失败"?
**A**: 可能的原因:
- 网络连接不稳定 → 检查网络后重试
- 后端还在处理支付回调 → 等待10秒后重试
- API服务异常 → 联系客服

### Q2: 刷新后显示"当前等级: FREE"?
**A**: 可能的原因:
- 支付尚未完成 → 检查支付是否成功
- 支付回调延迟 → 等待30秒后重试
- 订单处理失败 → 联系客服提供订单号

### Q3: 一直显示"刷新中..."不关闭?
**A**: 可能是网络超时,强制关闭对话框后:
- 检查网络连接
- 重启应用
- 再次点击刷新按钮

---

## 🔍 开发者调试

### 查看刷新日志
运行开发版后,刷新时会输出日志:

```log
[MEMBERSHIP] 开始刷新会员状态...
[MEMBERSHIP] 会员状态刷新成功: tier=pro, active=True
[MEMBERSHIP] ✓ 会员升级确认成功!
```

### 测试刷新功能
```bash
# 运行自动化测试
python test_payment_refresh.py

# 运行开发版
python main.py

# 打包测试
cmd /c build-fast.bat
```

---

## 📞 需要帮助?

如果刷新功能无法正常工作:

1. **收集信息**:
   - 订单号 (在支付成功页面)
   - 支付时间
   - 当前会员状态
   - 错误提示 (如果有)

2. **联系客服**:
   - 邮件: support@gaiyatime.com
   - 微信群: 加入VIP会员群

3. **临时解决方案**:
   - 重启应用
   - 重新登录
   - 等待24小时后自动同步

---

**最后更新**: 2025-12-02
**版本**: v1.6.8+
