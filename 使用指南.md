# PyDayBar 使用指南

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行程序
```bash
python main.py
```

## 功能说明

### 已实现功能 ✅

#### 阶段一: 基础窗口框架
- ✅ 透明置顶窗口
- ✅ 点击穿透功能
- ✅ 无边框设计
- ✅ 自动定位到屏幕底部/顶部

#### 阶段二: 静态内容绘制
- ✅ 加载 `tasks.json` 任务数据
- ✅ 绘制彩色任务色块
- ✅ 半透明背景条
- ✅ 任务时间验证

#### 阶段三: 动态时间标记
- ✅ 实时移动的时间标记线
- ✅ 每秒自动更新
- ✅ 红色垂直线标记当前时间
- ✅ 带阴影效果增强可见性

#### 阶段四: 系统托盘和配置
- ✅ 系统托盘图标
- ✅ 右键菜单(重载/切换位置/退出)
- ✅ `config.json` 配置文件
- ✅ 多显示器支持
- ✅ 可自定义颜色、高度、位置等

#### 阶段五: 热重载和错误处理
- ✅ 文件监视器自动检测变化
- ✅ 修改配置/任务文件即时生效
- ✅ 完整的日志系统
- ✅ JSON 格式验证
- ✅ 时间格式验证

## 配置文件说明

### config.json
```json
{
    "bar_height": 20,              // 进度条高度(像素)
    "position": "bottom",          // 位置: "top" 或 "bottom"
    "background_color": "#505050", // 背景颜色
    "background_opacity": 180,     // 背景透明度(0-255)
    "marker_color": "#FF0000",     // 时间标记颜色
    "marker_width": 2,             // 时间标记宽度(像素)
    "screen_index": 0,             // 显示器索引(0=主显示器)
    "update_interval": 1000,       // 更新间隔(毫秒)
    "enable_shadow": true,         // 是否启用阴影
    "corner_radius": 0             // 圆角半径
}
```

### tasks.json
```json
[
    {
        "start": "09:00",          // 开始时间(HH:MM)
        "end": "12:00",            // 结束时间(HH:MM)
        "task": "上午工作",         // 任务名称
        "color": "#4CAF50"         // 显示颜色(十六进制)
    }
]
```

## 系统托盘操作

右键点击系统托盘图标:
- **重载配置**: 重新加载 config.json 和 tasks.json
- **切换位置**: 在屏幕顶部和底部之间切换
- **退出**: 关闭程序

## 热重载功能

程序会自动监视以下文件的变化:
- `config.json` - 配置修改后自动应用
- `tasks.json` - 任务修改后自动刷新

**无需重启程序!** 直接编辑文件保存即可看到效果。

## 常用任务颜色推荐

```json
工作: "#4CAF50" (绿色), "#2196F3" (蓝色)
休息: "#FFC107" (黄色), "#FF9800" (橙色)
重要: "#F44336" (红色), "#E91E63" (粉色)
学习: "#9C27B0" (紫色), "#673AB7" (深紫)
```

## 日志文件

程序运行日志保存在 `pydaybar.log`,包含:
- 启动信息
- 配置/任务加载状态
- 文件变化检测
- 错误信息

## 故障排除

### 1. 程序无法启动
- 检查 Python 版本 (需要 3.8+)
- 确认已安装 PySide6: `pip install PySide6`

### 2. 进度条不显示
- 检查 `config.json` 中的 `bar_height` 是否过小
- 尝试切换到屏幕顶部: 设置 `"position": "top"`
- 查看 `pydaybar.log` 日志文件

### 3. 配置修改不生效
- 等待 1-2 秒(文件监视器延迟)
- 手动通过托盘菜单点击"重载配置"
- 检查 JSON 格式是否正确

### 4. 任务不显示
- 验证 tasks.json 格式是否正确
- 确认时间格式为 "HH:MM" (例如 "09:00")
- 检查颜色代码格式 "#RRGGBB"

## 下一步计划 (阶段六)

### 打包为可执行文件
```bash
pip install pyinstaller
pyinstaller --noconsole --onefile --name=PyDayBar main.py
```

打包后的文件在 `dist/` 目录中,可以直接运行,无需 Python 环境。

### 开机自启动 (Windows)
1. 按 `Win + R`,输入 `shell:startup`
2. 将 `PyDayBar.exe` 快捷方式复制到打开的文件夹

## 项目文件结构

```
PyDayBar/
├── main.py              # 主程序
├── config.json          # 配置文件
├── tasks.json           # 任务数据
├── requirements.txt     # Python依赖
├── pydaybar.log        # 运行日志
├── README.md           # 项目说明
├── jindutiao.md        # 详细开发文档
├── CLAUDE.md           # AI辅助开发指南
└── 使用指南.md         # 本文件
```

## 技术特性

- **GUI框架**: PySide6 (Qt for Python)
- **窗口属性**:
  - 无边框 (`FramelessWindowHint`)
  - 始终置顶 (`WindowStaysOnTopHint`)
  - 点击穿透 (`WindowTransparentForInput`)
  - 透明背景 (`WA_TranslucentBackground`)
- **文件监视**: `QFileSystemWatcher` 实现热重载
- **日志系统**: Python logging 模块
- **数据格式**: JSON

## 性能优化建议

### 降低 CPU 占用
修改 `config.json` 中的 `update_interval`:
```json
{
    "update_interval": 60000  // 改为每分钟更新一次
}
```

### 减少内存占用
- 减少任务数量
- 降低进度条高度
- 禁用阴影效果: `"enable_shadow": false`

## 反馈与支持

如有问题或建议,请查看:
- `pydaybar.log` 日志文件
- `jindutiao.md` 详细开发文档
- `README.md` 项目说明

---

**当前版本**: v1.0-beta (已完成阶段一至阶段五)

**开发者**: Claude Code 辅助开发

**开源协议**: MIT License
