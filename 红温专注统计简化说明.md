# 红温专注统计简化说明

**日期**: 2025-12-01
**版本**: GaiYa v1.6
**构建时间**: 约 17:00

---

## 优化目标

简化时间回放窗口中的红温专注数据展示,让用户能够快速了解:
1. **当天红温专注了多少时间** (总时长)
2. **哪些任务使用了红温专注** (任务名称列表)

---

## 变更前后对比

### 优化前界面结构

```
📋 专注概览
├─ 计划时间: 24小时0分钟
├─ 红温专注: 0小时0分钟
├─ 专注执行率: 0.0%
└─ 执行进度: [======    ] 0%

📅 时间详情
├─ 深度睡眠  计划: 360分钟  专注: 无记录  [    ] 0%
├─ 起床准备  计划: 60分钟   专注: 无记录  [    ] 0%
├─ 早餐时间  计划: 60分钟   专注: 无记录  [    ] 0%
├─ 晨间运动  计划: 60分钟   专注: 无记录  [    ] 0%
├─ 上午工作  计划: 180分钟  专注: 无记录  [    ] 0%
└─ ... (显示所有任务,包括无专注记录的)
```

**问题**:
- 信息冗余: 计划时间、执行率等数据对用户意义不大
- 显示混乱: 无专注记录的任务也占据大量空间
- 重点不明: 总专注时间不够醒目

---

### 优化后界面结构

```
🔥 红温专注概览
├─ 今日专注: 2小时30分钟  ← 大字号显示,一目了然

📝 专注任务
├─ 🔥 上午工作      1小时30分钟    共 2 次
├─ 🔥 下午工作      45分钟         共 1 次
└─ 🔥 晚间学习      15分钟         共 1 次
(只显示有专注记录的任务)
```

**改进点**:
✅ 总时长大字号显示,视觉聚焦
✅ 只显示有专注记录的任务,减少干扰
✅ 火焰图标突出专注属性
✅ 简洁的卡片样式(浅粉红背景)
✅ 显示专注次数,了解任务被专注的频率

---

## 技术实现

### 1. UI布局简化

**文件**: `gaiya/ui/time_review_window.py`
**方法**: `create_focus_review_panel()` (Lines 95-150)

**核心变更**:
```python
# 移除:
# - 计划时间显示
# - 专注执行率百分比
# - 执行进度条

# 保留:
# - 总专注时间 (加大字号,红色高亮)
# - 专注任务列表 (只显示有记录的)

# 新增:
# - 火焰图标 🔥 强化视觉识别
# - 专注次数统计
# - 粉红色卡片背景
```

### 2. 数据筛选逻辑

**方法**: `update_focus_review()` (Lines 392-427)

**筛选规则**:
```python
# 只显示 focus_minutes > 0 的任务
focused_tasks = [
    block for block in self.review_data['time_blocks']
    if block['focus_minutes'] > 0
]

# 无记录时显示提示
if not focused_tasks:
    显示 "今日尚无专注记录"
```

### 3. 任务卡片设计

**方法**: `create_focus_task_item()` (Lines 560-610)

**卡片结构**:
```
[🔥] [任务名称]       [时长]      [次数]
     上午工作       1小时30分钟   共 2 次
```

**样式特点**:
- 边框: `#ffcccb` (淡红色)
- 背景: `#fff5f5` (浅粉红)
- 时长颜色: `#e74c3c` (红色,加粗)
- 次数颜色: `#6c757d` (灰色)

---

## 数据统计逻辑

### 总专注时间计算

从数据库统计今日所有完成的专注会话:

```sql
SELECT SUM(duration_minutes)
FROM focus_sessions
WHERE start_time >= '今日00:00:00'
AND status = 'COMPLETED'
```

### 任务关联

通过 `time_block_id` 关联任务和专注会话:

```sql
SELECT time_block_id, SUM(duration_minutes), COUNT(*)
FROM focus_sessions
WHERE start_time >= '今日00:00:00'
AND status = 'COMPLETED'
GROUP BY time_block_id
```

**结果结构**:
```python
{
    'time-block-0': {'duration': 90, 'count': 2},  # 上午工作: 90分钟, 2次
    'time-block-1': {'duration': 45, 'count': 1},  # 下午工作: 45分钟, 1次
}
```

---

## 用户场景示例

### 场景1: 无专注记录

```
🔥 红温专注概览
  今日专注: 0分钟

📝 专注任务
  今日尚无专注记录
```

**操作提示**: 右键进度条 → 开启红温专注仓

---

### 场景2: 单次专注

```
🔥 红温专注概览
  今日专注: 25分钟

📝 专注任务
  🔥 下午工作    25分钟    共 1 次
```

---

### 场景3: 多任务多次专注

```
🔥 红温专注概览
  今日专注: 3小时15分钟

📝 专注任务
  🔥 上午工作    1小时30分钟    共 3 次
  🔥 下午工作    1小时         共 2 次
  🔥 学习时间    30分钟        共 1 次
  🔥 项目开发    15分钟        共 1 次
```

---

## 已修改文件

**gaiya/ui/time_review_window.py**
- Lines 95-150: `create_focus_review_panel()` - 重构UI布局
- Lines 392-427: `update_focus_review()` - 更新数据显示逻辑
- Lines 560-610: `create_focus_task_item()` - 新增简洁卡片组件

**旧方法保留** (兼容性):
- `create_time_block_widget()` - 详细时间块显示(未使用)

---

## 用户反馈点

### 优点
✅ 信息简洁,重点突出
✅ 一眼看到总专注时长
✅ 专注任务一目了然
✅ 视觉设计舒适(粉红色主题)

### 潜在改进
- 可选显示计划时间 (设置中开关)
- 专注任务点击后跳转到对应时间块
- 统计每周/每月专注趋势图

---

## 打包信息

**版本**: `dist/GaiYa-v1.6.exe`
**构建时间**: 2025-12-01 17:00
**文件大小**: 约 82MB

**本次更新**:
1. ✅ 简化红温专注统计界面
2. ✅ 突出总专注时长显示
3. ✅ 只展示有专注记录的任务
4. ✅ 优化卡片视觉设计
5. ✅ 新增专注次数统计

---

## 相关文档

- [行为识别问题修复说明.md](行为识别问题修复说明.md) - 行为识别功能
- [GaiYa自我追踪过滤功能说明.md](GaiYa自我追踪过滤功能说明.md) - 自我追踪过滤
- [README.md](README.md) - 项目总览

---

**优化完成** ✅
