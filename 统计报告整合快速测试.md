# 统计报告整合 - 快速测试指南

**打包时间**: 2025-12-01 21:38
**文件**: `dist\GaiYa-v1.6.exe` (82MB)

---

## ⚡ 快速测试 (5分钟)

### 步骤1: 启动应用 (1分钟)
```bash
dist\GaiYa-v1.6.exe
```

**检查点**:
- ✅ 应用正常启动
- ✅ 没有崩溃或报错

---

### 步骤2: 打开统计报告 (30秒)

**方法1**: 托盘菜单 → `📊 统计报告`
**方法2**: 配置界面 → `统计报告` 按钮

**检查点**:
- ✅ 统计报告窗口打开
- ✅ 显示4个标签页: 今日 | 本周 | 本月 | 任务分类

---

### 步骤3: 查看今日统计表格 (1分钟)

**位置**: 统计报告 → "今日" 标签页 → 下拉查看任务详情表格

**检查新增的列**:

| 列名 | 说明 | 示例值 |
|-----|------|--------|
| 任务名称 | 原有 | ● 上午工作 |
| 开始时间 | 原有 | 09:00 |
| 结束时间 | 原有 | 12:00 |
| 时长 | 原有 | 180 |
| **完成度** | **新增** | **85%** (绿色/橙色/红色) |
| **置信度** | **新增** | **✅ 高** / ⚠️ 中 / ❓ 低 / ❔ 未知 |
| **状态** | **修改** | **⏳ 待确认** / ✔️ 已确认 / ✏️ 已修正 / 📊 统计数据 |

**预期结果**:
- ✅ 表格有7列(之前是5列)
- ✅ 完成度列显示百分比
- ✅ 置信度列显示图标 + 文字

**可能情况**:
- **情况A**: 今日已生成推理 → 显示真实完成度和置信度
- **情况B**: 今日未生成推理 → 显示统计数据(完成度: 100%/50%/0%, 置信度: ❔未知, 状态: 📊统计数据)

---

### 步骤4: 测试确认按钮 (2分钟)

**位置**: 统计报告 → "今日" 标签页 → 表格下方 → `✅ 确认/修正任务完成度` 按钮

**测试场景A: 有推理数据**

1. 点击 `✅ 确认/修正任务完成度` 按钮
2. 应弹出 "任务完成回顾" 窗口
3. 修改一个任务的完成度(拖动滑块或点击快捷按钮)
4. 点击 `全部确认`
5. 窗口关闭,弹出 "已成功确认 X 个任务!" 提示
6. 查看表格,状态列应更新为 "✔️ 已确认" 或 "✏️ 已修正"

**测试场景B: 无推理数据**

1. 点击 `✅ 确认/修正任务完成度` 按钮
2. 弹出提示框:
   ```
   今天没有待确认的任务完成记录。

   可能原因:
   1. 今天尚未生成任务完成推理
   2. 所有任务都已确认
   3. 任务完成推理系统未启用
   ```
3. 点击 `确定` 关闭提示框

---

## 🔬 详细测试 (15分钟)

### 测试1: 触发任务完成推理

**目的**: 生成真实的推理数据,测试完整流程

**方法**: 修改触发时间为当前时间+2分钟

**步骤**:
1. 关闭应用
2. 编辑 `dist\config.json`
3. 找到 `task_completion_scheduler` 配置
4. 修改 `trigger_time` 为当前时间+2分钟
   例如: 当前21:40 → 设置为 `"21:42"`
5. 保存文件
6. 重启应用
7. 等待2分钟

**预期结果**:
- ✅ 日志显示: "开始执行每日推理"
- ✅ 弹出 "任务完成回顾" 窗口(如果有未确认任务)
- ✅ 或者托盘提示: "任务完成推理已完成"

---

### 测试2: 完整的确认流程

**前提**: 已生成推理数据(参考测试1)

**步骤**:
1. 打开统计报告
2. 查看今日统计表格
3. 确认 "完成度" 列不是100%/50%/0%(这是统计数据)
4. 确认 "置信度" 列不是 "❔ 未知"
5. 确认 "状态" 列显示 "⏳ 待确认"
6. 点击 `✅ 确认/修正任务完成度` 按钮
7. 在回顾窗口中修改第一个任务的完成度:
   - 拖动滑块到90%
   - 或点击 `100%` 快捷按钮
8. 点击 "展开详情" 查看推理信号
9. 添加备注: "测试修正"
10. 点击 `全部确认`
11. 查看表格,第一个任务的:
    - 完成度 → 更新为90% 或 100%
    - 状态 → 更新为 "✏️ 已修正" 或 "✔️ 已确认"

**预期结果**:
- ✅ 所有步骤无报错
- ✅ 数据正确保存
- ✅ 表格实时刷新

---

### 测试3: 数据持久化

**步骤**:
1. 完成测试2
2. 关闭统计报告窗口
3. 重新打开统计报告
4. 查看今日统计表格

**预期结果**:
- ✅ 确认的任务状态仍然是 "✔️ 已确认" 或 "✏️ 已修正"
- ✅ 完成度数据正确显示

---

### 测试4: 学习机制验证

**步骤**:
1. 完成测试2(修正一个任务的完成度)
2. 打开 `dist\user_behavior_model.json`
3. 找到对应任务的 `learning_stats`
4. 查看 `total_corrections` 是否增加

**预期结果**:
```json
{
  "tasks": {
    "上午工作": {
      "learning_stats": {
        "total_corrections": 1,  // 应该增加
        "last_correction_date": "2025-12-01"
      },
      "app_weights": {
        "Cursor.exe": 0.85  // 可能已调整
      }
    }
  }
}
```

---

### 测试5: 数据源退回

**目的**: 验证无推理数据时,使用statistics.json

**步骤**:
1. 清空任务完成推理数据 (可选):
   ```bash
   sqlite3 dist\gaiya.db
   sqlite> DELETE FROM task_completions;
   sqlite> .quit
   ```
2. 打开统计报告
3. 查看今日统计表格

**预期结果**:
- ✅ 表格仍然显示7列
- ✅ 完成度列显示: 100% / 50% / 0% (根据旧status推断)
- ✅ 置信度列显示: ❔ 未知
- ✅ 状态列显示: 📊 统计数据
- ✅ 点击 "确认完成度" 按钮提示: "今天没有待确认的任务完成记录"

---

## 🐛 已知问题排查

### 问题1: 表格没有显示完成度列

**可能原因**:
- 打包时未包含修改后的 `statistics_gui.py`
- 旧的 exe 没有被覆盖

**排查**:
```bash
# 检查打包时间
ls -lh dist\GaiYa-v1.6.exe
# 应该显示 12月 1 21:38

# 如果时间不对,重新打包:
rm -rf build dist
pyinstaller Gaiya.spec
```

---

### 问题2: 点击确认按钮报错

**可能错误**:
```
AttributeError: 'DatabaseManager' object has no attribute 'get_unconfirmed_task_completions'
```

**原因**: 数据库方法未定义

**修复**: 已在 `db_manager.py` 中添加,重新打包即可

---

### 问题3: 表格显示 "❔ 未知" 和 "📊 统计数据"

**这是正常的!**

说明:
- 今天还没有生成任务完成推理
- 系统退回到使用 `statistics.json` 的时间统计数据

**触发推理**:
- 等待晚上21:00自动触发
- 或修改 `config.json` 中的 `trigger_time` 立即触发
- 或在托盘菜单点击 "✅ 任务完成回顾" (如果已实现手动触发)

---

## ✅ 测试检查清单

### 基础功能
- [ ] 应用正常启动
- [ ] 统计报告窗口打开
- [ ] 表格显示7列 (不是5列)
- [ ] 完成度列存在
- [ ] 置信度列存在
- [ ] 状态列更新

### 确认功能
- [ ] "确认完成度" 按钮存在
- [ ] 点击按钮无报错
- [ ] 有推理数据时弹出回顾窗口
- [ ] 无推理数据时显示提示框

### 数据显示
- [ ] 完成度有颜色编码 (绿/橙/红)
- [ ] 置信度图标正确显示
- [ ] 状态文字正确显示

### 完整流程
- [ ] 推理触发 → 生成数据
- [ ] 打开统计报告 → 看到完成度
- [ ] 点击确认按钮 → 打开回顾窗口
- [ ] 修正完成度 → 保存
- [ ] 表格刷新 → 状态更新
- [ ] 重启应用 → 数据持久化

---

## 📝 测试记录

**测试日期**: ____________
**测试人员**: ____________

| 测试项 | 结果 | 备注 |
|-------|------|------|
| 表格显示7列 | ☐ 通过 ☐ 失败 | |
| 完成度列存在 | ☐ 通过 ☐ 失败 | |
| 置信度列存在 | ☐ 通过 ☐ 失败 | |
| 确认按钮存在 | ☐ 通过 ☐ 失败 | |
| 点击按钮无报错 | ☐ 通过 ☐ 失败 | |
| 回顾窗口弹出 | ☐ 通过 ☐ 失败 | |
| 确认后刷新 | ☐ 通过 ☐ 失败 | |
| 数据持久化 | ☐ 通过 ☐ 失败 | |

**问题记录**:
1. _______________________________________________
2. _______________________________________________

---

**文档生成时间**: 2025-12-01 21:40
**对应版本**: GaiYa v1.6 (统计报告整合)
