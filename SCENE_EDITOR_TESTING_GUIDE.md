# 场景编辑器测试指南

## 测试环境准备

### 1. 启动编辑器
```bash
cd C:\Users\Sats\Downloads\jindutiao
python scene_editor.py
```

### 2. 准备测试素材
在测试前，请准备以下素材（PNG格式）：
- 道路图片：宽度建议100-200px，高度等于画布高度（150px）
- 场景元素图片：各种大小的PNG图片（树、房子、人物等）

---

## 测试项目清单

### ✅ 测试组1：基本UI和布局

#### 1.1 窗口布局检查
- [ ] 窗口标题显示："GaiYa 场景编辑器 v1.0.0"
- [ ] 三栏布局正常显示（素材库 | 画布 | 属性面板）
- [ ] 工具栏显示（撤销、重做按钮）
- [ ] 底部状态栏显示（网格控制、导出按钮）

#### 1.2 属性面板基本信息
- [ ] "基本信息"分组显示正常
- [ ] 场景名称输入框可编辑
- [ ] 画布高度调整（100-300px）正常工作

---

### ✅ 测试组2：网格系统

#### 2.1 网格显示
- [ ] 默认显示灰色网格线（点线样式）
- [ ] 网格大小：10px
- [ ] 画布边界显示（深灰色实线）

#### 2.2 网格控制
- [ ] 点击"显示网格"复选框，网格隐藏/显示
- [ ] 点击"吸附网格"复选框，启用/禁用吸附

#### 2.3 网格吸附功能
- [ ] 启用吸附后，拖拽元素自动对齐到网格
- [ ] 禁用吸附后，元素可以任意位置放置

---

### ✅ 测试组3：元素操作

#### 3.1 添加元素（拖拽方式）
**测试步骤：**
1. 从左侧素材库拖拽一个图片
2. 拖到画布上释放

**预期结果：**
- [ ] 元素出现在画布上
- [ ] 元素位置在鼠标释放点
- [ ] 如果启用网格吸附，位置自动对齐

#### 3.2 选中元素
**测试步骤：**
1. 点击画布上的元素

**预期结果：**
- [ ] 元素显示蓝色虚线边框
- [ ] 右侧属性面板"选中元素"分组启用
- [ ] 属性面板显示元素的当前属性

#### 3.3 移动元素
**测试步骤：**
1. 选中元素后拖拽

**预期结果：**
- [ ] 元素跟随鼠标移动
- [ ] 如果启用吸附，移动时自动对齐网格
- [ ] 属性面板的X/Y值实时更新

#### 3.4 缩放元素
**测试步骤：**
1. 选中元素
2. 在属性面板调整"缩放"值

**预期结果：**
- [ ] 元素大小实时变化
- [ ] 缩放范围：10%-300%

#### 3.5 调整层级
**测试步骤：**
1. 添加多个元素
2. 调整"层级"值

**预期结果：**
- [ ] 层级高的元素显示在上层
- [ ] 层级范围：0-100

---

### ✅ 测试组4：撤销/重做

#### 4.1 撤销操作 (Ctrl+Z)
**测试步骤：**
1. 添加一个元素
2. 点击工具栏"撤销"按钮或按Ctrl+Z

**预期结果：**
- [ ] 刚添加的元素消失

#### 4.2 重做操作 (Ctrl+Y)
**测试步骤：**
1. 撤销操作后
2. 点击"重做"按钮或按Ctrl+Y

**预期结果：**
- [ ] 元素重新出现

#### 4.3 多步撤销/重做
**测试步骤：**
1. 执行多个操作（添加、移动、缩放）
2. 多次撤销/重做

**预期结果：**
- [ ] 每次撤销/重做一步操作
- [ ] 操作历史正确

---

### ✅ 测试组5：道路层管理

#### 5.1 选择道路图片
**测试步骤：**
1. 在属性面板"道路层"分组中
2. 点击"选择道路图片"按钮
3. 选择一张PNG图片

**预期结果：**
- [ ] 文件选择对话框打开
- [ ] 选择图片后，画布背景显示平铺的道路
- [ ] 道路预览显示缩略图（60px高度）
- [ ] 文件名显示在下方
- [ ] "清除道路"按钮启用

#### 5.2 道路平铺渲染
**测试步骤：**
1. 选择一张窄的道路图片（如100px宽）

**预期结果：**
- [ ] 道路图片横向平铺覆盖整个画布宽度
- [ ] 道路显示在网格之下

#### 5.3 清除道路
**测试步骤：**
1. 在已选择道路的情况下
2. 点击"清除道路"按钮

**预期结果：**
- [ ] 画布背景道路消失
- [ ] 预览区域显示"未选择道路图片"
- [ ] 文件名显示"文件: 无"
- [ ] "清除道路"按钮禁用

---

### ✅ 测试组6：事件配置

#### 6.1 添加事件
**测试步骤：**
1. 选中一个元素
2. 在"事件配置"部分点击"添加事件"
3. 配置事件：
   - 触发器：选择"on_hover - 鼠标悬停"
   - 动作：选择"show_tooltip - 显示提示"
   - 文本内容：输入"这是一个提示"
4. 点击"OK"

**预期结果：**
- [ ] 事件配置对话框打开
- [ ] 各控件可正常操作
- [ ] 保存后，事件列表显示"悬停 → 显示提示"

#### 6.2 添加多个事件
**测试步骤：**
1. 继续添加更多事件：
   - on_click → open_url
   - on_time_reach → show_dialog

**预期结果：**
- [ ] 同一元素可以有多个事件
- [ ] 事件列表正确显示所有事件

#### 6.3 编辑事件
**测试步骤：**
1. 在事件列表中选中一个事件
2. 点击"编辑"按钮
3. 修改配置后保存

**预期结果：**
- [ ] 选中事件后，"编辑"和"删除"按钮启用
- [ ] 对话框加载已有配置
- [ ] 修改后，列表更新
- [ ] 编辑后保持选中状态

#### 6.4 删除事件
**测试步骤：**
1. 选中一个事件
2. 点击"删除"按钮

**预期结果：**
- [ ] 事件从列表中移除

#### 6.5 事件参数动态显示
**测试步骤：**
1. 在事件配置对话框中
2. 切换不同的触发器和动作类型

**预期结果：**
- [ ] 选择"open_url"时，显示URL输入框，隐藏文本框
- [ ] 选择"show_tooltip/show_dialog"时，显示文本框，隐藏URL框
- [ ] 选择"on_time_reach"触发器时，显示时间参数输入框
- [ ] 其他触发器隐藏时间参数

---

### ✅ 测试组7：JSON导出

#### 7.1 导出空场景
**测试步骤：**
1. 不添加任何元素
2. 点击"导出场景配置"按钮
3. 保存为test_empty.json

**预期结果：**
- [ ] 文件保存成功
- [ ] JSON格式正确
- [ ] 包含基本结构（scene_id, name, version, canvas, layers）
- [ ] layers.scene.items为空数组

#### 7.2 导出完整场景
**测试步骤：**
1. 设置场景名称："测试场景"
2. 选择道路图片
3. 添加2-3个元素，设置不同位置、缩放、层级
4. 为其中一个元素添加1-2个事件
5. 导出为test_complete.json

**预期结果JSON格式：**
```json
{
  "scene_id": "scene_001",
  "name": "测试场景",
  "version": "1.0.0",
  "canvas": {
    "width": 1000,
    "height": 150
  },
  "layers": {
    "road": {
      "type": "tiled",
      "image": "道路文件名.png"
    },
    "scene": {
      "items": [
        {
          "id": "item_1",
          "image": "元素文件名.png",
          "position": {
            "x_percent": 10.5,
            "y_pixel": 50
          },
          "scale": 1.2,
          "z_index": 1,
          "events": [
            {
              "trigger": "on_hover",
              "action": {
                "type": "show_tooltip",
                "params": {
                  "text": "提示内容"
                }
              }
            }
          ]
        }
        // ... 更多元素
      ]
    }
  }
}
```

**检查项：**
- [ ] road层正确导出（如果选择了道路）
- [ ] scene层包含所有元素
- [ ] 每个元素的所有属性正确
- [ ] 事件列表完整导出
- [ ] JSON格式正确（可用在线JSON验证工具检查）

#### 7.3 导出文件名
**测试步骤：**
1. 导出时输入文件名"my_scene"
2. 不输入.json后缀

**预期结果：**
- [ ] 自动添加.json后缀
- [ ] 文件正确保存

---

## 已知问题记录

### 自动化测试结果
✅ **单元测试全部通过** (test_scene_editor.py)
- 事件配置数据结构：通过
- 场景元素事件导出：通过
- 场景导出格式：通过
- 事件类型组合（9种）：通过

### Bug修复记录
1. ✅ **JSON导出缺少道路层** - 已修复
   - 问题：export_config()未包含road层
   - 修复：添加道路层导出逻辑

---

## 测试总结

### 测试覆盖范围
- [x] 基本UI和布局
- [x] 网格系统
- [x] 元素操作（添加、选中、移动、缩放、层级）
- [x] 撤销/重做
- [x] 道路层管理
- [x] 事件配置（添加、编辑、删除）
- [x] JSON导出

### 建议测试场景
1. **简单场景**：1个道路 + 2个元素 + 无事件
2. **复杂场景**：1个道路 + 5个元素 + 多个事件
3. **边界测试**：
   - 最大元素数量（如100个）
   - 最大缩放（300%）
   - 最小缩放（10%）
   - 最大层级（100）

---

## 下一步开发建议

基于测试结果，以下功能可以在后续阶段实现：

### Phase 1 剩余功能
- [ ] 素材库自动加载图片（目前需要手动拖拽）
- [ ] 画布缩放和滚动（处理大尺寸场景）
- [ ] 多选元素和批量操作
- [ ] 对齐辅助线（已有基础代码）

### Phase 2 场景渲染引擎
- [ ] 加载JSON配置
- [ ] 渲染场景到进度条
- [ ] 事件响应系统（悬停、点击、时间触发）

### Phase 3 主程序集成
- [ ] 场景切换系统
- [ ] 场景预览
- [ ] 场景资源管理

---

## 附录：快捷键

| 快捷键 | 功能 |
|--------|------|
| Ctrl+Z | 撤销 |
| Ctrl+Y | 重做 |

---

**测试日期**: 2025-11-13
**测试版本**: v1.0.0
**测试人员**: Claude Code
**测试状态**: ✅ 所有自动化测试通过，待手动UI测试
